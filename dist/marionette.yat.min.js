/**
* @license
* Marionette.Yat extension for Backbone.Marionette
* Yet Another Toolkit
* ----------------------------------
* v0.0.31
*
* Distributed under MIT license
* author: dimtabu
*/
!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e(require("backbone"),require("backbone.marionette"),require("underscore"),require("jquery")):"function"==typeof define&&define.amd?define(["backbone","backbone.marionette","underscore","jquery"],e):t.MarionetteYat=e(t.Backbone,t.Marionette,t._,t.jQuery)}(this,function(t,e,n,i){"use strict";t=t&&t.hasOwnProperty("default")?t.default:t,e=e&&e.hasOwnProperty("default")?e.default:e,n=n&&n.hasOwnProperty("default")?n.default:n,i=i&&i.hasOwnProperty("default")?i.default:i;var r=function(n){return n instanceof t.Model?n:n instanceof e.View?n.model:void 0},o=function(e){return e instanceof t.View?e:void 0},s=function(t,e,n){return"function"==typeof n&&(t=n.call(t,r(t),o(t)),e=n.call(e,r(e),o(e))),t<e?-1:t>e?1:0},a={compareAB:s,viewComparator:function(){for(var t=arguments.length,e=Array(t),i=0;i<t;i++)e[i]=arguments[i];var r=[],o=0;return e.length>=2?s.apply(null,e):(1===e.length&&e[0]instanceof Array&&(r=e[0]),n(r).every(function(t){return 0===(o=s.apply(null,t))}),o)}};function l(t,e,i){return n.isFunction(e)&&(e=e.apply(t,i||[])),e}function h(e){var i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(null==i.fields||i.fileds&&!i.fileds.length)throw new Error("fields option missing");if(i.checked||(i.checked={}),null!=e){var r=void 0,o=e instanceof t.Model,s=n.isObject(e.options),a=i.exclude instanceof Array?i.exclude:"string"==typeof i.exclude?[i.exclude]:[];return n(i.fields).some(function(t){if(!(t in i.checked||(i.checked[t]=!0,a.indexOf(t)>=0)))return o&&null==r&&(r=l(e,e.get(t),i.args)),null==r&&(r=l(e,e[t],i.args)),null==r&&s&&(r=l(e,e.options[t],i.args)),null!=r}),null==r?i.default:r}}function u(t,e){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:":";return t||(t=""),t+n+(e=null==e?"":e.toString())}function c(e,i){if(null!=e&&n.isObject(e)&&null!=i&&""!=i)return e instanceof t.Model?e.get(i):e[i]}function g(e,n,i,r){return e instanceof t.Model?e.set(n,i,{silent:!0}):e[n]=i,i instanceof t.Model&&r.models.push({path:r.passPath.join(":"),property:n,model:i}),r.passPath.push(n),c(e,n)}var d=function(e,i,r,o){if(null!=e&&n.isObject(e)&&null!=i&&""!=i){var s=n.extend({},o);if(s.silent=!0===s.silent,s.force=!1!==s.force,!n.isObject(i)||i instanceof Array||(r=i.value,s.force=!1!==i.force,s.silent=!0===i.silent,i=i.path),s.path=i,s.passPath=[],s.models=[],null!=i&&""!=i){var a="string"==typeof i?i.split("."):i instanceof Array?[].slice.call(i):[i];if(s.pathArray=[].slice.call(a),a.length){a.length;var l=a.shift();e instanceof t.Model&&s.models.push({path:"",property:l,model:e});var h=function t(e,i,r,o,s){if(null!=e&&n.isObject(e)&&null!=i&&""!=i){if(!r.length)return g(e,i,o,s);var a=c(e,i);if(n.isObject(a)||s.force)return!n.isObject(a)&&s.force&&(a=g(e,i,{},s)),t(a,r.shift(),r,o,s)}}(e,l,a,r,s);if(void 0===h&&void 0!==r)return h;if(!s.silent)for(var u=s.pathArray.join(":");s.models.length;){var d=s.models.pop(),f=""==d.path?u:u.substring(d.path.length+1);f&&d.model.trigger("change:"+f,r),d.model.trigger("change",d.model)}return h}}}};function f(t,e){if(null!=t&&n.isObject(t)&&null!=e&&""!=e){var i="string"==typeof e?e.split("."):e instanceof Array?[].slice.call(e):[e];return function t(e,i,r){if(null!=e&&n.isObject(e)&&null!=i&&""!=i){var o=c(e,i);return!r.length||r.length&&null==o?o:t(o,r.shift(),r)}}(t,i.shift(),i)}}var p="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t};function v(e){if(null!=e&&n.isObject(e)){var i={};return function e(n,i){if(i=i||"",null!=this&&"object"==p(this))for(var r=this instanceof t.Model?this.attributes:this,o=Object.getOwnPropertyNames(r),s=0;s<o.length;s++){var a=o[s],l=this[a];null==l||"object"!=(void 0===l?"undefined":p(l))||l instanceof Date||l instanceof Array?n[i+a]=l:"object"==(void 0===l?"undefined":p(l))&&e.call(l,n,i+a+".")}}.call(e,i),i}}function m(t){if(null!=t&&n.isObject(t)){var e={};for(var i in t)d(e,i,t[i],!0);return e}}var _={getLabel:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return e.fields=["getLabel","label","getName","name","getValue","value"].concat(e.fields||[]),h(t,e)},getName:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return e.fields=["getName","name","getLabel","label","getValue","value"].concat(e.fields||[]),h(t,e)},getValue:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return e.fields=["getValue","value","getId","id","getName","name","getLabel","label","cid"].concat(e.fields||[]),h(t,e)},wrap:u,unwrap:function(t,e){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:":";if(null!=t){if(t=t.toString(),e||(e=""),!t.length)return t;var i=new RegExp("^"+e+n);return t.replace(i,"")}},setByPath:d,getByPath:f,flattenObject:v,unFlattenObject:m,isView:function(e){return e instanceof t.View}},y={view:a,common:_},b=[t.Model,t.Collection,t.View,t.Router,e.Object];function w(t){var e=n.isFunction(t),i=n(b).some(function(e){return t===e||t.prototype instanceof e});return e&&i}var O=e.Error.extend({},{Http400:function(t){return this.Http(400,t)},Http401:function(t){return this.Http(401,t)},Http403:function(t){return this.Http(403,t)},Http404:function(t){return this.Http(404,t)},Http500:function(t){return this.Http(500,t)},Http:function(t,e){var n=new this({message:e,name:"HttpError"});return n.status=t,n},HttpRedirect:function(t){return this.Http(301,t)},NotFound:function(t){return this.Http404(t)},NotAuthorized:function(t){return this.Http401(t)},Forbidden:function(t){return this.Http403(t)}});function S(t){var i=null;if(n.isFunction(t))i=t;else{if(!n.isObject(t)||null===t)throw new Error("argument should be an object or class definition");var r=function(){};r.extend=e.extend,i=r.extend(t)}i.extend||((i=e.extend.call(t,{})).extend=e.extend);return{with:function(){for(var t=arguments.length,e=Array(t),r=0;r<t;r++)e[r]=arguments[r];return n.reduce(e,function(t,e){return function(t,e){if(n.isFunction(e))return e(t);if(n.isObject(e))return t.extend(e);throw new O("Mixin fail, argument should be an object hash or mixin function")}(t,e)},i)},class:i}}var x={isKnownCtor:w,mix:S};function C(t){return t.extend({getName:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=n.extend({},t);return e.exclude="getName",e.args=[e],_.getName(this,e)},getLabel:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=n.extend({},t);return e.exclude="getLabel",e.args=[e],_.getLabel(this,e)},getValue:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=n.extend({},t);return e.exclude="getValue",e.args=[e],_.getValue(this,e)}})}var P=function(t){return t.extend({getProperty:function(t,e){return this._getOptionOrProperty(this,t,e,this.getOption)},getOption:function(t,e){return this._getOptionOrProperty(this.getProperty("options",{deep:!1}),t,e,this.getProperty)},_getOptionOrProperty:function(t,e){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},r=arguments[3];if(void 0!==i.deep||(i.deep=!0),void 0!==i.force||(i.force=!0),i.args||(i.args=[]),null!=e&&null!=t){var o=t[e];if(void 0===o&&i.deep&&n.isFunction(r)){var s=n.extend({},i,{deep:!1,force:!1});o=r.call(this,e,s)}return n.isFunction(o)&&i.force&&!w(o)&&(o=o.apply(this,i.args||[])),void 0===o?i.default:o}}})},M=function(t){return t.extend({constructor:function(){for(var e=arguments.length,n=Array(e),i=0;i<e;i++)n[i]=arguments[i];t.apply(this,n);var r=!(!0===this.getProperty("initRadioOnInitialize"));this._initRadio({skip:r})},getChannel:function(){return this._channel||this._initRadio({skip:!1}),this._channel},_initRadio:function(){if(1!=(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{skip:!0}).skip){if(!this.getProperty("channelName")){var t=this.getProperty("channel");t&&(this.channelName=t.channelName)}e.Object.prototype._initRadio.call(this)}},radioRequest:function(){var t=this.getChannel();t&&t.request.apply(t,arguments)},radioTrigger:function(){var t=this.getChannel();t&&t.trigger.apply(t,arguments)}})};var k=function(t){var e=t.extend({constructor:function(){for(var e=arguments.length,n=Array(e),i=0;i<e;i++)n[i]=arguments[i];t.apply(this,n),this.initializeStateable()},initializeStateable:function(){this._state={}},getState:function(t){var e=this._state;return t?e[t]:e},setState:function(t,e,i){if(null!=t)if(n.isObject(t)){var r=this;i=e,n(e=t).each(function(t,e){return r.setState(e,t,n.extend({},i,{doNotTriggerFullState:!0}))}),this._triggerStateChange(e,i)}else{this.getState()[t]=e,this._triggerStateChange(t,e,i)}},clearState:function(){var t=this.getState(),e=n.extend({},t);n(t).each(function(n,i){e[i]=void 0,delete t[i]}),this._triggerStateChange(e)},_triggerStateChange:function(t,e,i){if(n.isFunction(this.triggerMethod)){n.isObject(t)?(i=e,e=t,this.triggerMethod("state",e,i)):(this.triggerMethod("state:"+t,e,i),(!0===e||!1===e||e&&"string"==typeof e)&&this.triggerMethod("state:"+t+":"+e.toString(),i),(!i||i&&!i.doNotTriggerFullState)&&this.triggerMethod("state",(s=e,(o=t)in(r={})?Object.defineProperty(r,o,{value:s,enumerable:!0,configurable:!0,writable:!0}):r[o]=s,r),i));var r,o,s}}});return e.Stateable=!0,e},D="initialized",R="starting",E="running",j="stopping",A="waiting",V="destroyed";function T(t,e){var i=this;if(null==t||null==e)return Promise.resolve();var r=t["_"+e]||[],o=n.result(t,e)||[],s=r.concat(o),a=[];return n(s).each(function(t){n.isFunction(t)?a.push(t.call(i)):null!=t&&a.push(t)}),Promise.all(a)}function z(t,e,n){t[e]||(t[e]=[]);t[e].push(n)}var L=function(t){var e=S(t).with(k),i=e.extend({constructor:function(){for(var t=arguments.length,n=Array(t),i=0;i<t;i++)n[i]=arguments[i];e.apply(this,n),this.initializeStartable()},freezeWhileStarting:!1,freezeUI:function(){},unFreezeUI:function(){},isStartNotAllowed:function(){},isStopNotAllowed:function(){},addStartPromise:function(t){z(this,"_startRuntimePromises",t)},addStopPromise:function(t){z(this,"_stopPromises",t)},initializeStartable:function(){this.constructor.Startable&&this.constructor.Stateable&&(this._registerStartableLifecycleListeners(),this._setLifeState(D),this._startRuntimePromises=[],this._startPromises=[],this._stopPromises=[])},start:function(){for(var t=arguments.length,e=Array(t),n=0;n<t;n++)e[n]=arguments[n];var i=e[0],r=this;return new Promise(function(t,n){var o=r._ensureStartableCanBeStarted();if(o)return r.triggerMethod("start:decline",o),void n(o);var s=r.isStartNotAllowed(i);if(s)return r.triggerMethod("start:decline",s),void n(s);r.triggerMethod.apply(r,["before:start"].concat(e));var a=r._getLifeState();r._getStartPromise().then(function(){r._tryMergeStartOptions(i),r.once("start",function(){return t.apply(void 0,arguments)}),r.triggerStart(i)},function(){r._setLifeState(a),n.apply(void 0,arguments)})})},triggerStart:function(t){this.triggerMethod("start",t)},stop:function(){for(var t=arguments.length,e=Array(t),n=0;n<t;n++)e[n]=arguments[n];var i=e[0],r=this;return new Promise(function(t,n){var o=r._ensureStartableCanBeStopped();if(o)return r.triggerMethod("stop:decline",o),void n(o);var s=r.isStopNotAllowed(i);if(s)return r.triggerMethod("stop:decline",s),void n(s);var a=r._getLifeState(),l=r._getStopPromise();r.triggerMethod.apply(r,["before:stop"].concat(e)),l.then(function(){r._tryMergeStopOptions(i),r.once("stop",function(){return t.apply(void 0,arguments)}),r.triggerStop(i)},function(){r._setLifeState(a),n.apply(void 0,arguments)})})},triggerStop:function(t){this.triggerMethod("stop",t)},_setLifeState:function(t){this.setState("life",t)},_getLifeState:function(){return this.getState("life")},_isLifeState:function(t){return this._getLifeState()===t},_isLifeStateIn:function(){for(var t=this,e=arguments.length,i=Array(e),r=0;r<e;r++)i[r]=arguments[r];return n(i).some(function(e){return t._isLifeState(e)})},_isInProcess:function(){return this._isLifeStateIn(R,j)},_registerStartableLifecycleListeners:function(){var t=this,e=!0===this.getProperty("freezeWhileStarting");e&&n.isFunction(this.freezeUI)&&this.on("state:life:"+R,function(){t.freezeUI()}),e&&n.isFunction(this.unFreezeUI)&&this.on("start",function(){t.unFreezeUI()}),this.on("before:start",function(){return t._setLifeState(R)}),this.on("start",function(){return t._setLifeState(E)}),this.on("before:stop",function(){return t._setLifeState(j)}),this.on("stop",function(){return t._setLifeState(A)}),this.on("destroy",function(){return t._setLifeState(V)})},_tryMergeStartOptions:function(t){if(this.mergeOptions){var e=this.getProperty("mergeStartOptions")||[];this.mergeOptions(t,e)}},_tryMergeStopOptions:function(t){if(this.mergeOptions){var e=this.getProperty("mergeStopOptions")||[];this.mergeOptions(t,e)}},_ensureStartableIsIntact:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{throwError:!1},e=new O({name:"StartableLifecycleError",message:"Startable has already been destroyed and cannot be used."}),n=this._isLifeState(V);if(t.throwError&&n)throw e;if(n)return e},_ensureStartableIsIdle:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{throwError:!1},e="Startable is not idle. current state: "+this._getLifeState(),n=new O({name:"StartableLifecycleError",message:e}),i=this._ensureStartableIsIntact(t),r=this._isInProcess();if(t.throwError&&r)throw n;return i||(r?n:void 0)},_ensureStartableCanBeStarted:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{throwError:!1},e=new O({name:"StartableLifecycleError",message:"Startable has already been started."}),n=this._ensureStartableIsIdle(t),i=!0===this.getProperty("allowStartWithoutStop");if(n||!i){var r=this._isLifeState(E);if(t.throwError&&r)throw e;return n||(r?e:void 0)}},_ensureStartableCanBeStopped:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{throwError:!1},e=new O({name:"StartableLifecycleError",message:"Startable should be in `running` state."}),n=this._ensureStartableIsIdle(t),i=!0===this.getProperty("allowStopWithoutStart");if(n||!i){var r=this._isLifeState(E);if(t.throwError&&!r)throw e;return n||(r?void 0:e)}},_getStartPromise:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return Promise.all(this._getStartPromises(t))},_getStartPromises:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=[];return e.push(this._getStartParentPromise()),e.push(this._getStartPagePromise()),!0!==t.noruntime&&e.push(this._getStartRuntimePromise()),e},_getStartRuntimePromise:function(){return T(this,"startRuntimePromises")},_getStartPagePromise:function(){return T(this,"startPromises")},_getStartParentPromise:function(){var t=n.result(this,"getParent");if(n.isObject(t)&&n.isFunction(t._getStartPromise))return t._getStartPromise({noruntime:!0})},_getStopPromise:function(){return Promise.all(this._getStopPromises())},_getStopPromises:function(){var t=[];return t.push(this._getStopRuntimePromise()),t},_getStopRuntimePromise:function(){return T(this,"stopPromises")},_getStopParentPromise:function(){var t=n.result(this,"getParent");if(n.isObject(t)&&n.isFunction(t._getStopPromise))return t._getStopPromise()}});return i.Startable=!0,i},F=function(t){var e="_children",i=t.extend({constructor:function(){for(var e=arguments.length,n=Array(e),i=0;i<e;i++)n[i]=arguments[i];t.apply(this,n),this.initializeChildrenable.apply(this,n)},initializeChildrenable:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this._initializeParrent(t),this._initializeChildren(t)},hasChildren:function(){this.getChildren();return this[e].length>0},getChildren:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{startable:!0},n=this[e]||[];return t.startable?n.filter(function(t){return!t.getProperty("isStartNotAllowed")}):n},hasParent:function(){var t=this.getParent();return n.isObject(t)},getParent:function(){return this.getProperty("parent",{deep:!1})},_initializeChildren:function(){var t=this,i=this.getProperty("children"),r=[];n(i).each(function(e){var n=t._normalizeChildContext(e),i=t._initializeChild(n);i&&r.push(i)}),this[e]=r},_initializeChild:function(t){if(null!=t&&n.isFunction(t.Child)){var e=t.Child,i=this._normalizeChildOptions(t);return this.buildChild(e,i)}},_normalizeChildContext:function(t){var e={};return n.isFunction(t)&&t.Childrenable?n.extend(e,{Child:t}):n.isFunction(t)?e=this._normalizeChildContext(t.call(this)):n.isObject(t)&&(e=t),e},_normalizeChildOptions:function(t){var e=n.extend({},t);return!0===this.getOption("passToChildren")&&n.extend(e,this.options),e.parent=this,delete e.Child,this._buildChildOptions(e)},_buildChildOptions:function(t){return n.extend(t,this.getProperty("childOptions"))},buildChild:function(t,e){return new t(e)},_initializeParrent:function(t){null==this.parent&&null!=t.parent&&(this.parent=t.parent)}});return i.Childrenable=!0,i},H=[function(t){return{_v:t,_m:t.model||{},_cid:function(e){return u(t.cid,e)}}}],B={},N=!1;var I={mix:function(t){for(var e=arguments.length,i=Array(e>1?e-1:0),r=1;r<e;r++)i[r-1]=arguments[r];var o=this.get.apply(this,i);return n.extend(o,t)},get:function(){return this.compile.apply(this,arguments)},add:function(){for(var t=this,e=arguments.length,i=Array(e),r=0;r<e;r++)i[r]=arguments[r];n(i).each(function(e){return t.push(e)})},compile:function(){for(var t=arguments.length,e=Array(t),i=0;i<t;i++)e[i]=arguments[i];N&&(B={});var r={};return n(H).each(function(t){n.isFunction(t)?n.extend(r,function(t){for(var e=arguments.length,i=Array(e>1?e-1:0),r=1;r<e;r++)i[r-1]=arguments[r];return n.isFunction(t)?t.apply(void 0,i):n.isObject(t)?t:{}}.apply(void 0,[t].concat(e))):N&&n.extend(B,t)}),N||n.extend(r,B),N=!1,r},pop:function(){return N=!0,H.pop()},shift:function(){return N=!0,H.shift()},push:function(t){N=!0,H.push(t)},unshift:function(t){N=!0,H.unshift(t)},clear:function(){N=!1,B={},H=[]}},G=function(t){return t.extend({mixinTemplateContext:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=I.mix(n.result(this,"templateContext"),this);return n.extend(t,e)}})},U={GetNameLabel:C,GetOptionProperty:P,Radioable:M,Stateable:k,Startable:L,Childrenable:F,GlobalTemplateContext:G},Y=S(e.Behavior).with(P),W=Y.extend({listenViewInitialize:!0,constructor:function(){!0===this.getProperty("listenViewInitialize")&&this.on("before:render initialize",n.once(n.partial(this.triggerMethod,"view:initialize"))),Y.apply(this,arguments)},getModel:function(){return this.view.model},cidle:function(t){return _.wrap(this.view.cid,t)},unCidle:function(t){return _.unwrap(t,this.view.cid)}}),X=W.extend({triggerEl:void 0,moveBeforeStart:10,scope:"drag",getDragEventsContext:function(){return this.$doc},getDragEventsElementSelector:function(){return"*"},getTriggerEl:function(){if(this._$el)return this._$el;var t=this.getOption("triggerEl");if(null==t&&this.view.$el)this._$el=this.view.$el;else if(t&&t.jquery)this._$el=t;else if(t instanceof HTMLElement)this._$el=$(t);else{if("string"!=typeof t||!t.length)throw new Error("trigger element should be a DOM or jQuery object or string selector.",t);this._$el=this.view.$(t)}return this._$el},isSameScope:function(t){return t.scope===this.scope},shouldHandleDomEvents:function(t){return this.isSameScope(t)&&this!==t},constructor:function(){this._clearDragData(),this.$doc=$(document);for(var t=arguments.length,e=Array(t),n=0;n<t;n++)e[n]=arguments[n];W.apply(this,e),this._defineDocumentBindings()},_clearDragData:function(){this._dragData={}},_defineDocumentBindings:function(){this.__b={},this.__b.setupDragDetection=n.bind(this._setupDragDetection,this),this.__b.handleMouseUp=n.bind(this._handleMouseUp,this),this.__b.handleMoveAfterMouseDown=n.bind(this._handleMoveAfterMouseDown,this),this.__b.handleDragMove=n.bind(this._handleDragMove,this),this.__b.handleElementEnter=n.bind(this._handleElementEnter,this),this.__b.handleElementLeave=n.bind(this._handleElementLeave,this),this.__b.handleElementOver=n.bind(this._handleElementOver,this)},onInitialize:function(){this._initializeDragListener()},_initializeDragListener:function(){this.getTriggerEl().one("mousedown",this.__b.setupDragDetection)},_setupDragDetection:function(t){!0!==this.view.dragDisabled?(t.stopPropagation(),this.$doc.one("mouseup",this.__b.handleMouseUp),this._dragData.startX=t.pageX,this._dragData.startY=t.pageY,this.$doc.on("mousemove",this.__b.handleMoveAfterMouseDown)):this._initializeDragListener()},_handleMouseUp:function(t){this._dragData.dragging?this._handleDragEnd(t):this._handleEndWithoutDrag(t),this._initializeDragListener()},_handleEndWithoutDrag:function(t){this.$doc.off("mousemove",this.__b.handleMoveAfterMouseDown)},_handleDragEnd:function(t){this._dragData.dragging=!1,this.$doc.off("mousemove",this.__b.handleDragMove);var e=this.getDragEventsContext();e.off("mouseenter",this.__b.handleElementEnter),e.off("mousemove",this.__b.handleElementOver),this._dragData.drop&&this._dragData.drop.context&&(this._dragData.drop.context.catchDraggable(this,this._dragData.drop),this.triggerMethod("drag:drop",this._dragData.drop)),this.triggerMethod("drag:end")},_handleMoveAfterMouseDown:function(t){t.stopPropagation();this._getStartPositionPixelOffset(t)>=this.getOption("moveBeforeStart")&&this._startDragSession()},_getStartPositionPixelOffset:function(t){var e=Math.abs(t.pageX-this._dragData.startX),n=Math.abs(t.pageY-this._dragData.startY);return e>n?e:n},_startDragSession:function(){this._dragData.dragging=!0,this.$doc.off("mousemove",this.__b.handleMoveAfterMouseDown),this.$doc.on("mousemove",this.__b.handleDragMove);var t=this.getDragEventsContext(),e=this.getDragEventsElementSelector();t.on("mouseenter",e,this.__b.handleElementEnter),t.on("mousemove",e,this.__b.handleElementOver),this.view.triggerMethod("drag:start")},_handleDragMove:function(t){t.stopPropagation(),this.triggerMethod("drag",t)},_handleElementEnter:function(t){var e=this,n=$(t.target);this._dragData.over!=n&&(this._dragData.over=n,n.trigger("drag:enter",this),n.one("mouseleave",function(){return e.trigger("drag:leave",e)}))},_handleElementLeave:function(t){$(t.target).trigger("drag:leave",this)},_handleElementOver:function(t){var e=$(t.target),n=this._createCustomDomEvent("drag:over",t);e.trigger(n,this)},_createCustomDomEvent:function(t,e,i){i||(i=["pageX","pageY","clientX","clientY","offsetX","offsetY","target"]);var r=jQuery.Event(t);return n(i).each(function(t){return r[t]=e[t]}),r}}),q=X.extend({useGhost:!0,viewCssClass:"dragging",ghostCssClass:"ghost",constructor:function(){for(var t=arguments.length,e=Array(t),n=0;n<t;n++)e[n]=arguments[n];X.apply(this,e),this.on("drag",this._onDrag),this.on("drag:start",this._onDragStart),this.on("drag:end",this._onDragEnd)},events:{"drag:enter":function(t,e){this.shouldHandleDomEvents(e)},"drag:over":function(t,e){if(this.isSameScope(e)){t.stopPropagation();var n=this._createCustomDomEvent("drag:over",t),i=this.$el.parent();i&&i.trigger(n,[e,this])}}},_onDragEnd:function(t){this.getOption("useGhost")&&this._removeGhost(),this.getOption("viewCssClass")&&this.view.$el.removeClass(this.getOption("viewCssClass")),this._clearDragData()},_onDragStart:function(t){this.getOption("useGhost")&&this._createGhost(),this.getOption("viewCssClass")&&this.view.$el.addClass(this.getOption("viewCssClass"))},_onDrag:function(t){this.setGhostPosition(t.pageY,t.pageX)},_removeGhost:function(){this.$ghost.remove(),delete this.$ghost},createGhost:function(){var t=this.$el.clone(),e=this.$el.offset(),n=e.top,i=e.left;return t.css({top:n+"px",left:i+"px",width:this.$el.outerWidth(),height:this.$el.outerHeight()}),t},_createGhost:function(){var t=this.createGhost();"absolute"!=t.css("position")&&t.css("position","absolute");var e=this.getOption("ghostCssClass");e&&t.addClass(e),t.appendTo($("body")),this._setGhost(t)},_setGhost:function(t){this.$ghost=t},getGhost:function(){return this.$ghost},setGhostPosition:function(t,e){var n=this.getGhost();n&&n.css({top:t+"px",left:e+"px"})}}),Q=W.extend({scope:"drag",events:{"drag:over":"_onDomDragOver"},_skipFirstAttach:!0,isSameScope:function(t){return t.scope===this.scope},getEventXY:function(t){return{x:t.pageX,y:t.pageY}},getChildren:function(){return n(this.view.children._views).filter(function(t){return t.model&&t.isRendered()&&t.isAttached()})},catchDraggable:function(t,e){this._onDrop(t,e)},constructor:function(){for(var t=arguments.length,e=Array(t),n=0;n<t;n++)e[n]=arguments[n];W.apply(this,e),this._initReorderBehavior()},_initReorderBehavior:function(){var t=this;this.listenToOnce(this.view,"render",function(){t.reOrder({silent:!0}),t.listenTo(t.view.collection,"update",function(t,e){(e||{}).changes;this.reOrder()})})},reOrder:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this.view.sort();var e=this.children=[],i=this._skipFirstAttach;n(this.view.children._views).each(function(t,n){t.model&&(t.model.set("order",n),t.isRendered()&&(i||t.isAttached())&&e.push(t))}),this.hasChildren=this.children.length>0,1!=t.silent&&this.view.collection&&this.view.collection.trigger("reordered"),this._skipFirstAttach=!1},_onDomDragOver:function(t,e,i){if(this.isSameScope(e)&&(t.stopPropagation(),e!==i&&(!this.hasChildren||i))){e._dragData.drop||(e._dragData.drop={});var r=e._dragData.drop,o=this.getEventXY(t),s=this._getDropContext(o,i);s.context=this;var a=n.extend({},r,s),l=n.keys(a);n(l).some(function(t){return r[t]!==s[t]})&&(e._dragData.drop=s,this._onDropContextChange(e,s))}},_getDropContext:function(t,e){if(!(this.children||[]).length)return{insert:"before"};var n=e?e.$el:this.$el,i=this._getPositionByEventXY(t,n);return this._getDropContextByPosisiton(i,e)},_getPositionByEventXY:function(t,e){var n=e.offset(),i=e.outerWidth(),r=e.outerHeight(),o=n.left+i/2,s=n.top+r/2,a={x:void 0,y:void 0};return a.x=t.x<=o?"left":"right",a.y=t.y<=s?"top":"bottom",a},_getDropContextByPosisiton:function(t,e){var i="horizontal"==(this.getOption("direction")||"vertical")?"left"==t.x?"before":"after":"top"==t.y?"before":"after",r=void 0;return{insert:i,childView:r=e?e.view:"before"==i?this.children[0]:this.children.length&&n(this.children).last(),index:this.view.children._views.indexOf(r),noChild:!e}},_onDropContextChange:function(t,e){this.triggerMethod("drop:context:change",t,e)},_onDrop:function(t,e){this.triggerMethod("drop",t,e)}}),J=W.extend({updateElementClass:function(t){var e=n.result(this.view,"className")||"",i=n.result(this.view,"dynamicClassName")||"";this.$el.attr({class:(e+" "+i).trim()})},refreshOnModelChange:!0,refreshOnDomChange:!1,refreshOnViewRefresh:!0,refreshOnViewBeforeRender:!0,refreshOnViewRender:!1,modelEvents:{change:function(){this.getProperty("refreshOnModelChange")&&this.updateElementClass("model:change")}},events:{change:function(){this.getProperty("refreshOnDomChange")&&this.updateElementClass("dom:change")}},onRefresh:function(){this.getProperty("refreshOnViewRefresh")&&this.updateElementClass("view:refresh")},onRender:function(){this.getProperty("refreshOnViewRender")&&this.updateElementClass("view:render")},onBeforeRender:function(){this.getProperty("refreshOnViewBeforeRender")&&this.updateElementClass("view:before:render")},onRefreshCssClass:function(){this.updateElementClass()},onSetupRefreshCssClass:function(t){var e=this;null!=t&&n.isObject(t)&&n(t).each(function(t,n){e[n]=!0===t})}});function K(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}var Z=S(W).with(k).extend({applyDelay:1,autoApplyToModel:!1,autoChangeModel:!1,fillFormFromModel:!0,applySelector:".apply",cancelSelector:".cancel",resetSelector:".reset",initialize:function(t){this.applyValue=n.debounce(this._applyValue,this.getProperty("applyDelay")),this.mergeOptions(t,["values"]),this.extendDefaultValues({})},extendDefaultValues:function(t){this._values=n.extend(this._values||{},t)},onViewInitialize:function(){var t=this.getModel();t&&this.extendDefaultValues(t.toJSON())},onRender:function(){this.firstRender||(this.buildFormBindings(),this.setState(this._tryFlatValues(this._values)),this.setValuesToForm(this.getValues({raw:!0}))),this.firstRender=!0},triggers:function(){var t;return K(t={},"click "+this.getProperty("applySelector"),"trigger:apply"),K(t,"click "+this.getProperty("cancelSelector"),"trigger:cancel"),K(t,"click "+this.getProperty("resetSelector"),"trigger:reset"),t},_tryFlatValues:function(t){return v(t)},_tryUnFlatValues:function(t){return m(t)},rollbackToDefaultValues:function(){this.clearState();var t=this._values,e=this._tryFlatValues(t);this.setState(e)},getValues:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=this.getState();if(t.raw)return e;return this._tryUnFlatValues(e)},onTriggerApply:function(){this._apply()},onTriggerCancel:function(){this._cancel()},onTriggerReset:function(){this._reset()},_apply:function(){var t=this.getValues();this.view.triggerMethod("values:apply",t),this._tryChangeModel(t)},_cancel:function(){this.rollbackToDefaultValues();var t=this._getFullHash(this._values);this.view.triggerMethod("values:cancel",t),this.setValuesToForm(t),this._tryChangeModel(t,{clear:!0})},_reset:function(){this.clearState();var t=this._getFullHash({});this.view.triggerMethod("values:reset",t),this.setValuesToForm(t),this._tryChangeModel(t,{clear:!0})},onState:function(t){this._tryChangeModel(t,{type:"property"})},_tryChangeModel:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n="property"===e.type?"autoChangeModel":"autoApplyToModel";if(!0===this.getProperty(n)){var i=this.getModel();i&&(t=this._tryUnFlatValues(t),!0===e.clear&&i.clear(),i.set(t))}},_getFullHash:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=this.getModel()&&this.getModel().toJSON(),i=n.extend({},this.values,this.mappings,e),r={};return n(i).each(function(t,e){return r[e]=void 0}),n.extend(r,t)},buildFormBindings:function(){var t=this;this.mappings={};var e=["input","textarea","select"];this.$("[name]").each(function(n,i){if(-1!=e.indexOf(i.tagName.toLowerCase())){var r=t.unCidle(i.name);if(!(r in t.mappings)){var o=t._getElementInfo(i,e);o&&(t.mappings[r]=o)}}});var i={};n(this.mappings).each(function(t,e){t.values&&(i[e]=t.values)}),this.extendDefaultValues(i)},_getElementInfo:function(t,e){var n={name:t.name},i=void 0,r='[name="'+t.name+'"]',o=this.$(r);if(o.length){if(o.length>1){var s=[],a=!1;o.each(function(t,n){if(-1!=e.indexOf(n.tagName.toLowerCase())){var i=$(n);if("checkbox"!=n.type&&"radio"!=n.type||i.prop("checked")){var r=i.val();a||(a="checkbox"===n.type||r instanceof Array),r instanceof Array?s=s.concat(r):s.push(i.val())}}}),i=!s.length||1===s.length&&!a?s[0]:s}else i="checkbox"===o.get(0).type?o.prop("checked")?[o.val()]:[]:o.val();return n.values=i,n.isArray=i instanceof Array,n.$elements=o,n}},setValuesToForm:function(t){var e=this;n(t).each(function(t,n){var i=e.mappings[n].$elements,r=t instanceof Array?t:[t];i.each(function(t,n){e._setValueToElement(n,t,r)})})},_setValueToElement:function(t,e,n){var i=e<n.length&&n[e],r=t.jquery?t:$(t);"checkbox"===(t=r.get(0)).type||"radio"===t.type?r.prop("checked",n.indexOf(r.val())>=0):r.val(i)},events:{change:"domChange",input:"domInput"},domChange:function(t){this.applyValue(t.target.name,t.target,t)},domInput:function(t){this.applyValue(t.target.name,t.target,t)},_applyValue:function(t,e,n){"checkbox"==e.type?this._applyCheckboxValue(t,e,n):this._applySimpleValue(t,e,n)},_applySimpleValue:function(t,e,n){t=this.unCidle(t);var i=$(e);this.setState(t,i.val())},_applyCheckboxValue:function(t,e,n){var i='input[type=checkbox][name="'+t+'"]:checked',r=this.$(i).map(function(t,e){return e.value}).toArray();t=this.unCidle(t),this.setState(t,r)}}),tt={Behavior:W,Draggable:q,Droppable:Q,DynamicClass:J,FormToHash:Z},et=S(e.Object).with(P,M),nt=S(et).with(k),it=$&&$.ajax,rt=new(nt.extend({constructor:function(){for(var t=arguments.length,e=Array(t),n=0;n<t;n++)e[n]=arguments[n];nt.apply(this,e),this._initializeYatUser()},_initializeYatUser:function(){},channelName:"identity",tokenExpireOffset:12e4,isAnonym:function(){return!this.getState("id")},isUser:function(){return!this.isAnonym()},isMe:function(t){return t&&this.getState("id")===t},update:function(t){this.setState(t),this.trigger("change")},logIn:function(t){t.id&&(this.update(t),this.trigger("log:in"))},logOut:function(){this.clearState(),this.trigger("change"),this.trigger("log:out")},getBearerToken:function(t){var e=this,n=this.getOption("bearerTokenUrl");return new Promise(function(i,r){it({url:n,data:t,method:"POST"}).then(function(t){e.setTokenObject(t),i(t),e.triggerMethod("token",t)},function(t){return r(t)})})},ajax:function(){for(var t=arguments.length,e=Array(t),i=0;i<t;i++)e[i]=arguments[i];var r=e[0];r.headers=n.extend({},r.headers,this.getAjaxHeaders());if(this.isTokenRefreshNeeded())return this.refreshBearerToken().then(function(){return it.apply($,e)}).catch(function(t){var e=$.Deferred();return e.reject(t),e});var o;return(o=$).ajax.apply(o,e)},getAjaxHeaders:function(){return this._ajaxHeaders||(this._ajaxHeaders={}),this._ajaxHeaders},_updateHeaders:function(){var t=this.getTokenValue(),e=this.getAjaxHeaders();t?(e.Authorization="Bearer "+t,e.Accept="application/json"):delete e.Authorization},setTokenObject:function(t){null!=t&&n.isObject(t)&&(t.expires=new Date(Date.now()+1e3*t.expires_in)),this._token=t,this._updateHeaders(),this._replaceBackboneAjax(),this.triggerMethod("tocken:change")},getTokenObject:function(){return this._token},_replaceBackboneAjax:function(){var e=this.getTokenValue();t.ajax=e?function(){var t;return(t=Yat.identity).ajax.apply(t,arguments)}:$.ajax},getTokenValue:function(){return this.getTokenObject().access_token},getRefreshToken:function(){return this.getTokenObject().refresh_token},getTokenExpires:function(){return(this.getTokenObject()||{}).expires},getTokenSeconds:function(){var t=this.getTokenExpires();if(null==t||isNaN(t.valueOf()))return console.warn("expires is null or wrong"),0;var e=this.getProperty("tokenExpireOffset");null==e&&(e=3e4);var n=t.valueOf()-e-Date.now();return n>0?n/1e3:0},isTokenRefreshNeeded:function(){return!!this.getTokenValue()&&!this.getTokenSeconds()},refreshBearerToken:function(){var t=this,e=this.getProperty("bearerTokenRenewUrl")||this.getProperty("bearerTokenUrl"),n=this.isTokenRefreshNeeded();return new Promise(function(i,r){if(n)if(null!=e){var o={grant_type:"refresh_token",refresh_token:t.getRefreshToken()};it({url:e,data:o,method:"POST"}).then(function(e){t.setTokenObject(e),i()},function(){t.triggerMethod("refresh:token:expired"),r(Yat.Error.Http401())})}else r(new Error("Token expired and `bearerTokenRenewUrl` not set"));else i()})}})),ot=S(e.View).with(G,P).extend({instantRender:!1,renderOnReady:!1,triggerReady:!1,manualAfterInitialize:!0,constructor:function(){for(var t=arguments.length,n=Array(t),i=0;i<t;i++)n[i]=arguments[i];e.View.apply(this,n);var r=n[0];this.mergeOptions(r,["instantRender","renderOnReady","triggerReady","manualAfterInitialize"]),!0===this.manualAfterInitialize&&this._afterInitialize()},_afterInitialize:function(){!0===this.instantRender&&this.render(),!0===this.renderOnReady&&this.once("ready",this.render),!0!==this.renderOnReady&&!0!==this.triggerReady||this.trigger("ready",this)}}),st=et.extend({initialize:function(t){this.mergeOptions(t,["name","channelName","noRadio"]),!0!==this.noRadio&&null==this.channelName&&(this.channelName=name)},getStore:function(){return this.store||(this.store={}),this.store},radioRequest:{get:function(){this.get.apply(this,arguments)},set:function(t,e){this.set(t,e)}},get:function(t){var e=f(this.getStore(),t);if(n.isFunction(e)){for(var i=arguments.length,r=Array(i>1?i-1:0),o=1;o<i;o++)r[o-1]=arguments[o];e=e.apply(this,r)}return e},set:function(t,e){var n=this.getStore();d(n,t,e);this.triggerSet(t,e)},triggerSet:function(t,e){if(t){var n=t.split("/"),i=this.getChannel();do{var r=n.join(":");this.triggerMethod(r,e),i&&i.trigger(r,e),n.pop()}while(n.length>0)}}});function at(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return e.name=t,new st(e)}var lt=new at("yat:modals:singleton",{noRadio:!0}),ht={bg:!0,close:!0},ut={closeOnClickOutside:!0,closeOnPromise:!0,preventClose:!1,asPromise:!1},ct={wrapper:"yat-modal-wrapper",bg:"yat-modal-bg",contentWrapper:"yat-modal-content-wrapper",close:"yat-modal-close",header:"yat-modal-header",content:"yat-modal-content",actions:"yat-modal-actions",resolve:"yat-modal-resolve",reject:"yat-modal-reject"},gt={close:"&times;",resolve:"ok",reject:"cancel"},dt={full:{css:ct,show:ht,labels:gt,options:ut},simple:{css:ct,show:{bg:!1,close:!1},labels:gt,options:ut},confirm:{css:ct,show:ht,labels:gt,options:{closeOnClickOutside:!0,closeOnPromise:!0,preventClose:!1,asPromise:!0}}};lt.set("types.full",dt.full),lt.set("types.simple",dt.simple),lt.set("types.confirm",dt.confirm),lt.set("defaultShow",ht),lt.set("defaultCss",ct),lt.set("defaultLabels",gt);var ft=n.template("<% if(show.bg) {%><div <%= css('bg') %> data-role=\"modal-bg\"></div><% } %>\n<div <%= css('contentWrapper') %> data-role=\"modal-content-wrapper\">\n\t<% if(show.close) {%><button  <%= css('close') %> data-role=\"modal-close\"><%= label('close') %></button><% } %>\n\t<% if(show.header) {%><header <%= css('header') %> data-role=\"modal-header\"><%= header %></header><% } %>\n\t<div <%= css('content') %> data-role=\"modal-content\"><%= text %></div>\n\t<% if(show.actions) {%>\n\t<div <%= css('actions') %> data-role=\"modal-actions\">\n\t\t<% if(show.resolve) {%><button <%= css('resolve') %> data-role=\"modal-resolve\"><%= label('resolve') %></button><% } %>\n\t\t<% if(show.reject) {%><button <%= css('reject') %> data-role=\"modal-reject\"><%= label('reject') %></button><% } %>\n\t</div>\n\t<% } %>\n</div>\n"),pt=S(ot).with(P).extend({renderOnReady:!0,template:ft,attributes:function(){return{"data-role":"modal-wrapper"}},initialize:function(t){var e=this;this.mergeOptions(t,["content","header","text"]);var n=this;!0===this.getOption("asPromise")&&(this.promise=new Promise(function(t,e){n.once("resolve",function(e){return t(e)}),n.once("reject",function(t){return e(t)})})),this.once("resolve reject",function(t,n){e.preventClose=!1,e.getConfigValue("options","closeOnPromise")&&!n&&e.destroy()})},canBeClosed:function(){return!0!==this.getConfigValue("options","preventClose")},destroy:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if(this.canBeClosed()||!0===t.force)return ot.prototype.destroy.apply(this,arguments)},ui:{bg:'[data-role="modal-bg"]',contentWrapper:'[data-role="modal-content-wrapper"]',text:'[data-role="modal-content"]',header:'[data-role="modal-header"]',close:'[data-role="modal-close"]',resolve:'[data-role="modal-resolve"]',reject:'[data-role="modal-reject"]'},triggers:{"click @ui.close":{event:"click:close",stopPropagation:!0},"click @ui.reject":{event:"click:reject",stopPropagation:!0},"click @ui.resolve":{event:"click:resolve",stopPropagation:!0},"click @ui.text":{event:"click:content",stopPropagation:!0},"click @ui.contentWrapper":{event:"click:content:wrapper",stopPropagation:!0},"click @ui.bg":{event:"click:bg",stopPropagation:!0},click:{event:"click:wrapper",stopPropagation:!0}},regions:{content:'[data-role="modal-content"]'},onBeforeDestroy:function(){this.trigger("reject",this.getProperty("reject"),!0)},onClickClose:function(){this.destroy()},onClickResolve:function(){this.trigger("resolve",this.getProperty("resolve"))},onClickReject:function(){this.trigger("reject",this.getProperty("reject"))},onClickBg:function(){this.clickedOutsideOfModal()},onClickWrapper:function(){this.clickedOutsideOfModal()},clickedOutsideOfModal:function(){!0===this.getConfigValue("options","closeOnClickOutside")&&this.destroy()},onBeforeRender:function(){var t=this.getConfig();t.css.wrapper&&this.$el.addClass(t.css.wrapper),this.$el.appendTo($("body"))},onRender:function(){this.content instanceof t.View&&(this.showChildView("content",this.content),this.content.inModal=this)},_getModalOptions:function(){var t={};return null!=this.getOption("closeOnClickOutside")&&(t.closeOnClickOutside=this.getOption("closeOnClickOutside")),null!=this.getOption("closeOnPromise")&&(t.closeOnPromise=this.getOption("closeOnPromise")),null!=this.getOption("preventClose")&&(t.preventClose=this.getOption("preventClose")),null!=this.getOption("asPromise")&&(t.asPromise=this.getOption("asPromise")),t},getConfigValue:function(t,e){return((this.getConfig()||{})[t]||{})[e]},getConfig:function(t){if(this.config)return this.config;var e=this.getOption("type")||"simple",i=n.extend({},lt.get("types."+e)||{});return i.show=n.extend({},lt.get("dafaultShow"),i.show,this.getOption("show")),i.labels=n.extend({},lt.get("defaultLabels"),i.labels,this.getOption("labels")),i.css=n.extend({},lt.get("defaultCss"),i.css,this.getOption("css")),i.options=n.extend({},lt.get("defaultOptions"),i.options,this._getModalOptions()),null==i.show.header&&this.getOption("header")&&(i.show.header=!0),null==i.show.resolve&&(this.getOption("resolve")||i.options.asPromise)&&(i.show.resolve=!0),null==i.show.reject&&this.getOption("reject")&&(i.show.reject=!0),null==i.show.actions&&(i.show.resolve||i.show.reject)&&(i.show.actions=!0),this.config=i},templateContext:function(){var t=this.getConfig();return{css:function(e){return t.css[e]?' class="'+t.css[e]+'"':""},label:function(e){return t.labels[e]||""},show:t.show,text:this.getOption("text"),header:this.getOption("header")}}}),vt=new(S(et).with(k).extend({constructor:function(){var t=this;this.modals=[];for(var e=arguments.length,r=Array(e),o=0;o<e;o++)r[o]=arguments[o];et.apply(this,r),this.listenForEsc=n.bind(this._listenForEsc,this),i(function(){t.doc=i(document),t.doc.on("keyup",t.listenForEsc)})},channelName:"modals",show:function(){var t=this._normalizeArguments.apply(this,arguments);return this._create(t)},remove:function(t){t||(t=n.last(this.modals)),t&&t.destroy()},_listenForEsc:function(t){27===t.keyCode&&this.modals.length&&this.remove()},_create:function(t){var e=new pt(t),n=this;return this.listenToOnce(e,"destroy",function(){n._remove(e)}),this.modals.push(e),e},_remove:function(t){if(t){var e=this.modals.indexOf(t);e>-1&&this.modals.splice(e,1),this.stopListening(t)}},_normalizeArguments:function(){var t={},e=arguments.length;if(e){if(1===e)_.isView(arguments.length<=0?void 0:arguments[0])?t.content=arguments.length<=0?void 0:arguments[0]:n.isString(arguments.length<=0?void 0:arguments[0])?t.text=arguments.length<=0?void 0:arguments[0]:n.isObject(arguments.length<=0?void 0:arguments[0])&&n.extend(t,arguments.length<=0?void 0:arguments[0]);else if(2===e)n.isString(arguments.length<=0?void 0:arguments[0])&&n.isString(arguments.length<=1?void 0:arguments[1])?(t.header=arguments.length<=0?void 0:arguments[0],t.text=arguments.length<=1?void 0:arguments[1]):n.isString(arguments.length<=0?void 0:arguments[0])&&_.isView(arguments.length<=1?void 0:arguments[1])?(t.header=arguments.length<=0?void 0:arguments[0],t.content=arguments.length<=1?void 0:arguments[1]):n.isString(arguments.length<=1?void 0:arguments[1])&&_.isView(arguments.length<=0?void 0:arguments[0])?(t.header=arguments.length<=1?void 0:arguments[1],t.content=arguments.length<=0?void 0:arguments[0]):n.isString(arguments.length<=0?void 0:arguments[0])&&n.isObject(arguments.length<=1?void 0:arguments[1])?(n.extend(t,arguments.length<=1?void 0:arguments[1]),_.isView(t.content)?t.header=arguments.length<=0?void 0:arguments[0]:t.text=arguments.length<=0?void 0:arguments[0]):_.isView(arguments.length<=0?void 0:arguments[0])&&n.isObject(arguments.length<=1?void 0:arguments[1])&&(n.extend(t,arguments.length<=1?void 0:arguments[1]),t.content=arguments.length<=0?void 0:arguments[0]);else{n.isObject(arguments.length<=3?void 0:arguments[3])&&n.extend(t,arguments.length<=3?void 0:arguments[3]),n.isObject(arguments.length<=2?void 0:arguments[2])?n.extend(t,arguments.length<=2?void 0:arguments[2]):n.isString(arguments.length<=2?void 0:arguments[2])&&(t.type=arguments.length<=2?void 0:arguments[2]);var i=this._normalizeArguments(arguments.length<=0?void 0:arguments[0],arguments.length<=1?void 0:arguments[1]);n.extend(t,i)}return t}},onBeforeDestroy:function(){this.doc&&this.doc.off("keyup",this.listenForEsc)}})),mt={show:function(){return vt.show.apply(vt,arguments)},addTypeConfig:function(t,e){t&&n.isString(t)&&lt.set("types."+t,e)},getTypeConfig:function(t){if(t&&n.isString(t))return lt.get("types."+t)}},_t={TemplateContext:I,identity:rt,modals:mt},yt=S(e.Application).with(P,M,F,L),bt=yt.extend({initRadioOnInitialize:!0,_initRegion:function(){if(!(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{skip:!0}).skip){var t=this.getProperty("region");this.region=t,yt.prototype._initRegion()}},getRegion:function(){return this._region||this._initRegion({skip:!1}),this._region},addPageManager:function(t){var e=this;this._pageManagers||(this._pageManagers=[]),this._pageManagers.push(t);var n=t.getName();n?(this.listenTo(t,"all",function(t){for(var i=arguments.length,r=Array(i>1?i-1:0),o=1;o<i;o++)r[o-1]=arguments[o];var s=n+":"+t;e.triggerMethod.apply(e,[s].concat(r))}),this.listenTo(t,"state:currentPage",function(){for(var t=arguments.length,n=Array(t),i=0;i<t;i++)n[i]=arguments[i];return e.triggerMethod.apply(e,["page:swapped"].concat(n))})):console.warn("pageManager prefix not defined")},hasPageManagers:function(){return this._pageManagers&&this._pageManagers.length>0},getMenuTree:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{rebuild:!1};if(this._menuTree&&!e.rebuild)return this._menuTree;var i=this._pageManagers||[],r=n(i).chain().map(function(t){return t.getLinks()}).flatten().value();return this._menuTree=new t.Collection(r),this._menuTree},getPage:function(t){if(this.hasPageManagers())return n(this._pageManagers).find(function(e){return e.getPage(t)})}}),wt=e.AppRouter.extend({},{create:function(t,e){var i={},r={},o=this;return n(t).each(function(t,n){i[n]=n,r[n]=function(){t.action.apply(t,arguments).catch(function(t){o._catchError(t,e)})}}),new this({controller:r,appRoutes:i})},_catchError:function(t,e){if(!e||!0===e.getProperty("throwChildErrors"))throw t;var n="error"+(t.status?":"+t.status.toString():"");e.triggerMethod("error",t,this),"error"!=n&&e.triggerMethod(n,t,this)}}),Ot=t.Model.extend({}),St=Ot.extend({defaults:{url:void 0,label:void 0,target:"_self",level:0},destroy:function(){this.id=null,Ot.prototype.destroy.apply(this,arguments)}});function xt(t){if(Array.isArray(t)){for(var e=0,n=Array(t.length);e<t.length;e++)n[e]=t[e];return n}return Array.from(t)}var Ct=S(bt).with(C),Pt=Ct.extend({constructor:function(){for(var t=arguments.length,e=Array(t),n=0;n<t;n++)e[n]=arguments[n];Ct.apply(this,e),this.initializeYatPage()},allowStopWithoutStart:!0,allowStartWithoutStop:!0,initializeYatPage:function(t){this.mergeOptions(t,["manager"]),this._initializeModels(t),this._initializeRoute(t),this._proxyEvents(),this._tryCreateRouter(),this._registerIdentityHandlers()},getLayout:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{rebuild:!1};return(!this._layoutView||t.rebuild||this._layoutView&&this._layoutView.isDestroyed&&this._layoutView.isDestroyed())&&this.buildLayout(),this._layoutView},buildLayout:function(){var t=this.getProperty("Layout");if(null!=t){var e=n.extend({},this.getProperty("layoutOptions"));this.model&&!e.model&&n.extend(e,{model:this.model}),this.collection&&!e.collection&&n.extend(e,{collection:this.collection});var i=this.buildLayoutOptions(e);return i.page=this,this._layoutView=new t(i),this._layoutView}},buildLayoutOptions:function(t){return t},addModel:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(t){this.model=t;var n=e.fetch||this.getOption("fetchModelOnAdd");void 0===n&&(n=this.getProperty("fetchDataOnAdd")),!0===n&&this.addStartPromise(t.fetch(e))}},addCollection:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(t){this.collection=t;var n=e.fetch||this.getOption("fetchCollectionOnAdd");void 0===n&&(n=this.getProperty("fetchDataOnAdd")),!0===n&&this.addStartPromise(t.fetch(e))}},freezeWhileStarting:!0,freezeUI:function(){},unFreezeUI:function(){},getRouteHash:function(){var t=[{},this._routeHandler].concat(this.getChildren({startable:!1}).map(function(t){return t.getRouteHash()}));return n.extend.apply(n,xt(t))},hasRouteHash:function(){return n.isObject(this.getRouteHash())},getLinkModel:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;if(this._canHaveLinkModel()){if(this._linkModel)return this._linkModel;var e=this.getRoute(),n=this.getLabel(),i=this._getSublinks(t);return this._linkModel=new St({url:e,label:n,level:t,children:i}),this._linkModel}},_canHaveLinkModel:function(){return!(!0===this.getProperty("skipMenu")||this.getProperty("isStartNotAllowed"))},_destroyLinkModel:function(){this._linkModel&&(this._linkModel.destroy(),delete this._linkModel)},getParentLinkModel:function(){var t=this.getParent();if(t&&t.getLinkModel){return t.getLinkModel()}},getNeighbourLinks:function(){var t=this.getLinkModel();if(t&&t.collection)return t.collection},getChildrenLinks:function(){var t=this.getLinkModel();if(t)return t.get("children")},_getSublinks:function(e){var i=this.getChildren();if(i&&i.length){var r=n(i).chain().filter(function(t){return!0!==t.getProperty("skipMenu")}).map(function(t){return t.getLinkModel(e+1)}).value();if(r.length){return new t.Collection(r)}}},_initializeModels:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this.addModel(t.model,t),this.addCollection(t.collection,t)},_initializeRoute:function(){var t=this.getRoute({asPattern:!0});if(null!=t){var e=this;this._routeHandler=(n={},i=t,r={context:e,action:function(){return e.start.apply(e,arguments)}},i in n?Object.defineProperty(n,i,{value:r,enumerable:!0,configurable:!0,writable:!0}):n[i]=r,n);var n,i,r}},getRoute:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{asPattern:!1},e=this.getProperty("relativeRoute"),n=this.getProperty("route"),i=this.getParent();if(null!=n){var r=n;if(e&&i&&i.getRoute){r=i.getRoute()+"/"+n}return this._normalizeRoute(r,t)}},_normalizeRoute:function(t,e){if(t=t.replace(/\/+/gim,"/").replace(/^\//,""),e.asPattern)return t;return t.replace(/\(\/\)/gim,"/").replace(/\/+/gim,"/")},_tryCreateRouter:function(){!0===this.getProperty("createRouter")&&(this.router=this._createAppRouter())},_createAppRouter:function(){var t=this.getRouteHash();if(n.size(t))return new wt(t)},_proxyEvents:function(){var t=this._getProxyContexts();this._proxyEventsTo(t)},_getProxyContexts:function(){var t=[],e=this.getProperty("manager");e&&t.push({context:e});var n=this.getChannel();if(n){var i=this.getProperty("proxyEventsToRadio");t.push({context:n,allowed:i})}return t},_proxyEventsTo:function(t){var e=[],i={};n(t).each(function(t){t.allowed?n(t.allowed).each(function(e){i[e]||(i[e]=[]),i[e].push(t.context)}):e.push(t.context)});var r=this;r.on("all",function(t){for(var o=arguments.length,s=Array(o>1?o-1:0),a=1;a<o;a++)s[a-1]=arguments[a];var l=t in i?i[t]:e,h=[r].concat(s);n(l).each(function(e){return e.triggerMethod.apply(e,["page:"+t].concat(xt(h)))})})},_buildChildOptions:function(t){var e={},i=this.getProperty("manager");return i&&(e.manager=i),n.extend(t,this.getProperty("childOptions"),e)},_registerIdentityHandlers:function(){var t=this;this.listenTo(rt,"change",function(){for(var e=arguments.length,n=Array(e),i=0;i<e;i++)n[i]=arguments[i];t._destroyLinkModel(),t.triggerMethod.apply(t,["identity:change"].concat(n))})}}),Mt=S(bt).with(C),kt=Mt.extend({constructor:function(){for(var t=arguments.length,e=Array(t),n=0;n<t;n++)e[n]=arguments[n];Mt.apply(this,e),this._initializeYatPageManager.apply(this,e)},throwChildErrors:!0,createRouter:function(){var t=this.getChildren({startable:!1}),e={};n(t).each(function(t){n.isFunction(t.getRouteHash)&&n.extend(e,t.getRouteHash())}),this._routesHash=e,this.setRouter(wt.create(e,this))},setRouter:function(t){this.router=t},getRouter:function(){return this.router},getLinks:function(){var t=this.getChildren();if(t)return n(t).chain().map(function(t){return t.getLinkModel()}).filter(function(t){return!!t}).value()},execute:function(t){var e=this.getPage(t);if(e)e.start({text:error.message});else{if("*NotFound"===t)throw new O.NotFound("*NotFound handler is missing");this.execute("*NotFound")}},navigate:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{trigger:!0},n=this.getRouter();n?n.navigate(t,e):console.warn("router not found")},getPage:function(t){var e=n(this._routesHash).find(function(e,n){return n===t||(e.context.getName()===t||void 0)});return e&&e.context},navigateToRoot:function(){var t=this.getState("currentPage"),e=this.getProperty("rootUrl");if(!e){var n=this.getChildren();if(n&&n.length){var i=n.find(function(e){return e!=t});e=i&&i.getRoute()}}null!=e?this.navigate(e):console.warn("root page not found")},_initializeYatPageManager:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this.mergeOptions(t,["id","name","label"]),this._registerPageHandlers(t),this._registerIdentityHandlers(),this.createRouter()},_buildChildOptions:function(t){return n.extend(t,this.getProperty("childOptions"),{manager:this})},_registerPageHandlers:function(){this.on("page:before:start",this._pageBeforeStart),this.on("page:start",this._pageStart),this.on("page:start:decline",this._pageDecline)},_pageBeforeStart:function(t){var e=this.getState("currentPage");e&&e!=t&&e.stop()},_pageStart:function(t){this.setState("currentPage",t)},_pageDecline:function(){},_registerIdentityHandlers:function(){var t=this;this.listenTo(rt,"change",function(){for(var e=arguments.length,n=Array(e),i=0;i<e;i++)n[i]=arguments[i];t.triggerMethod.apply(t,["identity:change"].concat(n)),t._moveToRootIfCurrentPageNotAllowed()})},_moveToRootIfCurrentPageNotAllowed:function(){var t=this.getState("currentPage");t&&t.isStartNotAllowed()&&this.navigateToRoot()}}),Dt=S(e.NextCollectionView).with(G),Rt=t.Collection.extend({}),Et=et.extend({collection:void 0,groupBy:void 0,getGroups:function(){return this.groups},getGroup:function(t){return this.getGroups()[t]},isGroupExists:function(t){return t in this.getGroups()},addGroup:function(t,e){if(!this.isGroupExists(t)){var n=this.getGroups();return n[t]=this._createGroup(t,e),n[t]}},removeGroup:function(t){var e=this.getGroup(t);e&&(n.isFunction(e.destroy)?e.destroy():n.isFunction(e.stopListening)&&e.stopListening(),delete this.groups[t])},group:function(){var t={},e=this.collection.groupBy(this.groupBy),i=this.getOption("groups");return n(i).each(function(n){n in e?(t[n]=e[n],delete e[n]):t[n]=[]}),n(e).each(function(e,n){return t[n]=e}),t},constructor:function(t){et.apply(this,arguments),this._initializeGrouppedCollection(t)},_initializeGrouppedCollection:function(t){1!=this._initializedGC&&(this.mergeOptions(t,["collection","groupBy"]),this._ensureOptions(),this._initializeGroups(),this._initializeEventHandlers(),this._initializedGC)},_ensureOptions:function(){if(!this.collection)throw new Error("collection must be set");if(!this.groupBy)throw new Error("groupBy must be set");if("string"==typeof this.groupBy){var t=this.getOption("groupBy");this.groupBy=function(e){return e.get(t)}}},_initializeGroups:function(){var t=this;this.groups={};var e=this.group();n(e).each(function(e,n){return t.addGroup(n,e)})},_getCollectionClass:function(){return this.getOption("CollectionClass")||Rt},_createGroup:function(t,e){var n=this.groupBy,i=new(this._getCollectionClass())(e);return i.on("change",function(e){n(e)!==t&&i.remove(e)}),i.name=t,i},_initializeEventHandlers:function(){this.listenTo(this.collection,"update",this._onCollectionUpdate)},_onCollectionUpdate:function(t,e){var i=this,r=(e.changes.added||[]).concat(e.changes.merged||[]),o=n(r).groupBy(this.groupBy),s=n(e.changes.removed).groupBy(this.groupBy),a=this.groups;n(o).each(function(t,e){e in a?a[e].add(t):i.getOption("autoCreateNewGroups")&&i.addGroup(e,t)}),n(s).each(function(t,e){e in a&&a[e].remove(t)})},_onModelChange:function(t){var e=this.groupBy(t);this.groups[e]?this.groups[e].add(t):console.warn("model is out of groupping",t,e)},destroy:function(){n(this.groups).each(function(t){t.stopListening(),n.isFunction(t.destroy)&&t.destroy()}),delete this.groups,n.isFunction(et.prototype.destroy)&&et.prototype.destroy.apply(this,arguments),n.isFunction(this.collection.destroy)&&this.collection.destroy(),delete this.collection}});return{VERSION:"0.0.31",Functions:y,Helpers:x,Mixins:U,Behaviors:tt,Singletons:_t,TemplateContext:I,modals:mt,identity:rt,createConfig:at,Object:et,Error:O,App:bt,Page:Pt,Router:wt,PageManager:kt,View:ot,CollectionView:Dt,Model:Ot,Collection:Rt,CollectionGroups:Et}}),this&&this.Marionette&&(this.Marionette.Yat=this.MarionetteYat);
//# sourceMappingURL=marionette.yat.min.js.map