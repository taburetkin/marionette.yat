/**
* @license
* Marionette.Yat extension for Backbone.Marionette
* Yet Another Toolkit
* ----------------------------------
* v0.0.32
*
* Distributed under MIT license
* author: dimtabu
*/
!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e(require("backbone"),require("backbone.marionette"),require("underscore"),require("jquery")):"function"==typeof define&&define.amd?define(["backbone","backbone.marionette","underscore","jquery"],e):t.MarionetteYat=e(t.Backbone,t.Marionette,t._,t.jQuery)}(this,function(t,e,n,i){"use strict";t=t&&t.hasOwnProperty("default")?t.default:t,e=e&&e.hasOwnProperty("default")?e.default:e,n=n&&n.hasOwnProperty("default")?n.default:n,i=i&&i.hasOwnProperty("default")?i.default:i;var r=function(n){return n instanceof t.Model?n:n instanceof e.View?n.model:void 0},o=function(e){return e instanceof t.View?e:void 0},s=function(t,e,n){return"function"==typeof n&&(t=n.call(t,r(t),o(t)),e=n.call(e,r(e),o(e))),t<e?-1:t>e?1:0},a={compareAB:s,viewComparator:function(){for(var t=arguments.length,e=Array(t),i=0;i<t;i++)e[i]=arguments[i];var r=[],o=0;return e.length>=2?s.apply(null,e):(1===e.length&&e[0]instanceof Array&&(r=e[0]),n(r).every(function(t){return 0===(o=s.apply(null,t))}),o)}};function l(t,e,i){return n.isFunction(e)&&(e=e.apply(t,i||[])),e}function h(e){var i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(null==i.fields||i.fileds&&!i.fileds.length)throw new Error("fields option missing");if(i.checked||(i.checked={}),null!=e){var r=void 0,o=e instanceof t.Model,s=n.isObject(e.options),a=i.exclude instanceof Array?i.exclude:"string"==typeof i.exclude?[i.exclude]:[];return n(i.fields).some(function(t){if(!(t in i.checked||(i.checked[t]=!0,a.indexOf(t)>=0)))return o&&null==r&&(r=l(e,e.get(t),i.args)),null==r&&(r=l(e,e[t],i.args)),null==r&&s&&(r=l(e,e.options[t],i.args)),null!=r}),null==r?i.default:r}}function u(t,e){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:":";return t||(t=""),t+n+(e=null==e?"":e.toString())}function c(e,i){if(null!=e&&n.isObject(e)&&null!=i&&""!=i)return e instanceof t.Model?e.get(i):e[i]}function g(e,n,i,r){return e instanceof t.Model?e.set(n,i,{silent:!0}):e[n]=i,i instanceof t.Model&&r.models.push({path:r.passPath.join(":"),property:n,model:i}),r.passPath.push(n),c(e,n)}var d=function(e,i,r,o){if(null!=e&&n.isObject(e)&&null!=i&&""!=i){var s=n.extend({},o);if(s.silent=!0===s.silent,s.force=!1!==s.force,!n.isObject(i)||i instanceof Array||(r=i.value,s.force=!1!==i.force,s.silent=!0===i.silent,i=i.path),s.path=i,s.passPath=[],s.models=[],null!=i&&""!=i){var a="string"==typeof i?i.split("."):i instanceof Array?[].slice.call(i):[i];if(s.pathArray=[].slice.call(a),a.length){a.length;var l=a.shift();e instanceof t.Model&&s.models.push({path:"",property:l,model:e});var h=function t(e,i,r,o,s){if(null!=e&&n.isObject(e)&&null!=i&&""!=i){if(!r.length)return g(e,i,o,s);var a=c(e,i);if(n.isObject(a)||s.force)return!n.isObject(a)&&s.force&&(a=g(e,i,{},s)),t(a,r.shift(),r,o,s)}}(e,l,a,r,s);if(void 0===h&&void 0!==r)return h;if(!s.silent)for(var u=s.pathArray.join(":");s.models.length;){var d=s.models.pop(),f=""==d.path?u:u.substring(d.path.length+1);f&&d.model.trigger("change:"+f,r),d.model.trigger("change",d.model)}return h}}}};function f(t,e){if(null!=t&&n.isObject(t)&&null!=e&&""!=e){var i="string"==typeof e?e.split("."):e instanceof Array?[].slice.call(e):[e];return function t(e,i,r){if(null!=e&&n.isObject(e)&&null!=i&&""!=i){var o=c(e,i);return!r.length||r.length&&null==o?o:t(o,r.shift(),r)}}(t,i.shift(),i)}}var p="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t};function v(e){if(null!=e&&n.isObject(e)){var i={};return function e(n,i){if(i=i||"",null!=this&&"object"==p(this))for(var r=this instanceof t.Model?this.attributes:this,o=Object.getOwnPropertyNames(r),s=0;s<o.length;s++){var a=o[s],l=this[a];null==l||"object"!=(void 0===l?"undefined":p(l))||l instanceof Date||l instanceof Array?n[i+a]=l:"object"==(void 0===l?"undefined":p(l))&&e.call(l,n,i+a+".")}}.call(e,i),i}}function m(t){if(null!=t&&n.isObject(t)){var e={};for(var i in t)d(e,i,t[i],!0);return e}}var y={getLabel:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return e.fields=["getLabel","label","getName","name","getValue","value"].concat(e.fields||[]),h(t,e)},getName:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return e.fields=["getName","name","getLabel","label","getValue","value"].concat(e.fields||[]),h(t,e)},getValue:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return e.fields=["getValue","value","getId","id","getName","name","getLabel","label","cid"].concat(e.fields||[]),h(t,e)},wrap:u,unwrap:function(t,e){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:":";if(null!=t){if(t=t.toString(),e||(e=""),!t.length)return t;var i=new RegExp("^"+e+n);return t.replace(i,"")}},setByPath:d,getByPath:f,flattenObject:v,unFlattenObject:m,isView:function(e){return e instanceof t.View}},_={view:a,common:y},b=[t.Model,t.Collection,t.View,t.Router,e.Object];function w(t){var e=n.isFunction(t),i=n(b).some(function(e){return t===e||t.prototype instanceof e});return e&&i}var S=e.Error.extend({},{Http400:function(t){return this.Http(400,t)},Http401:function(t){return this.Http(401,t)},Http403:function(t){return this.Http(403,t)},Http404:function(t){return this.Http(404,t)},Http500:function(t){return this.Http(500,t)},Http:function(t,e){var n=new this({message:e,name:"HttpError"});return n.status=t,n},HttpRedirect:function(t){return this.Http(301,t)},NotFound:function(t){return this.Http404(t)},NotAuthorized:function(t){return this.Http401(t)},Forbidden:function(t){return this.Http403(t)}});function x(t){var i=null;if(n.isFunction(t))i=t;else{if(!n.isObject(t)||null===t)throw new Error("argument should be an object or class definition");var r=function(){};r.extend=e.extend,i=r.extend(t)}i.extend||((i=e.extend.call(t,{})).extend=e.extend);return{with:function(){for(var t=arguments.length,e=Array(t),r=0;r<t;r++)e[r]=arguments[r];return n.reduce(e,function(t,e){return function(t,e){if(n.isFunction(e))return e(t);if(n.isObject(e))return t.extend(e);throw new S("Mixin fail, argument should be an object hash or mixin function")}(t,e)},i)},class:i}}var C=function(t){return t.extend({getProperty:function(t,e){return this._getOptionOrProperty(this,t,e,this.getOption)},getOption:function(t,e){return this._getOptionOrProperty(this.getProperty("options",{deep:!1}),t,e,this.getProperty)},_getOptionOrProperty:function(t,e){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},r=arguments[3];if(void 0!==i.deep||(i.deep=!0),void 0!==i.force||(i.force=!0),i.args||(i.args=[]),null!=e){var o=t&&t[e];if(void 0===o&&i.deep&&n.isFunction(r)){var s=n.extend({},i,{deep:!1,force:!1});o=r.call(this,e,s)}return n.isFunction(o)&&i.force&&!w(o)&&(o=o.apply(this,i.args||[])),void 0===o?i.default:o}}})},O=function(t){return t.extend({constructor:function(){for(var e=arguments.length,n=Array(e),i=0;i<e;i++)n[i]=arguments[i];t.apply(this,n);var r=!(!0===this.getProperty("initRadioOnInitialize"));this._initRadio({skip:r})},getChannel:function(){return this._channel||this._initRadio({skip:!1}),this._channel},_initRadio:function(){if(1!=(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{skip:!0}).skip){if(!this.getProperty("channelName")){var t=this.getProperty("channel");t&&(this.channelName=t.channelName)}e.Object.prototype._initRadio.call(this)}},radioRequest:function(){var t=this.getChannel();t&&t.request.apply(t,arguments)},radioTrigger:function(){var t=this.getChannel();t&&t.trigger.apply(t,arguments)}})},P=x(e.Object).with(C,O),M={scrollable:{get:function(t){var e={};return t.$("[data-scrollable]").each(function(t,n){var r=i(n),o=r.data("scrollable");e[o]={top:r.scrollTop(),left:r.scrollLeft()}}),e},set:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};t.$("[data-scrollable]").each(function(t,n){var r=i(n),o=r.data("scrollable"),s=e[o];isNaN(s.top)||r.scrollTop(s.top),isNaN(s.left)||r.scrollLeft(s.left)})}}},k={},A=P.extend({initialize:function(t){this._initStates()},_initStates:function(){var t=this;this._states={};var e=this.getOption("states");n(e).each(function(e,n){"string"==typeof e&&(n=e,e=M[e]),t._isStateEntry(e)&&(t._states[n]=e)})},_isStateEntry:function(t){return n.isObject(t)&&n.isFunction(t.get)&&n.isFunction(t.set)},apply:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},i=this.getStore(t,e);n(this._states).each(function(n,r){n.set(t,i[r],e)})},collect:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},i=this.getStore(t,e);n(this._states).each(function(n,r){i[r]=n.get(t,e)})},getStore:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=this.getStoreKey(t,e);return k[n]||(k[n]={}),k[n]},getStoreKey:function(t){var e=this.getOption("storeIdPrefix");return(e?e+":":"")+String(t.id||t.cid)}});A.set=function(t,e){M[t]=e},A.remove=function(t){delete M[t]},A.clear=function(){var t=n(M).keys();n(t).each(function(t){return delete M[t]})},A.states=function(){return M},A.store=function(){return k};var D={isKnownCtor:w,mix:x,ViewStateApi:A};function R(t){return t.extend({getName:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=n.extend({},t);return e.exclude="getName",e.args=[e],y.getName(this,e)},getLabel:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=n.extend({},t);return e.exclude="getLabel",e.args=[e],y.getLabel(this,e)},getValue:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=n.extend({},t);return e.exclude="getValue",e.args=[e],y.getValue(this,e)}})}var E=function(t){var e=t.extend({constructor:function(){for(var e=arguments.length,n=Array(e),i=0;i<e;i++)n[i]=arguments[i];t.apply(this,n),this.initializeStateable()},initializeStateable:function(){this._state={}},getState:function(t){var e=this._state;return t?e[t]:e},setState:function(t,e,i){if(null!=t)if(n.isObject(t)){var r=this;i=e,n(e=t).each(function(t,e){return r.setState(e,t,n.extend({},i,{doNotTriggerFullState:!0}))}),this._triggerStateChange(e,i)}else{this.getState()[t]=e,this._triggerStateChange(t,e,i)}},clearState:function(){var t=this.getState(),e=n.extend({},t);n(t).each(function(n,i){e[i]=void 0,delete t[i]}),this._triggerStateChange(e)},_triggerStateChange:function(t,e,i){if(n.isFunction(this.triggerMethod)){n.isObject(t)?(i=e,e=t,this.triggerMethod("state",e,i)):(this.triggerMethod("state:"+t,e,i),(!0===e||!1===e||e&&"string"==typeof e)&&this.triggerMethod("state:"+t+":"+e.toString(),i),(!i||i&&!i.doNotTriggerFullState)&&this.triggerMethod("state",(s=e,(o=t)in(r={})?Object.defineProperty(r,o,{value:s,enumerable:!0,configurable:!0,writable:!0}):r[o]=s,r),i));var r,o,s}}});return e.Stateable=!0,e},j="initialized",V="starting",L="running",T="stopping",z="waiting",F="destroyed";function H(t,e){var i=this;if(null!=t&&null!=e){var r=t["_"+e]||[],o=n.result(t,e)||[],s=r.concat(o),a=[];return n(s).each(function(t){if(n.isFunction(t)){var e=t.call(i);e&&a.push(e)}else null!=t&&a.push(t)}),Promise.all(a.filter(function(t){return null!=t}))}}function B(t,e,n){null!=t&&null!=e&&null!=n&&(t[e]||(t[e]=[]),t[e].push(n))}var N=function(t){var e=x(t).with(E),i=e.extend({constructor:function(){this._startRuntimePromises=[],this._startPromises=[],this._stopPromises=[];for(var t=arguments.length,n=Array(t),i=0;i<t;i++)n[i]=arguments[i];e.apply(this,n),this.initializeStartable()},freezeWhileStarting:!1,freezeUI:function(){},unFreezeUI:function(){},isStartNotAllowed:function(){},isStopNotAllowed:function(){},isStarted:function(){return this._isLifeState(L)},isStoped:function(){return this._isLifeStateIn(z,j)},addStartPromise:function(t){B(this,"_startRuntimePromises",t)},addStopPromise:function(t){B(this,"_stopPromises",t)},initializeStartable:function(){this.constructor.Startable&&this.constructor.Stateable&&(this._registerStartableLifecycleListeners(),this._setLifeState(j))},prepareForStart:function(){},start:function(){for(var t=this,e=arguments.length,n=Array(e),i=0;i<e;i++)n[i]=arguments[i];var r=n[0];this.prepareForStart();return new Promise(function(e,i){var o=t._ensureStartableCanBeStarted();if(o)return t.triggerMethod("start:decline",o),void i(o);var s=t.isStartNotAllowed(r);if(s)return t.triggerMethod("start:decline",s),void i(s);t.triggerBeforeStart.apply(t,n);var a=t._getLifeState();t._setLifeState(V);t._getStartPromise().then(function(){t._tryMergeStartOptions(r),t.once("start",function(){return e.apply(void 0,arguments)}),t._setLifeState(L),t.triggerStart(r)},function(){t._setLifeState(a),i.apply(void 0,arguments)})})},triggerBeforeStart:function(){for(var t=arguments.length,e=Array(t),n=0;n<t;n++)e[n]=arguments[n];this.triggerMethod.apply(this,["before:start"].concat(e))},triggerStart:function(t){this.triggerMethod("start",t)},restart:function(t){var e=this,n=this._ensureStartableCanBeStarted();if(n)return Promise.reject(n);return new Promise(function(n,i){e.isStarted()?e.stop().then(function(r){return e.start(t).then(function(t){return n(t)},function(t){return i(t)})},function(t){return i(t)}):e.isStoped()?e.start(t).then(function(t){return n(t)},function(t){return i(t)}):i(new S({name:"StartableLifecycleError",message:"Restart not allowed when startable not in idle. Current state"+e._getLifeState()}))})},stop:function(){for(var t=this,e=arguments.length,n=Array(e),i=0;i<e;i++)n[i]=arguments[i];var r=n[0];return new Promise(function(e,i){var o=t._ensureStartableCanBeStopped();if(o)return t.triggerMethod("stop:decline",o),void i(o);var s=t.isStopNotAllowed(r);if(s)return t.triggerMethod("stop:decline",s),void i(s);var a=t._getLifeState();t.triggerMethod.apply(t,["before:stop"].concat(n)),t._setLifeState(T);t._getStopPromise().then(function(){t._tryMergeStopOptions(r),t.once("stop",function(){return e.apply(void 0,arguments)}),t._setLifeState(z),t.triggerStop(r)},function(){t._setLifeState(a),i.apply(void 0,arguments)})})},triggerStop:function(t){this.triggerMethod("stop",t)},_setLifeState:function(t){this.setState("life",t)},_getLifeState:function(){return this.getState("life")},_isLifeState:function(t){return this._getLifeState()===t},_isLifeStateIn:function(){for(var t=this,e=arguments.length,i=Array(e),r=0;r<e;r++)i[r]=arguments[r];return n(i).some(function(e){return t._isLifeState(e)})},_isInProcess:function(){return this._isLifeStateIn(V,T)},_registerStartableLifecycleListeners:function(){var t=this,e=!0===this.getProperty("freezeWhileStarting");e&&n.isFunction(this.freezeUI)&&this.on("state:life:"+V,function(){t.freezeUI()}),e&&n.isFunction(this.unFreezeUI)&&this.on("start",function(){t.unFreezeUI()}),this.on("destroy",function(){return t._setLifeState(F)})},_tryMergeStartOptions:function(t){if(this.mergeOptions){var e=this.getProperty("mergeStartOptions")||[];this.mergeOptions(t,e)}},_tryMergeStopOptions:function(t){if(this.mergeOptions){var e=this.getProperty("mergeStopOptions")||[];this.mergeOptions(t,e)}},_ensureStartableIsIntact:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{throwError:!1},e=new S({name:"StartableLifecycleError",message:"Startable has already been destroyed and cannot be used."}),n=this._isLifeState(F);if(t.throwError&&n)throw e;if(n)return e},_ensureStartableIsIdle:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{throwError:!1},e="Startable is not idle. current state: "+this._getLifeState(),n=new S({name:"StartableLifecycleError",message:e}),i=this._ensureStartableIsIntact(t),r=this._isInProcess();if(t.throwError&&r)throw n;return i||(r?n:void 0)},_ensureStartableCanBeStarted:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{throwError:!1},e=new S({name:"StartableLifecycleError",message:"Startable has already been started."}),n=this._ensureStartableIsIdle(t),i=!0===this.getProperty("allowStartWithoutStop");if(n||!i){var r=this._isLifeState(L);if(t.throwError&&r)throw e;return n||(r?e:void 0)}},_ensureStartableCanBeStopped:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{throwError:!1},e=new S({name:"StartableLifecycleError",message:"Startable should be in `running` state."}),n=this._ensureStartableIsIdle(t),i=!0===this.getProperty("allowStopWithoutStart");if(n||!i){var r=this._isLifeState(L);if(t.throwError&&!r)throw e;return n||(r?void 0:e)}},_getStartPromise:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return Promise.all(this._getStartPromises(t))},_getStartPromises:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=[],n=this._getStartParentPromise();n&&e.push(n);var i=this._getStartInstancePromise();if(i&&e.push(i),!0!==t.noruntime){var r=this._getStartRuntimePromise();r&&e.push(r)}return e},_getStartRuntimePromise:function(){return H(this,"startRuntimePromises")},_getStartInstancePromise:function(){return H(this,"startPromises")},_getStartParentPromise:function(){var t=n.result(this,"getParent");if(n.isObject(t)&&n.isFunction(t._getStartPromise))return t._getStartPromise({noruntime:!0})},_getStopPromise:function(){return Promise.all(this._getStopPromises())},_getStopPromises:function(){var t=[];return t.push(this._getStopRuntimePromise()),t},_getStopRuntimePromise:function(){return H(this,"stopPromises")},_getStopParentPromise:function(){var t=n.result(this,"getParent");if(n.isObject(t)&&n.isFunction(t._getStopPromise))return t._getStopPromise()}});return i.Startable=!0,i},I=function(t){var e="_children",i=t.extend({constructor:function(){for(var e=arguments.length,n=Array(e),i=0;i<e;i++)n[i]=arguments[i];t.apply(this,n),this.initializeChildrenable.apply(this,n)},initializeChildrenable:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this._initializeParrent(t),this._initializeChildren(t)},hasChildren:function(){this.getChildren();return this[e].length>0},getChildren:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{startable:!0},n=this[e]||[];return t.startable?n.filter(function(t){return!t.getProperty("isStartNotAllowed")}):n},hasParent:function(){var t=this.getParent();return n.isObject(t)},getParent:function(){return this.getProperty("parent",{deep:!1})},_initializeChildren:function(){var t=this,i=this.getProperty("children"),r=[];n(i).each(function(e){var n=t._normalizeChildContext(e),i=t._initializeChild(n);i&&r.push(i)}),this[e]=r},_initializeChild:function(t){if(null!=t&&n.isFunction(t.Child)){var e=t.Child,i=this._normalizeChildOptions(t);return this.buildChild(e,i)}},_normalizeChildContext:function(t){var e={};return n.isFunction(t)&&t.Childrenable?n.extend(e,{Child:t}):n.isFunction(t)?e=this._normalizeChildContext(t.call(this)):n.isObject(t)&&(e=t),e},_normalizeChildOptions:function(t){var e=n.extend({},t);return!0===this.getOption("passToChildren")&&n.extend(e,this.options),e.parent=this,delete e.Child,this._buildChildOptions(e)},_buildChildOptions:function(t){return n.extend(t,this.getProperty("childOptions"))},buildChild:function(t,e){return new t(e)},_initializeParrent:function(t){null==this.parent&&null!=t.parent&&(this.parent=t.parent)}});return i.Childrenable=!0,i},$=[function(t){return{_v:t,_m:t.model||{},_cid:function(e){return u(t.cid,e)}}}],G={},U=!1;var Y={mix:function(t){for(var e=arguments.length,i=Array(e>1?e-1:0),r=1;r<e;r++)i[r-1]=arguments[r];var o=this.get.apply(this,i);return n.extend(o,t)},get:function(){return this.compile.apply(this,arguments)},add:function(){for(var t=this,e=arguments.length,i=Array(e),r=0;r<e;r++)i[r]=arguments[r];n(i).each(function(e){return t.push(e)})},compile:function(){for(var t=arguments.length,e=Array(t),i=0;i<t;i++)e[i]=arguments[i];U&&(G={});var r={};return n($).each(function(t){n.isFunction(t)?n.extend(r,function(t){for(var e=arguments.length,i=Array(e>1?e-1:0),r=1;r<e;r++)i[r-1]=arguments[r];return n.isFunction(t)?t.apply(void 0,i):n.isObject(t)?t:{}}.apply(void 0,[t].concat(e))):U&&n.extend(G,t)}),U||n.extend(r,G),U=!1,r},pop:function(){return U=!0,$.pop()},shift:function(){return U=!0,$.shift()},push:function(t){U=!0,$.push(t)},unshift:function(t){U=!0,$.unshift(t)},clear:function(){U=!1,G={},$=[]}},W=function(t){return t.extend({mixinTemplateContext:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=Y.mix(n.result(this,"templateContext"),this);return n.extend(t,e)}})},X={GetNameLabel:R,GetOptionProperty:C,Radioable:O,Stateable:E,Startable:N,Childrenable:I,GlobalTemplateContext:W},q=x(e.Behavior).with(C),K=q.extend({listenViewInitialize:!0,constructor:function(){!0===this.getProperty("listenViewInitialize")&&this.on("before:render initialize",n.once(n.partial(this.triggerMethod,"view:initialize"))),q.apply(this,arguments)},getModel:function(){return this.view.model},cidle:function(t){return y.wrap(this.view.cid,t)},unCidle:function(t){return y.unwrap(t,this.view.cid)}}),Q=K.extend({triggerEl:void 0,moveBeforeStart:10,scope:"drag",getDragEventsContext:function(){return this.$doc},getDragEventsElementSelector:function(){return"*"},getTriggerEl:function(){if(this._$el)return this._$el;var t=this.getOption("triggerEl");if(null==t&&this.view.$el)this._$el=this.view.$el;else if(t&&t.jquery)this._$el=t;else if(t instanceof HTMLElement)this._$el=i(t);else{if("string"!=typeof t||!t.length)throw new Error("trigger element should be a DOM or jQuery object or string selector.",t);this._$el=this.view.$(t)}return this._$el},isSameScope:function(t){return t.scope===this.scope},shouldHandleDomEvents:function(t){return this.isSameScope(t)&&this!==t},constructor:function(){this._clearDragData(),this.$doc=i(document);for(var t=arguments.length,e=Array(t),n=0;n<t;n++)e[n]=arguments[n];K.apply(this,e),this._defineDocumentBindings()},_clearDragData:function(){this._dragData={}},_defineDocumentBindings:function(){this.__b={},this.__b.setupDragDetection=n.bind(this._setupDragDetection,this),this.__b.handleMouseUp=n.bind(this._handleMouseUp,this),this.__b.handleMoveAfterMouseDown=n.bind(this._handleMoveAfterMouseDown,this),this.__b.handleDragMove=n.bind(this._handleDragMove,this),this.__b.handleElementEnter=n.bind(this._handleElementEnter,this),this.__b.handleElementLeave=n.bind(this._handleElementLeave,this),this.__b.handleElementOver=n.bind(this._handleElementOver,this)},onInitialize:function(){this._initializeDragListener()},_initializeDragListener:function(){this.getTriggerEl().one("mousedown",this.__b.setupDragDetection)},_setupDragDetection:function(t){!0!==this.view.dragDisabled?(t.stopPropagation(),this.$doc.one("mouseup",this.__b.handleMouseUp),this._dragData.startX=t.pageX,this._dragData.startY=t.pageY,this.$doc.on("mousemove",this.__b.handleMoveAfterMouseDown)):this._initializeDragListener()},_handleMouseUp:function(t){this._dragData.dragging?this._handleDragEnd(t):this._handleEndWithoutDrag(t),this._initializeDragListener()},_handleEndWithoutDrag:function(t){this.$doc.off("mousemove",this.__b.handleMoveAfterMouseDown)},_handleDragEnd:function(t){this._dragData.dragging=!1,this.$doc.off("mousemove",this.__b.handleDragMove);var e=this.getDragEventsContext();e.off("mouseenter",this.__b.handleElementEnter),e.off("mousemove",this.__b.handleElementOver),this._dragData.drop&&this._dragData.drop.context&&(this._dragData.drop.context.catchDraggable(this,this._dragData.drop),this.triggerMethod("drag:drop",this._dragData.drop)),this.triggerMethod("drag:end")},_handleMoveAfterMouseDown:function(t){t.stopPropagation();this._getStartPositionPixelOffset(t)>=this.getOption("moveBeforeStart")&&this._startDragSession()},_getStartPositionPixelOffset:function(t){var e=Math.abs(t.pageX-this._dragData.startX),n=Math.abs(t.pageY-this._dragData.startY);return e>n?e:n},_startDragSession:function(){this._dragData.dragging=!0,this.$doc.off("mousemove",this.__b.handleMoveAfterMouseDown),this.$doc.on("mousemove",this.__b.handleDragMove);var t=this.getDragEventsContext(),e=this.getDragEventsElementSelector();t.on("mouseenter",e,this.__b.handleElementEnter),t.on("mousemove",e,this.__b.handleElementOver),this.view.triggerMethod("drag:start")},_handleDragMove:function(t){t.stopPropagation(),this.triggerMethod("drag",t)},_handleElementEnter:function(t){var e=this,n=i(t.target);this._dragData.over!=n&&(this._dragData.over=n,n.trigger("drag:enter",this),n.one("mouseleave",function(){return e.trigger("drag:leave",e)}))},_handleElementLeave:function(t){i(t.target).trigger("drag:leave",this)},_handleElementOver:function(t){var e=i(t.target),n=this._createCustomDomEvent("drag:over",t);e.trigger(n,this)},_createCustomDomEvent:function(t,e,i){i||(i=["pageX","pageY","clientX","clientY","offsetX","offsetY","target"]);var r=jQuery.Event(t);return n(i).each(function(t){return r[t]=e[t]}),r}}),J=Q.extend({useGhost:!0,viewCssClass:"dragging",ghostCssClass:"ghost",constructor:function(){for(var t=arguments.length,e=Array(t),n=0;n<t;n++)e[n]=arguments[n];Q.apply(this,e),this.on("drag",this._onDrag),this.on("drag:start",this._onDragStart),this.on("drag:end",this._onDragEnd)},events:{"drag:enter":function(t,e){this.shouldHandleDomEvents(e)},"drag:over":function(t,e){if(this.isSameScope(e)){t.stopPropagation();var n=this._createCustomDomEvent("drag:over",t),i=this.$el.parent();i&&i.trigger(n,[e,this])}}},_onDragEnd:function(t){this.getOption("useGhost")&&this._removeGhost(),this.getOption("viewCssClass")&&this.view.$el.removeClass(this.getOption("viewCssClass")),this._clearDragData()},_onDragStart:function(t){this.getOption("useGhost")&&this._createGhost(),this.getOption("viewCssClass")&&this.view.$el.addClass(this.getOption("viewCssClass"))},_onDrag:function(t){this.setGhostPosition(t.pageY,t.pageX)},_removeGhost:function(){this.$ghost.remove(),delete this.$ghost},createGhost:function(){var t=this.$el.clone(),e=this.$el.offset(),n=e.top,i=e.left;return t.css({top:n+"px",left:i+"px",width:this.$el.outerWidth(),height:this.$el.outerHeight()}),t},_createGhost:function(){var t=this.createGhost();"absolute"!=t.css("position")&&t.css("position","absolute");var e=this.getOption("ghostCssClass");e&&t.addClass(e),t.appendTo(i("body")),this._setGhost(t)},_setGhost:function(t){this.$ghost=t},getGhost:function(){return this.$ghost},setGhostPosition:function(t,e){var n=this.getGhost();n&&n.css({top:t+"px",left:e+"px"})}}),Z=K.extend({scope:"drag",events:{"drag:over":"_onDomDragOver"},_skipFirstAttach:!0,isSameScope:function(t){return t.scope===this.scope},getEventXY:function(t){return{x:t.pageX,y:t.pageY}},getChildren:function(){return n(this.view.children._views).filter(function(t){return t.model&&t.isRendered()&&t.isAttached()})},catchDraggable:function(t,e){this._onDrop(t,e)},constructor:function(){for(var t=arguments.length,e=Array(t),n=0;n<t;n++)e[n]=arguments[n];K.apply(this,e),this._initReorderBehavior()},_initReorderBehavior:function(){var t=this;this.listenToOnce(this.view,"render",function(){t.reOrder({silent:!0}),t.listenTo(t.view.collection,"update",function(t,e){(e||{}).changes;this.reOrder()})})},reOrder:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this.view.sort();var e=this.children=[],i=this._skipFirstAttach;n(this.view.children._views).each(function(t,n){t.model&&(t.model.set("order",n),t.isRendered()&&(i||t.isAttached())&&e.push(t))}),this.hasChildren=this.children.length>0,1!=t.silent&&this.view.collection&&this.view.collection.trigger("reordered"),this._skipFirstAttach=!1},_onDomDragOver:function(t,e,i){if(this.isSameScope(e)&&(t.stopPropagation(),e!==i&&(!this.hasChildren||i))){e._dragData.drop||(e._dragData.drop={});var r=e._dragData.drop,o=this.getEventXY(t),s=this._getDropContext(o,i);s.context=this;var a=n.extend({},r,s),l=n.keys(a);n(l).some(function(t){return r[t]!==s[t]})&&(e._dragData.drop=s,this._onDropContextChange(e,s))}},_getDropContext:function(t,e){if(!(this.children||[]).length)return{insert:"before"};var n=e?e.$el:this.$el,i=this._getPositionByEventXY(t,n);return this._getDropContextByPosisiton(i,e)},_getPositionByEventXY:function(t,e){var n=e.offset(),i=e.outerWidth(),r=e.outerHeight(),o=n.left+i/2,s=n.top+r/2,a={x:void 0,y:void 0};return a.x=t.x<=o?"left":"right",a.y=t.y<=s?"top":"bottom",a},_getDropContextByPosisiton:function(t,e){var i="horizontal"==(this.getOption("direction")||"vertical")?"left"==t.x?"before":"after":"top"==t.y?"before":"after",r=void 0;return{insert:i,childView:r=e?e.view:"before"==i?this.children[0]:this.children.length&&n(this.children).last(),index:this.view.children._views.indexOf(r),noChild:!e}},_onDropContextChange:function(t,e){this.triggerMethod("drop:context:change",t,e)},_onDrop:function(t,e){this.triggerMethod("drop",t,e)}}),tt=K.extend({updateElementClass:function(t){var e=n.result(this.view,"className")||"",i=n.result(this.view,"dynamicClassName")||"";this.$el.attr({class:(e+" "+i).trim()})},refreshOnModelChange:!0,refreshOnDomChange:!1,refreshOnViewRefresh:!0,refreshOnViewBeforeRender:!0,refreshOnViewRender:!1,modelEvents:{change:function(){this.getProperty("refreshOnModelChange")&&this.updateElementClass("model:change")}},events:{change:function(){this.getProperty("refreshOnDomChange")&&this.updateElementClass("dom:change")}},onRefresh:function(){this.getProperty("refreshOnViewRefresh")&&this.updateElementClass("view:refresh")},onRender:function(){this.getProperty("refreshOnViewRender")&&this.updateElementClass("view:render")},onBeforeRender:function(){this.getProperty("refreshOnViewBeforeRender")&&this.updateElementClass("view:before:render")},onRefreshCssClass:function(){this.updateElementClass()},onSetupRefreshCssClass:function(t){var e=this;null!=t&&n.isObject(t)&&n(t).each(function(t,n){e[n]=!0===t})}});function et(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}var nt=x(K).with(E).extend({applyDelay:1,autoApplyToModel:!1,autoChangeModel:!1,fillFormFromModel:!0,applySelector:".apply",cancelSelector:".cancel",resetSelector:".reset",initialize:function(t){this.applyValue=n.debounce(this._applyValue,this.getProperty("applyDelay")),this.mergeOptions(t,["values"]),this.extendDefaultValues({})},extendDefaultValues:function(t){this._values=n.extend(this._values||{},t)},onViewInitialize:function(){var t=this.getModel();t&&this.extendDefaultValues(t.toJSON())},onRender:function(){this.firstRender||(this.buildFormBindings(),this.setState(this._tryFlatValues(this._values)),this.setValuesToForm(this.getValues({raw:!0}))),this.firstRender=!0},triggers:function(){var t;return et(t={},"click "+this.getProperty("applySelector"),"trigger:apply"),et(t,"click "+this.getProperty("cancelSelector"),"trigger:cancel"),et(t,"click "+this.getProperty("resetSelector"),"trigger:reset"),t},_tryFlatValues:function(t){return v(t)},_tryUnFlatValues:function(t){return m(t)},rollbackToDefaultValues:function(){this.clearState();var t=this._values,e=this._tryFlatValues(t);this.setState(e)},getValues:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=this.getState();if(t.raw)return e;return this._tryUnFlatValues(e)},onTriggerApply:function(){this._apply()},onTriggerCancel:function(){this._cancel()},onTriggerReset:function(){this._reset()},_apply:function(){var t=this.getValues();this.view.triggerMethod("values:apply",t),this._tryChangeModel(t)},_cancel:function(){this.rollbackToDefaultValues();var t=this._getFullHash(this._values);this.view.triggerMethod("values:cancel",t),this.setValuesToForm(t),this._tryChangeModel(t,{clear:!0})},_reset:function(){this.clearState();var t=this._getFullHash({});this.view.triggerMethod("values:reset",t),this.setValuesToForm(t),this._tryChangeModel(t,{clear:!0})},onState:function(t){this._tryChangeModel(t,{type:"property"})},_tryChangeModel:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n="property"===e.type?"autoChangeModel":"autoApplyToModel";if(!0===this.getProperty(n)){var i=this.getModel();i&&(t=this._tryUnFlatValues(t),!0===e.clear&&i.clear(),i.set(t))}},_getFullHash:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=this.getModel()&&this.getModel().toJSON(),i=n.extend({},this.values,this.mappings,e),r={};return n(i).each(function(t,e){return r[e]=void 0}),n.extend(r,t)},buildFormBindings:function(){var t=this;this.mappings={};var e=["input","textarea","select"];this.$("[name]").each(function(n,i){if(-1!=e.indexOf(i.tagName.toLowerCase())){var r=t.unCidle(i.name);if(!(r in t.mappings)){var o=t._getElementInfo(i,e);o&&(t.mappings[r]=o)}}});var i={};n(this.mappings).each(function(t,e){t.values&&(i[e]=t.values)}),this.extendDefaultValues(i)},_getElementInfo:function(t,e){var n={name:t.name},r=void 0,o='[name="'+t.name+'"]',s=this.$(o);if(s.length){if(s.length>1){var a=[],l=!1;s.each(function(t,n){if(-1!=e.indexOf(n.tagName.toLowerCase())){var r=i(n);if("checkbox"!=n.type&&"radio"!=n.type||r.prop("checked")){var o=r.val();l||(l="checkbox"===n.type||o instanceof Array),o instanceof Array?a=a.concat(o):a.push(r.val())}}}),r=!a.length||1===a.length&&!l?a[0]:a}else r="checkbox"===s.get(0).type?s.prop("checked")?[s.val()]:[]:s.val();return n.values=r,n.isArray=r instanceof Array,n.$elements=s,n}},setValuesToForm:function(t){var e=this;n(t).each(function(t,n){var i=e.mappings[n].$elements,r=t instanceof Array?t:[t];i.each(function(t,n){e._setValueToElement(n,t,r)})})},_setValueToElement:function(t,e,n){var r=e<n.length&&n[e],o=t.jquery?t:i(t);"checkbox"===(t=o.get(0)).type||"radio"===t.type?o.prop("checked",n.indexOf(o.val())>=0):o.val(r)},events:{change:"domChange",input:"domInput"},domChange:function(t){this.applyValue(t.target.name,t.target,t)},domInput:function(t){this.applyValue(t.target.name,t.target,t)},_applyValue:function(t,e,n){"checkbox"==e.type?this._applyCheckboxValue(t,e,n):this._applySimpleValue(t,e,n)},_applySimpleValue:function(t,e,n){t=this.unCidle(t);var r=i(e);this.setState(t,r.val())},_applyCheckboxValue:function(t,e,n){var i='input[type=checkbox][name="'+t+'"]:checked',r=this.$(i).map(function(t,e){return e.value}).toArray();t=this.unCidle(t),this.setState(t,r)}}),it={Behavior:K,Draggable:J,Droppable:Z,DynamicClass:tt,FormToHash:nt},rt=(x(P).with(E),{tokenUrl:"",nativeAjax:i.ajax,ajax:function(){for(var t=this,e=arguments.length,r=Array(e),o=0;o<e;o++)r[o]=arguments[o];return this.ensureToken().then(function(){var e=r[0];return e.headers=n.extend({},e.headers,t.getAjaxHeaders()),t.nativeAjax.apply(i,r)}).catch(function(t){var e=i.Deferred();return e.reject(t),e})},tokenXhr:function(t,e){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"POST";return this.nativeAjax({url:t,data:e,method:n})},ensureToken:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if(!this.isRefreshNecessary(t))return Promise.resolve();var e=this.getOption("refreshTokenUrl"),n=this.getRefreshTokenData();return this.requestToken(n,e,{refresh:!0})},requestToken:function(t,e){var n=this;if(e||(e=this.getOption("tokenUrl")),!e)return Promise.reject("token url not specified");return new Promise(function(i,r){n.tokenXhr(e,t).then(function(t){n.setToken(t),i(t)},function(t){[400,401].indexOf(t.status)>-1?(n.authenticated=!1,n.triggerMethod("token:expired"),r(S.Http(t.status))):r(t)})})},getAjaxHeaders:function(){return this._ajaxHeaders||(this._ajaxHeaders={}),n.extend({},this._ajaxHeaders,this.getOption("ajaxHeader"))},replaceBackboneAjax:function(){var e=this,n=this.getTokenValue();t.ajax=n?function(){return e.ajax.apply(e,arguments)}:i.ajax},updateAjaxHeaders:function(){this._ajaxHeaders||(this._ajaxHeaders={});var t=this.getTokenValue(),e=this._ajaxHeaders;t?(e.Authorization="Bearer "+t,e.Accept="application/json"):delete e.Authorization}}),ot={tokenExpireOffset:void 0,getToken:function(){return this.token},getTokenValue:function(){var t=this.getToken();return t&&t.access_token},getRefreshTokenData:function(){return{grant_type:"refresh_token",refresh_token:(this.getToken()||{}).refresh_token}},getTokenExpires:function(){return(this.getToken()||{}).expires},getTokenSeconds:function(){var t=this.getTokenExpires();if(null==t||isNaN(t.valueOf()))return console.warn("expires is null or wrong"),0;var e=this.getProperty("tokenExpireOffset");null==e&&(e=3e4);var n=t.valueOf()-e-Date.now();return n>0?n/1e3:0},isRefreshNecessary:function(t){if(!0===t.force)return!0;return!!this.getTokenValue()&&!this.getTokenSeconds()},setToken:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};this.token=this.parseToken(t,e),this.beforeTokenChange(e),this.triggerMethod("before:token:change",this.token,e),!0!==e.silent&&this.triggerMethod("token:change",this.token),this.afterTokenChange(e),!1!==e.identity&&this.syncUser(e)},parseToken:function(t){return null==t?t:(null!=t&&n.isObject(t)&&(t.expires=new Date(Date.now()+1e3*t.expires_in)),t)},beforeTokenChange:function(t){this.updateAjaxHeaders(),this.replaceBackboneAjax()},afterTokenChange:function(){}},st=new(x(P).with({authenticated:!1,isAuth:function(){return!0===this.authenticated},isAnonym:function(){return!this.isAuth()},isMe:function(t){return t&&this.isAuth()&&this.me==t},setMe:function(t){this.me=t}},rt,ot,{syncUser:function(t){var e=this,n=this.getUser();n?n.fetch().then(function(){e.applyUser(n)},function(){e.syncUserEror()}):this.triggerChange()},syncUserEror:function(){this.reset()},applyUser:function(t){var e=null==t?null:t.id;this.setMe(e),this.authenticated=null!=e,this.triggerChange()},getUser:function(){return this.user},setUser:function(t){this.user=t,this.applyUser(t)},isUser:function(){return this.isAuth()&&this.user&&!!this.user.id}}).extend({triggerChange:function(){this.triggerMethod("change")},reset:function(){this.authorized=!1;var t=this.getUser();t.clear(),this.setToken(null,{identity:!1}),this.applyUser(t),this.triggerMethod("reset")}})),at=e.Region.extend({constructor:function(t){e.Region.apply(this,arguments),this.mergeOptions(t,["stateApi"]),this.stateApi&&this._initStateApi()},_initStateApi:function(){this.off("show",this._onStatableShow),this.off("before:empty",this._onStatableBeforeEmpty),this.on("show",this._onStatableShow),this.on("before:empty",this._onStatableBeforeEmpty)},_onStatableShow:function(t,e){var i=this.stateApi&&n.isFunction(this.stateApi.apply)?this.stateApi:void 0;i&&i.apply(e,{region:t})},_onStatableBeforeEmpty:function(t,e){var i=this.stateApi&&n.isFunction(this.stateApi.collect)?this.stateApi:void 0;i&&i.collect(e,{region:t})},setStateApi:function(t){this.stateApi=t,this._initStateApi()},removeView:function(t){"detach"===(this.getOption("removeBehavior")||"destroy")?this.detachView(t):this.destroyView(t)},getParentView:function(){return this._parentView}});at.Detachable=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=n.extend({},t,{removeBehavior:"detach"});return this.extend(e)};var lt=x(e.View).with(W,C).extend({instantRender:!1,renderOnReady:!1,constructor:function(){this._fixRegionProperty();for(var t=arguments.length,n=Array(t),i=0;i<t;i++)n[i]=arguments[i];e.View.apply(this,n);var r=n[0];this.mergeOptions(r,["instantRender","renderOnReady","triggerReady","manualAfterInitialize"]),!0===this.renderOnReady&&this.once("ready",this.render),!0!==this.instantRender||this.renderOnReady?!0===this.instantRender&&!0===this.renderOnReady&&this.triggerReady():this.render()},_fixRegionProperty:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=this.getProperty("detachableRegion");null==e&&(e=!0===t.detachableRegion);var n=this.getProperty("stateApi");null==n&&(n=t.stateApi);var i=n?at.extend({stateApi:n}):at;this.regionClass=e?i.Detachable():i},triggerReady:function(){this.trigger("ready",this)},stateApi:function(){var t=this.getOption("stateApiOptions");return new A(t)},stateApiOptions:function(){var t=this;return{storeIdPrefix:function(){return t.getOption("id")},states:["scrollable"]}}}),ht=P.extend({initialize:function(t){this.mergeOptions(t,["name","channelName","noRadio"]),!0!==this.noRadio&&null==this.channelName&&(this.channelName=name)},getStore:function(){return this.store||(this.store={}),this.store},radioRequest:{get:function(){this.get.apply(this,arguments)},set:function(t,e){this.set(t,e)}},get:function(t){var e=f(this.getStore(),t);if(n.isFunction(e)){for(var i=arguments.length,r=Array(i>1?i-1:0),o=1;o<i;o++)r[o-1]=arguments[o];e=e.apply(this,r)}return e},set:function(t,e){var n=this.getStore();d(n,t,e);this.triggerSet(t,e)},triggerSet:function(t,e){if(t){var n=t.split("/"),i=this.getChannel();do{var r=n.join(":");this.triggerMethod(r,e),i&&i.trigger(r,e),n.pop()}while(n.length>0)}}});function ut(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return e.name=t,new ht(e)}var ct=new ut("yat:modals:singleton",{noRadio:!0}),gt={bg:!0,close:!0},dt={closeOnClickOutside:!0,closeOnPromise:!0,preventClose:!1,asPromise:!1},ft={wrapper:"yat-modal-wrapper",bg:"yat-modal-bg",contentWrapper:"yat-modal-content-wrapper",close:"yat-modal-close",header:"yat-modal-header",content:"yat-modal-content",actions:"yat-modal-actions",resolve:"yat-modal-resolve",reject:"yat-modal-reject"},pt={close:"&times;",resolve:"ok",reject:"cancel"},vt={"after:render":{centering:function(){var t=this.$("[data-role=modal-content-wrapper]");if(t.length){var e=t.outerHeight(),n=(i(window).height()-e)/3;n>0&&t.length&&t.css({"margin-top":n+"px"})}}}},mt={full:{css:ft,show:gt,labels:pt,options:dt,modifiers:vt},simple:{css:ft,show:{bg:!1,close:!1},labels:pt,options:dt,modifiers:vt},confirm:{css:ft,show:gt,labels:pt,options:{closeOnClickOutside:!0,closeOnPromise:!0,preventClose:!1,asPromise:!0},modifiers:vt}};ct.set("types.full",mt.full),ct.set("types.simple",mt.simple),ct.set("types.confirm",mt.confirm),ct.set("defaultShow",gt),ct.set("defaultCss",ft),ct.set("defaultLabels",pt),ct.set("defaultModifiers",vt);var yt=n.template("<% if(show.bg) {%><div <%= css('bg') %> data-role=\"modal-bg\"></div><% } %>\n<div <%= css('contentWrapper') %> data-role=\"modal-content-wrapper\">\n\t<% if(show.close) {%><button  <%= css('close') %> data-role=\"modal-close\"><%= label('close') %></button><% } %>\n\t<% if(show.header) {%><header <%= css('header') %> data-role=\"modal-header\"><%= header %></header><% } %>\n\t<div <%= css('content') %> data-role=\"modal-content\"><%= text %></div>\n\t<% if(show.actions) {%>\n\t<div <%= css('actions') %> data-role=\"modal-actions\">\n\t\t<% if(show.resolve) {%><button <%= css('resolve') %> data-role=\"modal-resolve\"><%= label('resolve') %></button><% } %>\n\t\t<% if(show.reject) {%><button <%= css('reject') %> data-role=\"modal-reject\"><%= label('reject') %></button><% } %>\n\t</div>\n\t<% } %>\n</div>\n"),_t=x(lt).with(C).extend({renderOnReady:!0,template:yt,attributes:function(){return{"data-role":"modal-wrapper"}},initialize:function(t){var e=this;this.mergeOptions(t,["content","header","text"]);var n=this;!0===this.getOption("asPromise")&&(this.promise=new Promise(function(t,e){n.once("resolve",function(e){return t(e)}),n.once("reject",function(t){return e(t)})})),this.once("resolve reject",function(t,n){e.preventClose=!1,e.getConfigValue("options","closeOnPromise")&&!n&&e.destroy()}),this.on("all",function(t){return e.applyModifiers(t)})},canBeClosed:function(){return!0!==this.getConfigValue("options","preventClose")},destroy:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if(this.canBeClosed()||!0===t.force)return lt.prototype.destroy.apply(this,arguments)},ui:{bg:'[data-role="modal-bg"]',contentWrapper:'[data-role="modal-content-wrapper"]',text:'[data-role="modal-content"]',header:'[data-role="modal-header"]',close:'[data-role="modal-close"]',resolve:'[data-role="modal-resolve"]',reject:'[data-role="modal-reject"]'},triggers:{"click @ui.close":{event:"click:close",stopPropagation:!0},"click @ui.reject":{event:"click:reject",stopPropagation:!0},"click @ui.resolve":{event:"click:resolve",stopPropagation:!0},"click @ui.text":{event:"click:content",stopPropagation:!0},"click @ui.contentWrapper":{event:"click:content:wrapper",stopPropagation:!0},"click @ui.bg":{event:"click:bg",stopPropagation:!0},click:{event:"click:wrapper",stopPropagation:!0}},regions:{content:'[data-role="modal-content"]'},onBeforeDestroy:function(){this.trigger("reject",this.getProperty("reject"),!0)},onClickClose:function(){this.destroy()},onClickResolve:function(){this.trigger("resolve",this.getProperty("resolve"))},onClickReject:function(){this.trigger("reject",this.getProperty("reject"))},onClickBg:function(){this.clickedOutsideOfModal()},onClickWrapper:function(){this.clickedOutsideOfModal()},clickedOutsideOfModal:function(){!0===this.getConfigValue("options","closeOnClickOutside")&&this.destroy()},onBeforeRender:function(){var t=this.getConfig();t.css.wrapper&&this.$el.addClass(t.css.wrapper),this.$el.appendTo(i("body"))},onRender:function(){this.content instanceof t.View&&(this.content.inModal=this,this.showChildView("content",this.content)),this.applyModifiers("after:render")},_getModalOptions:function(){var t={};return null!=this.getOption("closeOnClickOutside")&&(t.closeOnClickOutside=this.getOption("closeOnClickOutside")),null!=this.getOption("closeOnPromise")&&(t.closeOnPromise=this.getOption("closeOnPromise")),null!=this.getOption("preventClose")&&(t.preventClose=this.getOption("preventClose")),null!=this.getOption("asPromise")&&(t.asPromise=this.getOption("asPromise")),t},getConfigValue:function(t,e){return((this.getConfig()||{})[t]||{})[e]},getConfig:function(t){if(this.config)return this.config;var e=this.getOption("type")||"simple",i=n.extend({},ct.get("types."+e)||{});return i.show=n.extend({},ct.get("dafaultShow"),i.show,this.getOption("show")),i.labels=n.extend({},ct.get("defaultLabels"),i.labels,this.getOption("labels")),i.css=n.extend({},ct.get("defaultCss"),i.css,this.getOption("css")),i.modifiers=n.extend({},ct.get("defaultModifiers"),i.modifiers,this.getOption("modifiers")),i.options=n.extend({},ct.get("defaultOptions"),i.options,this._getModalOptions()),null==i.show.header&&this.getOption("header")&&(i.show.header=!0),null==i.show.resolve&&(this.getOption("resolve")||i.options.asPromise)&&(i.show.resolve=!0),null==i.show.reject&&this.getOption("reject")&&(i.show.reject=!0),null==i.show.actions&&(i.show.resolve||i.show.reject)&&(i.show.actions=!0),this.config=i},applyModifiers:function(t){var e=this,i=this.getConfigValue("modifiers",t);n(i).each(function(t){return n.isFunction(t)&&t.call(e)})},templateContext:function(){var t=this.getConfig();return{css:function(e){return t.css[e]?' class="'+t.css[e]+'"':""},label:function(e){return t.labels[e]||""},show:t.show,text:this.getOption("text"),header:this.getOption("header")}}}),bt=new(x(P).with(E).extend({constructor:function(){var t=this;this.modals=[];for(var e=arguments.length,r=Array(e),o=0;o<e;o++)r[o]=arguments[o];P.apply(this,r),this.listenForEsc=n.bind(this._listenForEsc,this),i(function(){t.doc=i(document),t.doc.on("keyup",t.listenForEsc)})},channelName:"modals",show:function(){var t=this._normalizeArguments.apply(this,arguments);return this._create(t)},remove:function(t){t||(t=n.last(this.modals)),t&&t.destroy()},_listenForEsc:function(t){27===t.keyCode&&this.modals.length&&this.remove()},_create:function(t){var e=new _t(t),n=this;return this.listenToOnce(e,"destroy",function(){n._remove(e)}),this.modals.push(e),e},_remove:function(t){if(t){var e=this.modals.indexOf(t);e>-1&&this.modals.splice(e,1),this.stopListening(t)}},_normalizeArguments:function(){var t={},e=arguments.length;if(e){if(1===e)y.isView(arguments.length<=0?void 0:arguments[0])?t.content=arguments.length<=0?void 0:arguments[0]:n.isString(arguments.length<=0?void 0:arguments[0])?t.text=arguments.length<=0?void 0:arguments[0]:n.isObject(arguments.length<=0?void 0:arguments[0])&&n.extend(t,arguments.length<=0?void 0:arguments[0]);else if(2===e)n.isString(arguments.length<=0?void 0:arguments[0])&&n.isString(arguments.length<=1?void 0:arguments[1])?(t.header=arguments.length<=0?void 0:arguments[0],t.text=arguments.length<=1?void 0:arguments[1]):n.isString(arguments.length<=0?void 0:arguments[0])&&y.isView(arguments.length<=1?void 0:arguments[1])?(t.header=arguments.length<=0?void 0:arguments[0],t.content=arguments.length<=1?void 0:arguments[1]):n.isString(arguments.length<=1?void 0:arguments[1])&&y.isView(arguments.length<=0?void 0:arguments[0])?(t.header=arguments.length<=1?void 0:arguments[1],t.content=arguments.length<=0?void 0:arguments[0]):n.isString(arguments.length<=0?void 0:arguments[0])&&n.isObject(arguments.length<=1?void 0:arguments[1])?(n.extend(t,arguments.length<=1?void 0:arguments[1]),y.isView(t.content)?t.header=arguments.length<=0?void 0:arguments[0]:t.text=arguments.length<=0?void 0:arguments[0]):y.isView(arguments.length<=0?void 0:arguments[0])&&n.isObject(arguments.length<=1?void 0:arguments[1])&&(n.extend(t,arguments.length<=1?void 0:arguments[1]),t.content=arguments.length<=0?void 0:arguments[0]);else{n.isObject(arguments.length<=3?void 0:arguments[3])&&n.extend(t,arguments.length<=3?void 0:arguments[3]),n.isObject(arguments.length<=2?void 0:arguments[2])?n.extend(t,arguments.length<=2?void 0:arguments[2]):n.isString(arguments.length<=2?void 0:arguments[2])&&(t.type=arguments.length<=2?void 0:arguments[2]);var i=this._normalizeArguments(arguments.length<=0?void 0:arguments[0],arguments.length<=1?void 0:arguments[1]);n.extend(t,i)}return t}},onBeforeDestroy:function(){this.doc&&this.doc.off("keyup",this.listenForEsc)}})),wt={show:function(){return bt.show.apply(bt,arguments)},addTypeConfig:function(t,e){t&&n.isString(t)&&ct.set("types."+t,e)},getTypeConfig:function(t){if(t&&n.isString(t))return ct.get("types."+t)}},St={TemplateContext:Y,identity:st,modals:wt},xt=x(e.Application).with(C,O,I,N),Ct=xt.extend({initRadioOnInitialize:!0,_initRegion:function(){if(!(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{skip:!0}).skip){var t=this.getProperty("region");this.region=t,xt.prototype._initRegion()}},getRegion:function(){return this._region||this._initRegion({skip:!1}),this._region},addPageManager:function(t){this._pageManagers||(this._pageManagers=[]),this._pageManagers.push(t);t.getName()||console.warn("pageManager prefix not defined")},hasPageManagers:function(){return this._pageManagers&&this._pageManagers.length>0},getMenuTree:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{rebuild:!1};if(this._menuTree&&!e.rebuild)return this._menuTree;var i=this._pageManagers||[],r=n(i).chain().map(function(t){return t.getLinks()}).flatten().value();return this._menuTree=new t.Collection(r),this._menuTree},getCurrentPages:function(){var t=n(this._pageManagers).map(function(t){return t.getCurrentPage()});return n(t).filter(function(t){return null!=t})},isCurrentPage:function(t){return this.getCurrentPages().indexOf(t)>-1},getPage:function(t){if(this.hasPageManagers())return n(this._pageManagers).find(function(e){return e.getPage(t)})}}),Ot=t.Model.extend({}),Pt=Ot.extend({defaults:{url:void 0,label:void 0,target:"_self",level:0},destroy:function(){this.id=null,Ot.prototype.destroy.apply(this,arguments)}});function Mt(t){if(Array.isArray(t)){for(var e=0,n=Array(t.length);e<t.length;e++)n[e]=t[e];return n}return Array.from(t)}var kt=x(Ct).with(R),At=kt.extend({constructor:function(){for(var t=arguments.length,e=Array(t),n=0;n<t;n++)e[n]=arguments[n];kt.apply(this,e),this.initializeYatPage()},allowStopWithoutStart:!0,allowStartWithoutStop:!0,initializeYatPage:function(t){this.mergeOptions(t,["manager"]),this._initializeLayoutModels(t),this._initializeRoute(t),this._registerIdentityHandlers()},getLayout:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{rebuild:!1};return(!this._layoutView||t.rebuild||this._layoutView&&this._layoutView.isDestroyed&&this._layoutView.isDestroyed())&&this.buildLayout(),this._layoutView},prepareForStart:function(){},buildLayout:function(){var t=this.getProperty("Layout");if(null!=t){var e=n.extend({},this.getProperty("layoutOptions"));this.model&&!e.model&&n.extend(e,{model:this.model}),this.collection&&!e.collection&&n.extend(e,{collection:this.collection});var i=this.buildLayoutOptions(e);return i.page=this,this._layoutView=new t(i),this._layoutView}},buildLayoutOptions:function(t){return t},addModel:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(t){this.model=t;var n=e.fetch||this.getOption("fetchModelOnAdd");void 0===n&&(n=this.getProperty("fetchDataOnAdd")),!0===n&&this.addStartPromise(t.fetch(e))}},addCollection:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(t){this.collection=t;var n=e.fetch||this.getOption("fetchCollectionOnAdd");void 0===n&&(n=this.getProperty("fetchDataOnAdd")),!0===n&&this.addStartPromise(t.fetch(e))}},freezeWhileStarting:!0,freezeUI:function(){},unFreezeUI:function(){},getRouteHash:function(){var t=[{},this._routeHandler].concat(this.getChildren({startable:!1}).map(function(t){return t.getRouteHash()}));return n.extend.apply(n,Mt(t))},hasRouteHash:function(){return n.isObject(this.getRouteHash())},_initializeRoute:function(){var t=this.getRoute({asPattern:!0});if(null!=t){var e=this;this._routeHandler=(n={},i=t,r={context:e,action:function(){return e.start.apply(e,arguments)}},i in n?Object.defineProperty(n,i,{value:r,enumerable:!0,configurable:!0,writable:!0}):n[i]=r,n);var n,i,r}},getRoute:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{asPattern:!1},e=this.getProperty("relativeRoute"),n=this.getProperty("route"),i=this.getParent();if(null!=n){var r=n;if(e&&i&&i.getRoute){r=i.getRoute()+"/"+n}return this._normalizeRoute(r,t)}},_normalizeRoute:function(t,e){if(t=t.replace(/\/+/gim,"/").replace(/^\//,""),e.asPattern)return t;return t.replace(/\(\/\)/gim,"/").replace(/\/+/gim,"/")},getLinkModel:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;if(this._canHaveLinkModel()){if(this._linkModel)return this._linkModel;var e=this.getRoute(),n=this.getLabel(),i=this._getSublinks(t);return this._linkModel=new Pt({url:e,label:n,level:t,children:i}),this._linkModel}},_canHaveLinkModel:function(){return!(!0===this.getProperty("skipMenu")||this.getProperty("isStartNotAllowed"))},_destroyLinkModel:function(){this._linkModel&&(this._linkModel.destroy(),delete this._linkModel)},getParentLinkModel:function(){var t=this.getParent();if(t&&t.getLinkModel){return t.getLinkModel()}},getNeighbourLinks:function(){var t=this.getLinkModel();if(t&&t.collection)return t.collection},getChildrenLinks:function(){var t=this.getLinkModel();if(t)return t.get("children")},_getSublinks:function(e){var i=this.getChildren();if(i&&i.length){var r=n(i).chain().filter(function(t){return!0!==t.getProperty("skipMenu")}).map(function(t){return t.getLinkModel(e+1)}).value();if(r.length){return new t.Collection(r)}}},_initializeLayoutModels:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this.addModel(t.model,t),this.addCollection(t.collection,t)},_proxyEvents:function(){var t=this._getProxyContexts();this._proxyEventsTo(t)},_getProxyContexts:function(){var t=[],e=this.getProperty("manager");e&&t.push({context:e});var n=this.getChannel();if(n){var i=this.getProperty("proxyEventsToRadio");t.push({context:n,allowed:i})}return t},_proxyEventsTo:function(t){var e=[],i={};n(t).each(function(t){t.allowed?n(t.allowed).each(function(e){i[e]||(i[e]=[]),i[e].push(t.context)}):e.push(t.context)});var r=this;r.on("all",function(t){for(var o=arguments.length,s=Array(o>1?o-1:0),a=1;a<o;a++)s[a-1]=arguments[a];var l=t in i?i[t]:e,h=[r].concat(s);n(l).each(function(e){return e.triggerMethod.apply(e,["page:"+t].concat(Mt(h)))})})},_buildChildOptions:function(t){var e={},i=this.getProperty("manager");return i&&(e.manager=i),n.extend(t,this.getProperty("childOptions"),e)},_registerIdentityHandlers:function(){var t=this;this.listenTo(st,"change",function(){t._destroyLinkModel()})}}),Dt=x(Ct).with(R),Rt=Dt.extend({constructor:function(){for(var t=arguments.length,e=Array(t),n=0;n<t;n++)e[n]=arguments[n];Dt.apply(this,e),this._initializeYatPageManager.apply(this,e)},_initializeYatPageManager:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this.mergeOptions(t,["id","name","label"]),this._registerPageHandlers(t),this._registerIdentityHandlers(),this.createRouter()},throwChildErrors:!0,createRouter:function(){this._routesHash=this._prepareRouterHash();var t=this._prepareRouterOptions(this._routesHash),n=new e.AppRouter(t);this.setRouter(n)},_prepareRouterHash:function(){var t=this.getChildren({startable:!1}),e={};return n(t).each(function(t){n.isFunction(t.getRouteHash)&&n.extend(e,t.getRouteHash())}),e},_prepareRouterOptions:function(t){var e=this,i={},r={};return n(t).each(function(t,n){i[n]=n,r[n]=function(){for(var n=arguments.length,i=Array(n),r=0;r<n;r++)i[r]=arguments[r];e.startPage.apply(e,[t.context].concat(i))}}),{appRoutes:i,controller:r}},startPage:function(t){var e=this;this.routedPage=t;for(var n=arguments.length,i=Array(n>1?n-1:0),r=1;r<n;r++)i[r-1]=arguments[r];t.start.apply(t,i).catch(function(n){if(!0===e.getProperty("throwChildErrors"))throw n;var i="error"+(n.status?":"+n.status.toString():"");e.triggerMethod("error",n,t),"error"!=i&&e.triggerMethod(i,n,t)})},restartRoutedPage:function(){this.routedPage&&this.startPage(this.routedPage)},setRouter:function(t){this.router=t},getRouter:function(){return this.router},getLinks:function(){var t=this.getChildren();if(t)return n(t).chain().map(function(t){return t.getLinkModel()}).filter(function(t){return!!t}).value()},execute:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{silent:!0},n=this.getPage(t);if(!n)throw new S.NotFound("Route not found");n.start(e)},navigate:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{trigger:!0},n=this.getRouter();n?n.navigate(t,e):console.warn("router not found")},getPage:function(t){var e=n(this._routesHash).find(function(e,n){return n===t||(e.context.getName()===t||void 0)});return e&&e.context},getCurrentPage:function(){return this.getState("currentPage")},isCurrentPage:function(t){return t===this.getCurrentPage()},navigateToRoot:function(){var t=this.getState("currentPage"),e=this.getProperty("rootUrl");if(!e){var n=this.getChildren();if(n&&n.length){var i=n.find(function(e){return e!=t});e=i&&i.getRoute()}}null!=e?this.navigate(e):console.warn("root page not found")},_buildChildOptions:function(t){return n.extend(t,this.getProperty("childOptions"),{manager:this})},_registerPageHandlers:function(){this.on("page:before:start",this._pageBeforeStart),this.on("page:start",this._pageStart),this.on("page:start:decline",this._pageDecline)},_pageBeforeStart:function(t){var e=this.getState("currentPage");e&&e!=t&&e.stop()},_pageStart:function(t){this.setState("currentPage",t);for(var e=arguments.length,n=Array(e>1?e-1:0),i=1;i<e;i++)n[i-1]=arguments[i];this.triggerMethod.apply(this,["page:start",t].concat(n))},_pageDecline:function(){},_registerIdentityHandlers:function(){var t=this;this.listenTo(st,"change",function(){t._moveToRootIfCurrentPageNotAllowed()||t.restartRoutedPage()}),this.listenTo(st,"token:expired",this.tokenExpired)},tokenExpired:function(){this.restartRoutedPage()},_moveToRootIfCurrentPageNotAllowed:function(){var t=this.routedPage;if(t&&t.isStartNotAllowed())return this.navigateToRoot(),!0}}),Et=x(e.NextCollectionView).with(W),jt=t.Collection.extend({}),Vt=P.extend({collection:void 0,groupBy:void 0,getGroups:function(){return this.groups},getGroup:function(t){return this.getGroups()[t]},isGroupExists:function(t){return t in this.getGroups()},addGroup:function(t,e){if(!this.isGroupExists(t)){var n=this.getGroups();return n[t]=this._createGroup(t,e),n[t]}},removeGroup:function(t){var e=this.getGroup(t);e&&(n.isFunction(e.destroy)?e.destroy():n.isFunction(e.stopListening)&&e.stopListening(),delete this.groups[t])},group:function(){var t={},e=this.collection.groupBy(this.groupBy),i=this.getOption("groups");return n(i).each(function(n){n in e?(t[n]=e[n],delete e[n]):t[n]=[]}),n(e).each(function(e,n){return t[n]=e}),t},constructor:function(t){P.apply(this,arguments),this._initializeGrouppedCollection(t)},_initializeGrouppedCollection:function(t){1!=this._initializedGC&&(this.mergeOptions(t,["collection","groupBy"]),this._ensureOptions(),this._initializeGroups(),this._initializeEventHandlers(),this._initializedGC)},_ensureOptions:function(){if(!this.collection)throw new Error("collection must be set");if(!this.groupBy)throw new Error("groupBy must be set");if("string"==typeof this.groupBy){var t=this.getOption("groupBy");this.groupBy=function(e){return e.get(t)}}},_initializeGroups:function(){var t=this;this.groups={};var e=this.group();n(e).each(function(e,n){return t.addGroup(n,e)})},_getCollectionClass:function(){return this.getOption("CollectionClass")||jt},_createGroup:function(t,e){var n=this.groupBy,i=new(this._getCollectionClass())(e);return i.on("change",function(e){n(e)!==t&&i.remove(e)}),i.name=t,i},_initializeEventHandlers:function(){this.listenTo(this.collection,"update",this._onCollectionUpdate)},_onCollectionUpdate:function(t,e){var i=this,r=(e.changes.added||[]).concat(e.changes.merged||[]),o=n(r).groupBy(this.groupBy),s=n(e.changes.removed).groupBy(this.groupBy),a=this.groups;n(o).each(function(t,e){e in a?a[e].add(t):i.getOption("autoCreateNewGroups")&&i.addGroup(e,t)}),n(s).each(function(t,e){e in a&&a[e].remove(t)})},_onModelChange:function(t){var e=this.groupBy(t);this.groups[e]?this.groups[e].add(t):console.warn("model is out of groupping",t,e)},destroy:function(){n(this.groups).each(function(t){t.stopListening(),n.isFunction(t.destroy)&&t.destroy()}),delete this.groups,n.isFunction(P.prototype.destroy)&&P.prototype.destroy.apply(this,arguments),n.isFunction(this.collection.destroy)&&this.collection.destroy(),delete this.collection}});return{VERSION:"0.0.32",Functions:_,Helpers:D,Mixins:X,Behaviors:it,Singletons:St,TemplateContext:Y,modals:wt,identity:st,createConfig:ut,Object:P,Error:S,App:Ct,Page:At,PageManager:Rt,View:lt,CollectionView:Et,Region:at,Model:Ot,Collection:jt,CollectionGroups:Vt}}),this&&this.Marionette&&(this.Marionette.Yat=this.MarionetteYat);
//# sourceMappingURL=marionette.yat.min.js.map