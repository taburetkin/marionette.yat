/**
* @license
* Marionette.Yat extension for Backbone.Marionette
* Yet Another Toolkit
* ----------------------------------
* v0.0.21
*
* Distributed under MIT license
* author: dimtabu
*/
!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e(require("backbone"),require("backbone.marionette"),require("underscore"),require("jquery")):"function"==typeof define&&define.amd?define(["backbone","backbone.marionette","underscore","jquery"],e):t.MarionetteYat=e(t.Backbone,t.Marionette,t._,t.$)}(this,function(t,e,i,n){"use strict";t=t&&t.hasOwnProperty("default")?t.default:t,e=e&&e.hasOwnProperty("default")?e.default:e,i=i&&i.hasOwnProperty("default")?i.default:i,n=n&&n.hasOwnProperty("default")?n.default:n;var r=function(i){return i instanceof t.Model?i:i instanceof e.View?i.model:void 0},o=function(e){return e instanceof t.View?e:void 0},s=function(t,e,i){return"function"==typeof i&&(t=i.call(t,r(t),o(t)),e=i.call(e,r(e),o(e))),t<e?-1:t>e?1:0},a={compareAB:s,viewComparator:function(){for(var t=arguments.length,e=Array(t),n=0;n<t;n++)e[n]=arguments[n];var r=[],o=0;return e.length>=2?s.apply(null,e):(1===e.length&&e[0]instanceof Array&&(r=e[0]),i(r).every(function(t){return 0===(o=s.apply(null,t))}),o)}};function l(t,e,n){return i.isFunction(e)&&(e=e.apply(t,n||[])),e}function h(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(null==n.fields||n.fileds&&!n.fileds.length)throw new Error("fields option missing");if(n.checked||(n.checked={}),null!=e){var r=void 0,o=e instanceof t.Model,s=i.isObject(e.options),a=n.exclude instanceof Array?n.exclude:"string"==typeof n.exclude?[n.exclude]:[];return i(n.fields).some(function(t){if(!(t in n.checked||(n.checked[t]=!0,a.indexOf(t)>=0)))return o&&null==r&&(r=l(e,e.get(t),n.args)),null==r&&(r=l(e,e[t],n.args)),null==r&&s&&(r=l(e,e.options[t],n.args)),null!=r}),null==r?n.default:r}}function u(t,e){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:":";return t||(t=""),t+i+(e=null==e?"":e.toString())}function c(e,n){if(null!=e&&i.isObject(e)&&null!=n&&""!=n)return e instanceof t.Model?e.get(n):e[n]}function g(e,i,n,r){return e instanceof t.Model?e.set(i,n,{silent:!0}):e[i]=n,n instanceof t.Model&&r.models.push({path:r.passPath.join(":"),property:i,model:n}),r.passPath.push(i),c(e,i)}var d=function(e,n,r,o){if(null!=e&&i.isObject(e)&&null!=n&&""!=n){var s=i.extend({},o);if(s.silent=!0===s.silent,s.force=!1!==s.force,!i.isObject(n)||n instanceof Array||(r=n.value,s.force=!1!==n.force,s.silent=!0===n.silent,n=n.path),s.path=n,s.passPath=[],s.models=[],null!=n&&""!=n){var a="string"==typeof n?n.split("."):n instanceof Array?[].slice.call(n):[n];if(s.pathArray=[].slice.call(a),a.length){a.length;var l=a.shift();e instanceof t.Model&&s.models.push({path:"",property:l,model:e});var h=function t(e,n,r,o,s){if(null!=e&&i.isObject(e)&&null!=n&&""!=n){if(!r.length)return g(e,n,o,s);var a=c(e,n);if(i.isObject(a)||s.force)return!i.isObject(a)&&s.force&&(a=g(e,n,{},s)),t(a,r.shift(),r,o,s)}}(e,l,a,r,s);if(void 0===h&&void 0!==r)return h;if(!s.silent)for(var u=s.pathArray.join(":");s.models.length;){var d=s.models.pop(),f=""==d.path?u:u.substring(d.path.length+1);f&&d.model.trigger("change:"+f,r),d.model.trigger("change",d.model)}return h}}}};function f(t,e){if(null!=t&&i.isObject(t)&&null!=e&&""!=e){var n="string"==typeof e?e.split("."):e instanceof Array?[].slice.call(e):[e];return function t(e,n,r){if(null!=e&&i.isObject(e)&&null!=n&&""!=n){var o=c(e,n);return!r.length||r.length&&null==o?o:t(o,r.shift(),r)}}(t,n.shift(),n)}}var p="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t};function v(e){if(null!=e&&i.isObject(e)){var n={};return function e(i,n){if(n=n||"",null!=this&&"object"==p(this))for(var r=this instanceof t.Model?this.attributes:this,o=Object.getOwnPropertyNames(r),s=0;s<o.length;s++){var a=o[s],l=this[a];null==l||"object"!=(void 0===l?"undefined":p(l))||l instanceof Date||l instanceof Array?i[n+a]=l:"object"==(void 0===l?"undefined":p(l))&&e.call(l,i,n+a+".")}}.call(e,n),n}}function m(t){if(null!=t&&i.isObject(t)){var e={};for(var n in t)d(e,n,t[n],!0);return e}}var y={getLabel:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return e.fields=["getLabel","label","getName","name","getValue","value"].concat(e.fields||[]),h(t,e)},getName:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return e.fields=["getName","name","getLabel","label","getValue","value"].concat(e.fields||[]),h(t,e)},getValue:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return e.fields=["getValue","value","getId","id","getName","name","getLabel","label","cid"].concat(e.fields||[]),h(t,e)},wrap:u,unwrap:function(t,e){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:":";if(null!=t){if(t=t.toString(),e||(e=""),!t.length)return t;var n=new RegExp("^"+e+i);return t.replace(n,"")}},setByPath:d,getByPath:f,flattenObject:v,unFlattenObject:m,isView:function(e){return e instanceof t.View}},_={view:a,common:y},b=[t.Model,t.Collection,t.View,t.Router,e.Object];function w(t){var e=i.isFunction(t),n=i(b).some(function(e){return t===e||t.prototype instanceof e});return e&&n}var S=e.Error.extend({},{Http400:function(t){return this.Http(400,t)},Http401:function(t){return this.Http(401,t)},Http403:function(t){return this.Http(403,t)},Http404:function(t){return this.Http(404,t)},Http500:function(t){return this.Http(500,t)},Http:function(t,e){var i=new this({message:e,name:"HttpError"});return i.status=t,i},HttpRedirect:function(t){return this.Http(301,t)},NotFound:function(t){return this.Http404(t)},NotAuthorized:function(t){return this.Http401(t)},Forbidden:function(t){return this.Http403(t)}});function C(t){var n=null;if(i.isFunction(t))n=t;else{if(!i.isObject(t)||null===t)throw new Error("argument should be an object or class definition");var r=function(){};r.extend=e.extend,n=r.extend(t)}n.extend||((n=e.extend.call(t,{})).extend=e.extend);return{with:function(){for(var t=arguments.length,e=Array(t),r=0;r<t;r++)e[r]=arguments[r];return i.reduce(e,function(t,e){return function(t,e){if(i.isFunction(e))return e(t);if(i.isObject(e))return t.extend(e);throw new S("Mixin fail, argument should be an object hash or mixin function")}(t,e)},n)},class:n}}var P={isKnownCtor:w,mix:C};function O(t){return t.extend({getName:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=i.extend({},t);return e.exclude="getName",e.args=[e],y.getName(this,e)},getLabel:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=i.extend({},t);return e.exclude="getLabel",e.args=[e],y.getLabel(this,e)},getValue:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=i.extend({},t);return e.exclude="getValue",e.args=[e],y.getValue(this,e)}})}var x=function(t){return t.extend({getProperty:function(t,e){return this._getOptionOrProperty(this,t,e,this.getOption)},getOption:function(t,e){return this._getOptionOrProperty(this.getProperty("options",{deep:!1}),t,e,this.getProperty)},_getOptionOrProperty:function(t,e){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},r=arguments[3];if(void 0!==n.deep||(n.deep=!0),void 0!==n.force||(n.force=!0),n.args||(n.args=[]),null!=e&&null!=t){var o=t[e];if(void 0===o&&n.deep&&i.isFunction(r)){var s=i.extend({},n,{deep:!1,force:!1});o=r.call(this,e,s)}return i.isFunction(o)&&n.force&&!w(o)&&(o=o.apply(this,n.args||[])),void 0===o?n.default:o}}})},M=function(t){return t.extend({constructor:function(){for(var e=arguments.length,i=Array(e),n=0;n<e;n++)i[n]=arguments[n];t.apply(this,i);var r=!(!0===this.getProperty("initRadioOnInitialize"));this._initRadio({skip:r})},getChannel:function(){return this._channel||this._initRadio({skip:!1}),this._channel},_initRadio:function(){if(1!=(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{skip:!0}).skip){if(!this.getProperty("channelName")){var t=this.getProperty("channel");t&&(this.channelName=t.channelName)}e.Object.prototype._initRadio.call(this)}},radioRequest:function(){var t=this.getChannel();t&&t.request.apply(t,arguments)},radioTrigger:function(){var t=this.getChannel();t&&t.trigger.apply(t,arguments)}})};var D=function(t){var e=t.extend({constructor:function(){for(var e=arguments.length,i=Array(e),n=0;n<e;n++)i[n]=arguments[n];t.apply(this,i),this.initializeStateable()},initializeStateable:function(){this._state={}},getState:function(t){var e=this._state;return t?e[t]:e},setState:function(t,e,n){if(null!=t)if(i.isObject(t)){var r=this;n=e,i(e=t).each(function(t,e){return r.setState(e,t,i.extend({},n,{doNotTriggerFullState:!0}))}),this._triggerStateChange(e,n)}else{this.getState()[t]=e,this._triggerStateChange(t,e,n)}},clearState:function(){var t=this.getState(),e=i.extend({},t);i(t).each(function(i,n){e[n]=void 0,delete t[n]}),this._triggerStateChange(e)},_triggerStateChange:function(t,e,n){if(i.isFunction(this.triggerMethod)){i.isObject(t)?(n=e,e=t,this.triggerMethod("state",e,n)):(this.triggerMethod("state:"+t,e,n),(!0===e||!1===e||e&&"string"==typeof e)&&this.triggerMethod("state:"+t+":"+e.toString(),n),(!n||n&&!n.doNotTriggerFullState)&&this.triggerMethod("state",(s=e,(o=t)in(r={})?Object.defineProperty(r,o,{value:s,enumerable:!0,configurable:!0,writable:!0}):r[o]=s,r),n));var r,o,s}}});return e.Stateable=!0,e},E="initialized",R="starting",k="running",A="stopping",j="waiting",V="destroyed";function L(t,e){var n=this;if(null==t||null==e)return Promise.resolve();var r=t["_"+e]||[],o=i.result(t,e)||[],s=r.concat(o),a=[];return i(s).each(function(t){i.isFunction(t)?a.push(t.call(n)):a.push(t)}),Promise.all(a)}function z(t,e,i){t[e]||(t[e]=[]);t[e].push(i)}var F=function(t){var e=C(t).with(D),n=e.extend({constructor:function(){for(var t=arguments.length,i=Array(t),n=0;n<t;n++)i[n]=arguments[n];e.apply(this,i),this.initializeStartable()},freezeWhileStarting:!1,freezeUI:function(){},unFreezeUI:function(){},isStartNotAllowed:function(){},isStopNotAllowed:function(){},addStartPromise:function(t){z(this,"_startRuntimePromises",t)},addStopPromise:function(t){z(this,"_stopPromises",t)},initializeStartable:function(){this.constructor.Startable&&this.constructor.Stateable&&(this._registerStartableLifecycleListeners(),this._setLifeState(E),this._startRuntimePromises=[],this._startPromises=[],this._stopPromises=[])},start:function(){for(var t=this,e=arguments.length,i=Array(e),n=0;n<e;n++)i[n]=arguments[n];var r=i[0],o=this._ensureStartableCanBeStarted(),s=null,a=null;if(o&&(a=function(){return t.triggerMethod("start:decline",o)},s=Promise.reject(o)),null==s){var l=this.isStartNotAllowed(r);l&&(a=function(){return t.triggerMethod("start:decline",l)},s=Promise.reject(l))}if(null==s){var h=this._getLifeState();this._tryMergeStartOptions(r),this.triggerMethod.apply(this,["before:start"].concat(i)),s=this._getStartPromise()}return s.then(function(){t.triggerStart(r)},function(e){return t._setLifeState(h),a&&a(),Promise.reject(e)})},triggerStart:function(t){this.triggerMethod("start",t)},stop:function(t){var e=this,i=this._ensureStartableCanBeStopped();if(i)return this.triggerMethod("stop:decline",i),Promise.reject(i);var n=this.isStopNotAllowed(t);if(n)return this.triggerMethod("stop:decline",n),Promise.reject(n);var r=this._getLifeState();this._tryMergeStopOptions(t),this.triggerMethod("before:stop",this,t);return this._getStopPromise().then(function(){e.triggerStop(t)},function(){e._setLifeState(r)})},triggerStop:function(t){this.triggerMethod("stop",t)},_setLifeState:function(t){this.setState("life",t)},_getLifeState:function(){return this.getState("life")},_isLifeState:function(t){return this._getLifeState()===t},_isLifeStateIn:function(){for(var t=this,e=arguments.length,n=Array(e),r=0;r<e;r++)n[r]=arguments[r];return i(n).some(function(e){return t._isLifeState(e)})},_isInProcess:function(){return this._isLifeStateIn(R,A)},_registerStartableLifecycleListeners:function(){var t=this,e=!0===this.getProperty("freezeWhileStarting");e&&i.isFunction(this.freezeUI)&&this.on("state:life:"+R,function(){t.freezeUI()}),e&&i.isFunction(this.unFreezeUI)&&this.on("start",function(){t.unFreezeUI()}),this.on("before:start",function(){return t._setLifeState(R)}),this.on("start",function(){return t._setLifeState(k)}),this.on("before:stop",function(){return t._setLifeState(A)}),this.on("stop",function(){return t._setLifeState(j)}),this.on("destroy",function(){return t._setLifeState(V)})},_tryMergeStartOptions:function(t){if(this.mergeOptions){var e=this.getProperty("mergeStartOptions")||[];this.mergeOptions(t,e)}},_tryMergeStopOptions:function(t){if(this.mergeOptions){var e=this.getProperty("mergeStopOptions")||[];this.mergeOptions(t,e)}},_ensureStartableIsIntact:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{throwError:!1},e=new S({name:"StartableLifecycleError",message:"Startable has already been destroyed and cannot be used."}),i=this._isLifeState(V);if(t.throwError&&i)throw e;if(i)return e},_ensureStartableIsIdle:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{throwError:!1},e="Startable is not idle. current state: "+this._getLifeState(),i=new S({name:"StartableLifecycleError",message:e}),n=this._ensureStartableIsIntact(t),r=this._isInProcess();if(t.throwError&&r)throw i;return n||(r?i:void 0)},_ensureStartableCanBeStarted:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{throwError:!1},e=new S({name:"StartableLifecycleError",message:"Startable has already been started."}),i=this._ensureStartableIsIdle(t),n=!0===this.getProperty("allowStartWithoutStop");if(i||!n){var r=this._isLifeState(k);if(t.throwError&&r)throw e;return i||(r?e:void 0)}},_ensureStartableCanBeStopped:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{throwError:!1},e=new S({name:"StartableLifecycleError",message:"Startable should be in `running` state."}),i=this._ensureStartableIsIdle(t),n=!0===this.getProperty("allowStopWithoutStart");if(i||!n){var r=this._isLifeState(k);if(t.throwError&&!r)throw e;return i||(r?void 0:e)}},_getStartPromise:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return Promise.all(this._getStartPromises(t))},_getStartPromises:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=[];return e.push(this._getStartParentPromise()),e.push(this._getStartPagePromise()),!0!==t.noruntime&&e.push(this._getStartRuntimePromise()),e},_getStartRuntimePromise:function(){return L(this,"startRuntimePromises")},_getStartPagePromise:function(){return L(this,"startPromises")},_getStartParentPromise:function(){var t=i.result(this,"getParent");if(i.isObject(t)&&i.isFunction(t._getStartPromise))return t._getStartPromise({noruntime:!0})},_getStopPromise:function(){return Promise.all(this._getStopPromises())},_getStopPromises:function(){var t=[];return t.push(this._getStopRuntimePromise()),t},_getStopRuntimePromise:function(){return L(this,"stopPromises")},_getStopParentPromise:function(){var t=i.result(this,"getParent");if(i.isObject(t)&&i.isFunction(t._getStopPromise))return t._getStopPromise()}});return n.Startable=!0,n},T=function(t){var e="_children",n=t.extend({constructor:function(){for(var e=arguments.length,i=Array(e),n=0;n<e;n++)i[n]=arguments[n];t.apply(this,i),this.initializeChildrenable.apply(this,i)},initializeChildrenable:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this._initializeParrent(t),this._initializeChildren(t)},hasChildren:function(){this.getChildren();return this[e].length>0},getChildren:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{startable:!0},i=this[e]||[];return t.startable?i.filter(function(t){return!t.getProperty("isStartNotAllowed")}):i},hasParent:function(){var t=this.getParent();return i.isObject(t)},getParent:function(){return this.getProperty("parent",{deep:!1})},_initializeChildren:function(){var t=this,n=this.getProperty("children"),r=[];i(n).each(function(e){var i=t._normalizeChildContext(e),n=t._initializeChild(i);n&&r.push(n)}),this[e]=r},_initializeChild:function(t){if(null!=t&&i.isFunction(t.Child)){var e=t.Child,n=this._normalizeChildOptions(t);return this.buildChild(e,n)}},_normalizeChildContext:function(t){var e={};return i.isFunction(t)&&t.Childrenable?i.extend(e,{Child:t}):i.isFunction(t)?e=this._normalizeChildContext(t.call(this)):i.isObject(t)&&(e=t),e},_normalizeChildOptions:function(t){var e=i.extend({},t);return!0===this.getOption("passToChildren")&&i.extend(e,this.options),e.parent=this,delete e.Child,this._buildChildOptions(e)},_buildChildOptions:function(t){return i.extend(t,this.getProperty("childOptions"))},buildChild:function(t,e){return new t(e)},_initializeParrent:function(t){null==this.parent&&null!=t.parent&&(this.parent=t.parent)}});return n.Childrenable=!0,n},B=[function(t){return{_v:t,_m:t.model||{},_cid:function(e){return u(t.cid,e)}}}],H={},I=!1;var N={mix:function(t){for(var e=arguments.length,n=Array(e>1?e-1:0),r=1;r<e;r++)n[r-1]=arguments[r];var o=this.get.apply(this,n);return i.extend(o,t)},get:function(){return this.compile.apply(this,arguments)},add:function(){for(var t=this,e=arguments.length,n=Array(e),r=0;r<e;r++)n[r]=arguments[r];i(n).each(function(e){return t.push(e)})},compile:function(){for(var t=arguments.length,e=Array(t),n=0;n<t;n++)e[n]=arguments[n];I&&(H={});var r={};return i(B).each(function(t){i.isFunction(t)?i.extend(r,function(t){for(var e=arguments.length,n=Array(e>1?e-1:0),r=1;r<e;r++)n[r-1]=arguments[r];return i.isFunction(t)?t.apply(void 0,n):i.isObject(t)?t:{}}.apply(void 0,[t].concat(e))):I&&i.extend(H,t)}),I||i.extend(r,H),I=!1,r},pop:function(){return I=!0,B.pop()},shift:function(){return I=!0,B.shift()},push:function(t){I=!0,B.push(t)},unshift:function(t){I=!0,B.unshift(t)},clear:function(){I=!1,H={},B=[]}},G=function(t){return t.extend({mixinTemplateContext:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=N.mix(i.result(this,"templateContext"),this);return i.extend(t,e)}})},Y={GetNameLabel:O,GetOptionProperty:x,Radioable:M,Stateable:D,Startable:F,Childrenable:T,GlobalTemplateContext:G},U=C(e.Behavior).with(x),W=U.extend({listenViewInitialize:!0,constructor:function(){!0===this.getProperty("listenViewInitialize")&&this.on("before:render initialize",i.once(i.partial(this.triggerMethod,"view:initialize"))),U.apply(this,arguments)},getModel:function(){return this.view.model},cidle:function(t){return y.wrap(this.view.cid,t)},unCidle:function(t){return y.unwrap(t,this.view.cid)}}),X=W.extend({triggerEl:void 0,moveBeforeStart:10,scope:"drag",getDragEventsContext:function(){return this.$doc},getDragEventsElementSelector:function(){return"*"},getTriggerEl:function(){if(this._$el)return this._$el;var t=this.getOption("triggerEl");if(null==t&&this.view.$el)this._$el=this.view.$el;else if(t&&t.jquery)this._$el=t;else if(t instanceof HTMLElement)this._$el=$(t);else{if("string"!=typeof t||!t.length)throw new Error("trigger element should be a DOM or jQuery object or string selector.",t);this._$el=this.view.$(t)}return this._$el},isSameScope:function(t){return t.scope===this.scope},shouldHandleDomEvents:function(t){return this.isSameScope(t)&&this!==t},constructor:function(){this._clearDragData(),this.$doc=$(document);for(var t=arguments.length,e=Array(t),i=0;i<t;i++)e[i]=arguments[i];W.apply(this,e),this._defineDocumentBindings()},_clearDragData:function(){this._dragData={}},_defineDocumentBindings:function(){this.__b={},this.__b.setupDragDetection=i.bind(this._setupDragDetection,this),this.__b.handleMouseUp=i.bind(this._handleMouseUp,this),this.__b.handleMoveAfterMouseDown=i.bind(this._handleMoveAfterMouseDown,this),this.__b.handleDragMove=i.bind(this._handleDragMove,this),this.__b.handleElementEnter=i.bind(this._handleElementEnter,this),this.__b.handleElementLeave=i.bind(this._handleElementLeave,this),this.__b.handleElementOver=i.bind(this._handleElementOver,this)},onInitialize:function(){this._initializeDragListener()},_initializeDragListener:function(){this.getTriggerEl().one("mousedown",this.__b.setupDragDetection)},_setupDragDetection:function(t){t.stopPropagation(),this.$doc.one("mouseup",this.__b.handleMouseUp),this._dragData.startX=t.pageX,this._dragData.startY=t.pageY,this.$doc.on("mousemove",this.__b.handleMoveAfterMouseDown)},_handleMouseUp:function(t){this._dragData.dragging?this._handleDragEnd(t):this._handleEndWithoutDrag(t),this._initializeDragListener()},_handleEndWithoutDrag:function(t){this.$doc.off("mousemove",this.__b.handleMoveAfterMouseDown)},_handleDragEnd:function(t){this._dragData.dragging=!1,this.$doc.off("mousemove",this.__b.handleDragMove);var e=this.getDragEventsContext();e.off("mouseenter",this.__b.handleElementEnter),e.off("mousemove",this.__b.handleElementOver),this._dragData.drop&&this._dragData.drop.context&&(this._dragData.drop.context.catchDraggable(this,this._dragData.drop),this.triggerMethod("drag:drop",this._dragData.drop)),this.triggerMethod("drag:end")},_handleMoveAfterMouseDown:function(t){t.stopPropagation();this._getStartPositionPixelOffset(t)>=this.getOption("moveBeforeStart")&&this._startDragSession()},_getStartPositionPixelOffset:function(t){var e=Math.abs(t.pageX-this._dragData.startX),i=Math.abs(t.pageY-this._dragData.startY);return e>i?e:i},_startDragSession:function(){this._dragData.dragging=!0,this.$doc.off("mousemove",this.__b.handleMoveAfterMouseDown),this.$doc.on("mousemove",this.__b.handleDragMove);var t=this.getDragEventsContext(),e=this.getDragEventsElementSelector();t.on("mouseenter",e,this.__b.handleElementEnter),t.on("mousemove",e,this.__b.handleElementOver),this.view.triggerMethod("drag:start")},_handleDragMove:function(t){t.stopPropagation(),this.triggerMethod("drag",t)},_handleElementEnter:function(t){var e=this,i=$(t.target);this._dragData.over!=i&&(this._dragData.over=i,i.trigger("drag:enter",this),i.one("mouseleave",function(){return e.trigger("drag:leave",e)}))},_handleElementLeave:function(t){$(t.target).trigger("drag:leave",this)},_handleElementOver:function(t){var e=$(t.target),i=this._createCustomDomEvent("drag:over",t);e.trigger(i,this)},_createCustomDomEvent:function(t,e,n){n||(n=["pageX","pageY","clientX","clientY","offsetX","offsetY","target"]);var r=jQuery.Event(t);return i(n).each(function(t){return r[t]=e[t]}),r}}),q=X.extend({useGhost:!0,viewCssClass:"dragging",ghostCssClass:"ghost",constructor:function(){for(var t=arguments.length,e=Array(t),i=0;i<t;i++)e[i]=arguments[i];X.apply(this,e),this.on("drag",this._onDrag),this.on("drag:start",this._onDragStart),this.on("drag:end",this._onDragEnd)},events:{"drag:enter":function(t,e){this.shouldHandleDomEvents(e)},"drag:over":function(t,e){if(this.isSameScope(e)){t.stopPropagation();var i=this._createCustomDomEvent("drag:over",t),n=this.$el.parent();n&&n.trigger(i,[e,this])}}},_onDragEnd:function(t){this.getOption("useGhost")&&this._removeGhost(),this.getOption("viewCssClass")&&this.view.$el.removeClass(this.getOption("viewCssClass")),this._clearDragData()},_onDragStart:function(t){this.getOption("useGhost")&&this._createGhost(),this.getOption("viewCssClass")&&this.view.$el.addClass(this.getOption("viewCssClass"))},_onDrag:function(t){this.setGhostPosition(t.pageY,t.pageX)},_removeGhost:function(){this.$ghost.remove(),delete this.$ghost},createGhost:function(){var t=this.$el.clone(),e=this.$el.offset(),i=e.top,n=e.left;return t.css({top:i+"px",left:n+"px",width:this.$el.width(),height:this.$el.height()}),t},_createGhost:function(){var t=this.createGhost();"absolute"!=t.css("position")&&t.css("position","absolute");var e=this.getOption("ghostCssClass");e&&t.addClass(e),t.appendTo($("body")),this._setGhost(t)},_setGhost:function(t){this.$ghost=t},getGhost:function(){return this.$ghost},setGhostPosition:function(t,e){var i=this.getGhost();i&&i.css({top:t+"px",left:e+"px"})}}),J=W.extend({scope:"drag",events:{"drag:over":"_onDomDragOver"},isSameScope:function(t){return t.scope===this.scope},getEventXY:function(t){return{x:t.pageX,y:t.pageY}},getChildren:function(){return i(this.view.children._views).filter(function(t){return t.model&&t.isRendered()&&t.isAttached()})},catchDraggable:function(t,e){this._onDrop(t,e)},constructor:function(){for(var t=arguments.length,e=Array(t),i=0;i<t;i++)e[i]=arguments[i];W.apply(this,e),this.listenTo(this.view,"render:children",this._onRenderChildren)},_onRenderChildren:function(){this.children=this.getChildren(),this.hasChildren=this.children.length>0},_onDomDragOver:function(t,e,n){if(this.isSameScope(e)&&(t.stopPropagation(),e!==n&&(!this.hasChildren||n))){e._dragData.drop||(e._dragData.drop={});var r=e._dragData.drop,o=this.getEventXY(t),s=this._getDropContext(o,n);s.context=this;var a=i.extend({},r,s),l=i.keys(a);i(l).some(function(t){return r[t]!==s[t]})&&(e._dragData.drop=s,this._onDropContextChange(e,s))}},_getDropContext:function(t,e){if(!(this.children||[]).length)return{insert:"before"};var i=e?e.$el:this.$el,n=this._getPositionByEventXY(t,i);return this._getDropContextByPosisiton(n,e)},_getPositionByEventXY:function(t,e){var i=e.offset(),n=e.outerWidth(),r=e.outerHeight(),o=i.left+n/2,s=i.top+r/2,a={x:void 0,y:void 0};return a.x=t.x<=o?"left":"right",a.y=t.y<=s?"top":"bottom",a},_getDropContextByPosisiton:function(t,e){var n="horizontal"==(this.getOption("direction")||"vertical")?"left"==t.x?"before":"after":"top"==t.y?"before":"after",r=void 0;return{insert:n,childView:r=e?e.view:"before"==n?this.children[0]:this.children.length&&i(this.children).last(),index:this.view.children._views.indexOf(r),noChild:!e}},_onDropContextChange:function(t,e){this.triggerMethod("drop:context:change",t,e)},_onDrop:function(t,e){this.triggerMethod("drop",t,e)}}),Q=W.extend({updateElementClass:function(t){var e=i.result(this.view,"className")||"",n=i.result(this.view,"dynamicClassName")||"";this.$el.attr({class:(e+" "+n).trim()})},refreshOnModelChange:!0,refreshOnDomChange:!1,refreshOnViewRefresh:!0,refreshOnViewBeforeRender:!0,refreshOnViewRender:!1,modelEvents:{change:function(){this.getProperty("refreshOnModelChange")&&this.updateElementClass("model:change")}},events:{change:function(){this.getProperty("refreshOnDomChange")&&this.updateElementClass("dom:change")}},onRefresh:function(){this.getProperty("refreshOnViewRefresh")&&this.updateElementClass("view:refresh")},onRender:function(){this.getProperty("refreshOnViewRender")&&this.updateElementClass("view:render")},onBeforeRender:function(){this.getProperty("refreshOnViewBeforeRender")&&this.updateElementClass("view:before:render")},onRefreshCssClass:function(){this.updateElementClass()},onSetupRefreshCssClass:function(t){var e=this;null!=t&&i.isObject(t)&&i(t).each(function(t,i){e[i]=!0===t})}});function K(t,e,i){return e in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i,t}var Z=C(W).with(D).extend({applyDelay:1,autoApplyToModel:!1,autoChangeModel:!1,fillFormFromModel:!0,applySelector:".apply",cancelSelector:".cancel",resetSelector:".reset",initialize:function(t){this.applyValue=i.debounce(this._applyValue,this.getProperty("applyDelay")),this.mergeOptions(t,["values"]),this.extendDefaultValues({})},extendDefaultValues:function(t){this._values=i.extend(this._values||{},t)},onViewInitialize:function(){var t=this.getModel();t&&this.extendDefaultValues(t.toJSON())},onRender:function(){this.firstRender||(this.buildFormBindings(),this.setState(this._tryFlatValues(this._values)),this.setValuesToForm(this.getValues({raw:!0}))),this.firstRender=!0},triggers:function(){var t;return K(t={},"click "+this.getProperty("applySelector"),"trigger:apply"),K(t,"click "+this.getProperty("cancelSelector"),"trigger:cancel"),K(t,"click "+this.getProperty("resetSelector"),"trigger:reset"),t},_tryFlatValues:function(t){return v(t)},_tryUnFlatValues:function(t){return m(t)},rollbackToDefaultValues:function(){this.clearState();var t=this._values,e=this._tryFlatValues(t);this.setState(e)},getValues:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=this.getState();if(t.raw)return e;return this._tryUnFlatValues(e)},onTriggerApply:function(){this._apply()},onTriggerCancel:function(){this._cancel()},onTriggerReset:function(){this._reset()},_apply:function(){var t=this.getValues();this.view.triggerMethod("values:apply",t),this._tryChangeModel(t)},_cancel:function(){this.rollbackToDefaultValues();var t=this._getFullHash(this._values);this.view.triggerMethod("values:cancel",t),this.setValuesToForm(t),this._tryChangeModel(t,{clear:!0})},_reset:function(){this.clearState();var t=this._getFullHash({});this.view.triggerMethod("values:reset",t),this.setValuesToForm(t),this._tryChangeModel(t,{clear:!0})},onState:function(t){this._tryChangeModel(t,{type:"property"})},_tryChangeModel:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},i="property"===e.type?"autoChangeModel":"autoApplyToModel";if(!0===this.getProperty(i)){var n=this.getModel();n&&(t=this._tryUnFlatValues(t),!0===e.clear&&n.clear(),n.set(t))}},_getFullHash:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=this.getModel()&&this.getModel().toJSON(),n=i.extend({},this.values,this.mappings,e),r={};return i(n).each(function(t,e){return r[e]=void 0}),i.extend(r,t)},buildFormBindings:function(){var t=this;this.mappings={};var e=["input","textarea","select"];this.$("[name]").each(function(i,n){if(-1!=e.indexOf(n.tagName.toLowerCase())){var r=t.unCidle(n.name);if(!(r in t.mappings)){var o=t._getElementInfo(n,e);o&&(t.mappings[r]=o)}}});var n={};i(this.mappings).each(function(t,e){t.values&&(n[e]=t.values)}),this.extendDefaultValues(n)},_getElementInfo:function(t,e){var i={name:t.name},n=void 0,r='[name="'+t.name+'"]',o=this.$(r);if(o.length){if(o.length>1){var s=[],a=!1;o.each(function(t,i){if(-1!=e.indexOf(i.tagName.toLowerCase())){var n=$(i);if("checkbox"!=i.type&&"radio"!=i.type||n.prop("checked")){var r=n.val();a||(a="checkbox"===i.type||r instanceof Array),r instanceof Array?s=s.concat(r):s.push(n.val())}}}),n=!s.length||1===s.length&&!a?s[0]:s}else n="checkbox"===o.get(0).type?o.prop("checked")?[o.val()]:[]:o.val();return i.values=n,i.isArray=n instanceof Array,i.$elements=o,i}},setValuesToForm:function(t){var e=this;i(t).each(function(t,i){var n=e.mappings[i].$elements,r=t instanceof Array?t:[t];n.each(function(t,i){e._setValueToElement(i,t,r)})})},_setValueToElement:function(t,e,i){var n=e<i.length&&i[e],r=t.jquery?t:$(t);"checkbox"===(t=r.get(0)).type||"radio"===t.type?r.prop("checked",i.indexOf(r.val())>=0):r.val(n)},events:{change:"domChange",input:"domInput"},domChange:function(t){this.applyValue(t.target.name,t.target,t)},domInput:function(t){this.applyValue(t.target.name,t.target,t)},_applyValue:function(t,e,i){"checkbox"==e.type?this._applyCheckboxValue(t,e,i):this._applySimpleValue(t,e,i)},_applySimpleValue:function(t,e,i){t=this.unCidle(t);var n=$(e);this.setState(t,n.val())},_applyCheckboxValue:function(t,e,i){var n='input[type=checkbox][name="'+t+'"]:checked',r=this.$(n).map(function(t,e){return e.value}).toArray();t=this.unCidle(t),this.setState(t,r)}}),tt={Behavior:W,Draggable:q,Droppable:J,DynamicClass:Q,FormToHash:Z},et=C(e.Object).with(x,M),it=C(et).with(D),nt=new(it.extend({constructor:function(){for(var t=arguments.length,e=Array(t),i=0;i<t;i++)e[i]=arguments[i];it.apply(this,e),this._initializeYatUser()},_initializeYatUser:function(){},channelName:"identity",isAnonym:function(){return!this.getState("id")},isUser:function(){return!this.isAnonym()},isMe:function(t){return t&&this.getState("id")===t},update:function(t){this.setState(t),this.trigger("change")},logIn:function(t){t.id&&(this.update(t),this.trigger("log:in"))},logOut:function(){this.clearState(),this.trigger("change"),this.trigger("log:out")}})),rt=C(e.View).with(G,x).extend({instantRender:!1,renderOnReady:!1,triggerReady:!1,manualAfterInitialize:!0,constructor:function(){for(var t=arguments.length,i=Array(t),n=0;n<t;n++)i[n]=arguments[n];e.View.apply(this,i);var r=i[0];this.mergeOptions(r,["instantRender","renderOnReady","triggerReady","manualAfterInitialize"]),!0===this.manualAfterInitialize&&this._afterInitialize()},_afterInitialize:function(){!0===this.instantRender&&this.render(),!0===this.renderOnReady&&this.once("ready",this.render),!0!==this.renderOnReady&&!0!==this.triggerReady||this.trigger("ready",this)}}),ot=et.extend({initialize:function(t){this.mergeOptions(t,["name","channelName","noRadio"]),!0!==this.noRadio&&null==this.channelName&&(this.channelName=name)},getStore:function(){return this.store||(this.store={}),this.store},radioRequest:{get:function(){this.get.apply(this,arguments)},set:function(t,e){this.set(t,e)}},get:function(t){var e=f(this.getStore(),t);if(i.isFunction(e)){for(var n=arguments.length,r=Array(n>1?n-1:0),o=1;o<n;o++)r[o-1]=arguments[o];e=e.apply(this,r)}return e},set:function(t,e){var i=this.getStore();d(i,t,e);this.triggerSet(t,e)},triggerSet:function(t,e){if(t){var i=t.split("/"),n=this.getChannel();do{var r=i.join(":");this.triggerMethod(r,e),n&&n.trigger(r,e),i.pop()}while(i.length>0)}}});var st=new function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return e.name=t,new ot(e)}("yat:modals:singleton",{noRadio:!0}),at={bg:!0,close:!0},lt={closeOnClickOutside:!0,closeOnPromise:!0,preventClose:!1,asPromise:!1},ht={wrapper:"yat-modal-wrapper",bg:"yat-modal-bg",contentWrapper:"yat-modal-content-wrapper",close:"yat-modal-close",header:"yat-modal-header",content:"yat-modal-content",actions:"yat-modal-actions",resolve:"yat-modal-resolve",reject:"yat-modal-reject"},ut={close:"&times;",resolve:"ok",reject:"cancel"},ct={full:{css:ht,show:at,labels:ut,options:lt},simple:{css:ht,show:{bg:!1,close:!1},labels:ut,options:lt},confirm:{css:ht,show:at,labels:ut,options:{closeOnClickOutside:!0,closeOnPromise:!0,preventClose:!1,asPromise:!0}}};st.set("types.full",ct.full),st.set("types.simple",ct.simple),st.set("types.confirm",ct.confirm),st.set("defaultShow",at),st.set("defaultCss",ht),st.set("defaultLabels",ut);var gt=i.template("<% if(show.bg) {%><div <%= css('bg') %> data-role=\"modal-bg\"></div><% } %>\n<div <%= css('contentWrapper') %> data-role=\"modal-content-wrapper\">\n\t<% if(show.close) {%><button  <%= css('close') %> data-role=\"modal-close\"><%= label('close') %></button><% } %>\n\t<% if(show.header) {%><header <%= css('header') %> data-role=\"modal-header\"><%= header %></header><% } %>\n\t<div <%= css('content') %> data-role=\"modal-content\"><%= text %></div>\n\t<% if(show.actions) {%>\n\t<div <%= css('actions') %> data-role=\"modal-actions\">\n\t\t<% if(show.resolve) {%><button <%= css('resolve') %> data-role=\"modal-resolve\"><%= label('resolve') %></button><% } %>\n\t\t<% if(show.reject) {%><button <%= css('reject') %> data-role=\"modal-reject\"><%= label('reject') %></button><% } %>\n\t</div>\n\t<% } %>\n</div>\n"),dt=C(rt).with(x).extend({renderOnReady:!0,template:gt,attributes:function(){return{"data-role":"modal-wrapper"}},initialize:function(t){var e=this;this.mergeOptions(t,["content","header","text"]);var i=this;!0===this.getOption("asPromise")&&(this.promise=new Promise(function(t,e){i.once("resolve",function(e){return t(e)}),i.once("reject",function(t){return e(t)})})),this.once("resolve reject",function(t,i){e.preventClose=!1,e.getConfigValue("options","closeOnPromise")&&!i&&(console.log("YAY"),e.destroy())})},canBeClosed:function(){return!0!==this.getProperty("preventClose")},destroy:function(){if(this.canBeClosed())return Mn.View.prototype.destroy.apply(this,arguments)},ui:{bg:'[data-role="modal-bg"]',contentWrapper:'[data-role="modal-content-wrapper"]',text:'[data-role="modal-content"]',header:'[data-role="modal-header"]',close:'[data-role="modal-close"]',resolve:'[data-role="modal-resolve"]',reject:'[data-role="modal-reject"]'},triggers:{"click @ui.close":{event:"click:close",stopPropagation:!0},"click @ui.reject":{event:"click:reject",stopPropagation:!0},"click @ui.resolve":{event:"click:resolve",stopPropagation:!0},"click @ui.text":{event:"click:content",stopPropagation:!0},"click @ui.contentWrapper":{event:"click:content:wrapper",stopPropagation:!0},"click @ui.bg":{event:"click:bg",stopPropagation:!0},click:{event:"click:wrapper",stopPropagation:!0}},onBeforeDestroy:function(){this.trigger("reject",this.getProperty("reject"),!0)},onClickClose:function(){this.destroy()},onClickResolve:function(){this.trigger("resolve",this.getProperty("resolve"))},onClickReject:function(){this.trigger("reject",this.getProperty("reject"))},onClickBg:function(){this.clickedOutsideOfModal()},onClickWrapper:function(){this.clickedOutsideOfModal()},clickedOutsideOfModal:function(){!0===this.getConfigValue("options","closeOnClickOutside")&&this.destroy()},onBeforeRender:function(){var t=this.getConfig();t.css.wrapper&&this.$el.addClass(t.css.wrapper),this.$el.appendTo($("body"))},onRender:function(){this.content instanceof t.View&&(this.showChildView("content",this.content),this.content.inModal=this)},_getModalOptions:function(){var t={};return null!=this.getOption("closeOnClickOutside")&&(t.closeOnClickOutside=this.getOption("closeOnClickOutside")),null!=this.getOption("closeOnPromise")&&(t.closeOnPromise=this.getOption("closeOnPromise")),null!=this.getOption("preventClose")&&(t.preventClose=this.getOption("preventClose")),null!=this.getOption("asPromise")&&(t.asPromise=this.getOption("asPromise")),t},getConfigValue:function(t,e){return((this.getConfig()||{})[t]||{})[e]},getConfig:function(t){if(this.config)return this.config;var e=this.getOption("type")||"simple",n=i.extend({},st.get("types."+e)||{});return n.show=i.extend({},st.get("dafaultShow"),n.show,this.getOption("show")),n.labels=i.extend({},st.get("defaultLabels"),n.labels,this.getOption("labels")),n.css=i.extend({},st.get("defaultCss"),n.css,this.getOption("css")),n.options=i.extend({},st.get("defaultOptions"),n.options,this._getModalOptions()),null==n.show.header&&this.getOption("header")&&(n.show.header=!0),null==n.show.resolve&&(this.getOption("resolve")||n.options.asPromise)&&(n.show.resolve=!0),null==n.show.reject&&this.getOption("reject")&&(n.show.reject=!0),null==n.show.actions&&(n.show.resolve||n.show.reject)&&(n.show.actions=!0),console.log(e,n),console.log(st),this.config=n},templateContext:function(){var t=this.getConfig();return{css:function(e){return t.css[e]?' class="'+t.css[e]+'"':""},label:function(e){return t.labels[e]||""},show:t.show,text:this.getOption("text"),header:this.getOption("header")}}}),ft=new(C(et).with(D).extend({constructor:function(){var t=this;this.modals=[];for(var e=arguments.length,r=Array(e),o=0;o<e;o++)r[o]=arguments[o];et.apply(this,r),this.listenForEsc=i.bind(this._listenForEsc,this),n(function(){t.doc=n(document),t.doc.on("keyup",t.listenForEsc)})},channelName:"modals",show:function(){var t=this._normalizeArguments.apply(this,arguments);return this._create(t)},remove:function(t){t||(t=i.last(this.modals)),t&&t.destroy()},_listenForEsc:function(){this.modals.length&&this.remove()},_create:function(t){var e=new dt(t),i=this;return this.listenToOnce(e,"destroy",function(){i._remove(e)}),this.modals.push(e),e},_remove:function(t){if(t){var e=this.modals.indexOf(t);e>-1&&this.modals.splice(e,1),this.stopListening(t)}},_normalizeArguments:function(){var t={},e=arguments.length;if(e){if(1===e)y.isView(arguments.length<=0?void 0:arguments[0])?t.content=arguments.length<=0?void 0:arguments[0]:i.isString(arguments.length<=0?void 0:arguments[0])?t.text=arguments.length<=0?void 0:arguments[0]:i.isObject(arguments.length<=0?void 0:arguments[0])&&i.extend(t,arguments.length<=0?void 0:arguments[0]);else if(2===e)i.isString(arguments.length<=0?void 0:arguments[0])&&i.isString(arguments.length<=1?void 0:arguments[1])?(t.header=arguments.length<=0?void 0:arguments[0],t.text=arguments.length<=1?void 0:arguments[1]):i.isString(arguments.length<=0?void 0:arguments[0])&&y.isView(arguments.length<=1?void 0:arguments[1])?(t.header=arguments.length<=0?void 0:arguments[0],t.content=arguments.length<=1?void 0:arguments[1]):i.isString(arguments.length<=1?void 0:arguments[1])&&y.isView(arguments.length<=0?void 0:arguments[0])?(t.header=arguments.length<=1?void 0:arguments[1],t.content=arguments.length<=0?void 0:arguments[0]):i.isString(arguments.length<=0?void 0:arguments[0])&&i.isObject(arguments.length<=1?void 0:arguments[1])?(i.extend(t,arguments.length<=1?void 0:arguments[1]),y.isView(t.content)?t.header=arguments.length<=0?void 0:arguments[0]:t.text=arguments.length<=0?void 0:arguments[0]):y.isView(arguments.length<=0?void 0:arguments[0])&&i.isObject(arguments.length<=1?void 0:arguments[1])&&(i.extend(t,arguments.length<=1?void 0:arguments[1]),t.content=arguments.length<=0?void 0:arguments[0]);else{i.isObject(arguments.length<=3?void 0:arguments[3])&&i.extend(t,arguments.length<=3?void 0:arguments[3]),i.isObject(arguments.length<=2?void 0:arguments[2])?i.extend(t,arguments.length<=2?void 0:arguments[2]):i.isString(arguments.length<=2?void 0:arguments[2])&&(t.type=arguments.length<=2?void 0:arguments[2]);var n=this._normalizeArguments(arguments.length<=0?void 0:arguments[0],arguments.length<=1?void 0:arguments[1]);i.extend(t,n)}return t}},onBeforeDestroy:function(){this.doc&&this.doc.off("keyup",this.listenForEsc)}})),pt={show:function(){return ft.show.apply(ft,arguments)},addTypeConfig:function(t,e){t&&i.isString(t)&&config.set("types."+t,e)},getTypeConfig:function(t){if(t&&i.isString(t))return config.get("types."+t)}},vt={TemplateContext:N,identity:nt,modals:pt},mt=C(e.Application).with(x,M,T,F),yt=mt.extend({initRadioOnInitialize:!0,_initRegion:function(){if(!(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{skip:!0}).skip){var t=this.getProperty("region");this.region=t,mt.prototype._initRegion()}},getRegion:function(){return this._region||this._initRegion({skip:!1}),this._region},addPageManager:function(t){var e=this;this._pageManagers||(this._pageManagers=[]),this._pageManagers.push(t);var i=t.getName();i?(this.listenTo(t,"all",function(t){for(var n=arguments.length,r=Array(n>1?n-1:0),o=1;o<n;o++)r[o-1]=arguments[o];var s=i+":"+t;e.triggerMethod.apply(e,[s].concat(r))}),this.listenTo(t,"state:currentPage",function(){for(var t=arguments.length,i=Array(t),n=0;n<t;n++)i[n]=arguments[n];return e.triggerMethod.apply(e,["page:swapped"].concat(i))})):console.warn("pageManager prefix not defined")},hasPageManagers:function(){return this._pageManagers&&this._pageManagers.length>0},getMenuTree:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{rebuild:!1};if(this._menuTree&&!e.rebuild)return this._menuTree;var n=this._pageManagers||[],r=i(n).chain().map(function(t){return t.getLinks()}).flatten().value();return this._menuTree=new t.Collection(r),this._menuTree},getPage:function(t){if(this.hasPageManagers())return i(this._pageManagers).find(function(e){return e.getPage(t)})}}),_t=e.AppRouter.extend({},{create:function(t,e){var n={},r={},o=this;return i(t).each(function(t,i){n[i]=i,r[i]=function(){t.action.apply(t,arguments).catch(function(t){o._catchError(t,e)})}}),new this({controller:r,appRoutes:n})},_catchError:function(t,e){if(!e||!0===e.getProperty("throwChildErrors"))throw t;var i="error"+(t.status?":"+t.status.toString():"");e.triggerMethod("error",t,this),"error"!=i&&e.triggerMethod(i,t,this)}}),bt=t.Model.extend({}),wt=bt.extend({defaults:{url:void 0,label:void 0,target:"_self",level:0},destroy:function(){this.id=null,bt.prototype.destroy.apply(this,arguments)}});function St(t){if(Array.isArray(t)){for(var e=0,i=Array(t.length);e<t.length;e++)i[e]=t[e];return i}return Array.from(t)}var Ct=C(yt).with(O),Pt=Ct.extend({constructor:function(){for(var t=arguments.length,e=Array(t),i=0;i<t;i++)e[i]=arguments[i];Ct.apply(this,e),this.initializeYatPage()},allowStopWithoutStart:!0,allowStartWithoutStop:!0,initializeYatPage:function(t){this.mergeOptions(t,["manager"]),this._initializeModels(t),this._initializeRoute(t),this._proxyEvents(),this._tryCreateRouter(),this._registerIdentityHandlers()},getLayout:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{rebuild:!1};return(!this._layoutView||t.rebuild||this._layoutView&&this._layoutView.isDestroyed&&this._layoutView.isDestroyed())&&this.buildLayout(),this._layoutView},buildLayout:function(){var t=this.getProperty("Layout");if(null!=t){var e=i.extend({},this.getProperty("layoutOptions"));this.model&&!e.model&&i.extend(e,{model:this.model}),this.collection&&!e.collection&&i.extend(e,{collection:this.collection});var n=this.buildLayoutOptions(e);return n.page=this,this._layoutView=new t(n),this._layoutView}},buildLayoutOptions:function(t){return t},addModel:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(t){this.model=t;var i=e.fetch||this.getOption("fetchModelOnAdd");void 0===i&&(i=this.getProperty("fetchDataOnAdd")),!0===i&&this.addStartPromise(t.fetch(e))}},addCollection:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(t){this.collection=t;var i=e.fetch||this.getOption("fetchCollectionOnAdd");void 0===i&&(i=this.getProperty("fetchDataOnAdd")),!0===i&&this.addStartPromise(t.fetch(e))}},freezeWhileStarting:!0,freezeUI:function(){},unFreezeUI:function(){},getRouteHash:function(){var t=[{},this._routeHandler].concat(this.getChildren({startable:!1}).map(function(t){return t.getRouteHash()}));return i.extend.apply(i,St(t))},hasRouteHash:function(){return i.isObject(this.getRouteHash())},getLinkModel:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;if(this._canHaveLinkModel()){if(this._linkModel)return this._linkModel;var e=this.getRoute(),i=this.getLabel(),n=this._getSublinks(t);return this._linkModel=new wt({url:e,label:i,level:t,children:n}),this._linkModel}},_canHaveLinkModel:function(){return!(!0===this.getProperty("skipMenu")||this.getProperty("isStartNotAllowed"))},_destroyLinkModel:function(){this._linkModel&&(this._linkModel.destroy(),delete this._linkModel)},getParentLinkModel:function(){var t=this.getParent();if(t&&t.getLinkModel){return t.getLinkModel()}},getNeighbourLinks:function(){var t=this.getLinkModel();if(t&&t.collection)return t.collection},getChildrenLinks:function(){var t=this.getLinkModel();if(t)return t.get("children")},_getSublinks:function(e){var n=this.getChildren();if(n&&n.length){var r=i(n).chain().filter(function(t){return!0!==t.getProperty("skipMenu")}).map(function(t){return t.getLinkModel(e+1)}).value();if(r.length){return new t.Collection(r)}}},_initializeModels:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this.addModel(t.model,t),this.addCollection(t.collection,t)},_initializeRoute:function(){var t=this.getRoute({asPattern:!0});if(null!=t){var e=this;this._routeHandler=(i={},n=t,r={context:e,action:function(){return e.start.apply(e,arguments)}},n in i?Object.defineProperty(i,n,{value:r,enumerable:!0,configurable:!0,writable:!0}):i[n]=r,i);var i,n,r}},getRoute:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{asPattern:!1},e=this.getProperty("relativeRoute"),i=this.getProperty("route"),n=this.getParent();if(null!=i){var r=i;if(e&&n&&n.getRoute){r=n.getRoute()+"/"+i}return this._normalizeRoute(r,t)}},_normalizeRoute:function(t,e){if(t=t.replace(/\/+/gim,"/").replace(/^\//,""),e.asPattern)return t;return t.replace(/\(\/\)/gim,"/").replace(/\/+/gim,"/")},_tryCreateRouter:function(){!0===this.getProperty("createRouter")&&(this.router=this._createAppRouter())},_createAppRouter:function(){var t=this.getRouteHash();if(i.size(t))return new _t(t)},_proxyEvents:function(){var t=this._getProxyContexts();this._proxyEventsTo(t)},_getProxyContexts:function(){var t=[],e=this.getProperty("manager");e&&t.push({context:e});var i=this.getChannel();if(i){var n=this.getProperty("proxyEventsToRadio");t.push({context:i,allowed:n})}return t},_proxyEventsTo:function(t){var e=[],n={};i(t).each(function(t){t.allowed?i(t.allowed).each(function(e){n[e]||(n[e]=[]),n[e].push(t.context)}):e.push(t.context)});var r=this;r.on("all",function(t){for(var o=arguments.length,s=Array(o>1?o-1:0),a=1;a<o;a++)s[a-1]=arguments[a];var l=t in n?n[t]:e,h=[r].concat(s);i(l).each(function(e){return e.triggerMethod.apply(e,["page:"+t].concat(St(h)))})})},_buildChildOptions:function(t){var e={},n=this.getProperty("manager");return n&&(e.manager=n),i.extend(t,this.getProperty("childOptions"),e)},_registerIdentityHandlers:function(){var t=this;this.listenTo(nt,"change",function(){for(var e=arguments.length,i=Array(e),n=0;n<e;n++)i[n]=arguments[n];t._destroyLinkModel(),t.triggerMethod.apply(t,["identity:change"].concat(i))})}}),Ot=C(yt).with(O),xt=Ot.extend({constructor:function(){for(var t=arguments.length,e=Array(t),i=0;i<t;i++)e[i]=arguments[i];Ot.apply(this,e),this._initializeYatPageManager.apply(this,e)},throwChildErrors:!0,createRouter:function(){var t=this.getChildren({startable:!1}),e={};i(t).each(function(t){i.isFunction(t.getRouteHash)&&i.extend(e,t.getRouteHash())}),this._routesHash=e,this.setRouter(_t.create(e,this))},setRouter:function(t){this.router=t},getRouter:function(){return this.router},getLinks:function(){var t=this.getChildren();if(t)return i(t).chain().map(function(t){return t.getLinkModel()}).filter(function(t){return!!t}).value()},execute:function(t){var e=this.getPage(t);if(e)e.start({text:error.message});else{if("*NotFound"===t)throw new S.NotFound("*NotFound handler is missing");this.execute("*NotFound")}},navigate:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{trigger:!0},i=this.getRouter();i?i.navigate(t,e):console.warn("router not found")},getPage:function(t){var e=i(this._routesHash).find(function(e,i){return i===t||(e.context.getName()===t||void 0)});return e&&e.context},navigateToRoot:function(){var t=this.getState("currentPage"),e=this.getProperty("rootUrl");if(!e){var i=this.getChildren();if(i&&i.length){var n=i.find(function(e){return e!=t});e=n&&n.getRoute()}}null!=e?this.navigate(e):console.warn("root page not found")},_initializeYatPageManager:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this.mergeOptions(t,["id","name","label"]),this._registerPageHandlers(t),this._registerIdentityHandlers(),this.createRouter()},_buildChildOptions:function(t){return i.extend(t,this.getProperty("childOptions"),{manager:this})},_registerPageHandlers:function(){this.on("page:before:start",this._pageBeforeStart),this.on("page:start",this._pageStart),this.on("page:start:decline",this._pageDecline)},_pageBeforeStart:function(t){var e=this.getState("currentPage");e&&e!=t&&e.stop()},_pageStart:function(t){this.setState("currentPage",t)},_pageDecline:function(){},_registerIdentityHandlers:function(){var t=this;this.listenTo(nt,"change",function(){for(var e=arguments.length,i=Array(e),n=0;n<e;n++)i[n]=arguments[n];t.triggerMethod.apply(t,["identity:change"].concat(i)),t._moveToRootIfCurrentPageNotAllowed()})},_moveToRootIfCurrentPageNotAllowed:function(){var t=this.getState("currentPage");t&&t.isStartNotAllowed()&&this.navigateToRoot()}}),Mt=C(e.NextCollectionView).with(G),Dt=t.Collection.extend({}),Et=et.extend({collection:void 0,groupBy:void 0,getGroups:function(){return this.groups},getGroup:function(t){return this.getGroups()[t]},isGroupExists:function(t){return t in this.getGroups()},addGroup:function(t,e){if(!this.isGroupExists(t)){var i=this.getGroups();return i[t]=this._createGroup(t,e),i[t]}},removeGroup:function(t){var e=this.getGroup(t);e&&(i.isFunction(e.destroy)?e.destroy():i.isFunction(e.stopListening)&&e.stopListening(),delete this.groups[t])},group:function(){var t={},e=this.collection.groupBy(this.groupBy),n=this.getOption("groups");return i(n).each(function(i){i in e?(t[i]=e[i],delete e[i]):t[i]=[]}),i(e).each(function(e,i){return t[i]=e}),t},constructor:function(t){et.apply(this,arguments),this._initializeGrouppedCollection(t)},_initializeGrouppedCollection:function(t){1!=this._initializedGC&&(this.mergeOptions(t,["collection","groupBy"]),this._ensureOptions(),this._initializeGroups(),this._initializeEventHandlers(),this._initializedGC)},_ensureOptions:function(){if(!this.collection)throw new Error("collection must be set");if(!this.groupBy)throw new Error("groupBy must be set");if("string"==typeof this.groupBy){var t=this.getOption("groupBy");this.groupBy=function(e){return e.get(t)}}},_initializeGroups:function(){var t=this;this.groups={};var e=this.group();i(e).each(function(e,i){return t.addGroup(i,e)})},_createGroup:function(t,e){var i=this.groupBy,n=new Dt(e);return n.on("change",function(e){i(e)!==t&&n.remove(e)}),n.name=t,n},_initializeEventHandlers:function(){this.listenTo(this.collection,"update",this._onCollectionUpdate),this.listenTo(this.collection,"change",this._onModelChange)},_onCollectionUpdate:function(t,e){var n=this,r=i(e.changes.added).groupBy(this.groupBy),o=i(e.changes.removed).groupBy(this.groupBy),s=this.groups;i(r).each(function(t,e){e in s?s[e].add(t):n.getOption("autoCreateNewGroups")&&n.addGroup(e,t)}),i(o).each(function(t,e){e in s&&s[e].remove(t)})},_onModelChange:function(t){var e=this.groupBy(t);this.groups[e]?this.groups[e].add(t):console.warn("model is out of groupping",t,e)},destroy:function(){i(this.groups).each(function(t){t.stopListening(),i.isFunction(t.destroy)&&t.destroy()}),delete this.groups,i.isFunction(et.prototype.destroy)&&et.prototype.destroy.apply(this,arguments),i.isFunction(this.collection.destroy)&&this.collection.destroy(),delete this.collection}});return{VERSION:"0.0.21",Functions:_,Helpers:P,Mixins:Y,Behaviors:tt,Singletons:vt,TemplateContext:N,modals:pt,identity:nt,Object:et,Error:S,App:yt,Page:Pt,Router:_t,PageManager:xt,View:rt,CollectionView:Mt,Model:bt,Collection:Dt,CollectionGroups:Et}}),this&&this.Marionette&&(this.Marionette.Yat=this.MarionetteYat);
//# sourceMappingURL=marionette.yat.min.js.map