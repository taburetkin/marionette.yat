/**
* @license
* Marionette.Yat extension for Backbone.Marionette
* Yet Another Toolkit
* ----------------------------------
* v0.0.21
*
* Distributed under MIT license
* author: dimtabu
*/
!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e(require("backbone"),require("backbone.marionette"),require("underscore")):"function"==typeof define&&define.amd?define(["backbone","backbone.marionette","underscore"],e):t.MarionetteYat=e(t.Backbone,t.Marionette,t._)}(this,function(t,e,n){"use strict";t=t&&t.hasOwnProperty("default")?t.default:t,e=e&&e.hasOwnProperty("default")?e.default:e,n=n&&n.hasOwnProperty("default")?n.default:n;var i=function(n){return n instanceof t.Model?n:n instanceof e.View?n.model:void 0},r=function(e){return e instanceof t.View?e:void 0},o=function(t,e,n){return"function"==typeof n&&(t=n.call(t,i(t),r(t)),e=n.call(e,i(e),r(e))),t<e?-1:t>e?1:0},a={compareAB:o,viewComparator:function(){for(var t=arguments.length,e=Array(t),i=0;i<t;i++)e[i]=arguments[i];var r=[],a=0;return e.length>=2?o.apply(null,e):(1===e.length&&e[0]instanceof Array&&(r=e[0]),n(r).every(function(t){return 0===(a=o.apply(null,t))}),a)}};function s(t,e,i){return n.isFunction(e)&&(e=e.apply(t,i||[])),e}function l(e){var i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(null==i.fields||i.fileds&&!i.fileds.length)throw new Error("fields option missing");if(i.checked||(i.checked={}),null!=e){var r=void 0,o=e instanceof t.Model,a=n.isObject(e.options),l=i.exclude instanceof Array?i.exclude:"string"==typeof i.exclude?[i.exclude]:[];return n(i.fields).some(function(t){if(!(t in i.checked||(i.checked[t]=!0,l.indexOf(t)>=0)))return o&&null==r&&(r=s(e,e.get(t),i.args)),null==r&&(r=s(e,e[t],i.args)),null==r&&a&&(r=s(e,e.options[t],i.args)),null!=r}),null==r?i.default:r}}function u(t,e){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:":";return t||(t=""),t+n+(e=null==e?"":e.toString())}function h(e,i){if(null!=e&&n.isObject(e)&&null!=i&&""!=i)return e instanceof t.Model?e.get(i):e[i]}function c(e,n,i,r){return e instanceof t.Model?e.set(n,i,{silent:!0}):e[n]=i,i instanceof t.Model&&r.models.push({path:r.passPath.join(":"),property:n,model:i}),r.passPath.push(n),h(e,n)}var g=function(e,i,r,o){if(null!=e&&n.isObject(e)&&null!=i&&""!=i){var a=n.extend({},o);if(a.silent=!0===a.silent,a.force=!1!==a.force,!n.isObject(i)||i instanceof Array||(r=i.value,a.force=!1!==i.force,a.silent=!0===i.silent,i=i.path),a.path=i,a.passPath=[],a.models=[],null!=i&&""!=i){var s="string"==typeof i?i.split("."):i instanceof Array?[].slice.call(i):[i];if(a.pathArray=[].slice.call(s),s.length){s.length;var l=s.shift();e instanceof t.Model&&a.models.push({path:"",property:l,model:e});var u=function t(e,i,r,o,a){if(null!=e&&n.isObject(e)&&null!=i&&""!=i){if(!r.length)return c(e,i,o,a);var s=h(e,i);if(n.isObject(s)||a.force)return!n.isObject(s)&&a.force&&(s=c(e,i,{},a)),t(s,r.shift(),r,o,a)}}(e,l,s,r,a);if(void 0===u&&void 0!==r)return u;if(!a.silent)for(var g=a.pathArray.join(":");a.models.length;){var d=a.models.pop(),f=""==d.path?g:g.substring(d.path.length+1);f&&d.model.trigger("change:"+f,r),d.model.trigger("change",d.model)}return u}}}};var d="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t};function f(e){if(null!=e&&n.isObject(e)){var i={};return function e(n,i){if(i=i||"",null!=this&&"object"==d(this))for(var r=this instanceof t.Model?this.attributes:this,o=Object.getOwnPropertyNames(r),a=0;a<o.length;a++){var s=o[a],l=this[s];null==l||"object"!=(void 0===l?"undefined":d(l))||l instanceof Date||l instanceof Array?n[i+s]=l:"object"==(void 0===l?"undefined":d(l))&&e.call(l,n,i+s+".")}}.call(e,i),i}}function p(t){if(null!=t&&n.isObject(t)){var e={};for(var i in t)g(e,i,t[i],!0);return e}}var v={getLabel:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return e.fields=["getLabel","label","getName","name","getValue","value"].concat(e.fields||[]),l(t,e)},getName:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return e.fields=["getName","name","getLabel","label","getValue","value"].concat(e.fields||[]),l(t,e)},getValue:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return e.fields=["getValue","value","getId","id","getName","name","getLabel","label","cid"].concat(e.fields||[]),l(t,e)},wrap:u,unwrap:function(t,e){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:":";if(null!=t){if(t=t.toString(),e||(e=""),!t.length)return t;var i=new RegExp("^"+e+n);return t.replace(i,"")}},setByPath:g,getByPath:function(t,e){if(null!=t&&n.isObject(t)&&null!=e&&""!=e){var i="string"==typeof e?e.split("."):e instanceof Array?[].slice.call(e):[e];return function t(e,i,r){if(null!=e&&n.isObject(e)&&null!=i&&""!=i){var o=h(e,i);return!r.length||r.length&&null==o?o:t(o,r.shift(),r)}}(t,i.shift(),i)}},flattenObject:f,unFlattenObject:p},m={view:a,common:v},_=[t.Model,t.Collection,t.View,t.Router,e.Object];function y(t){var e=n.isFunction(t),i=n(_).some(function(e){return t===e||t.prototype instanceof e});return e&&i}var b=e.Error.extend({},{Http400:function(t){return this.Http(400,t)},Http401:function(t){return this.Http(401,t)},Http403:function(t){return this.Http(403,t)},Http404:function(t){return this.Http(404,t)},Http500:function(t){return this.Http(500,t)},Http:function(t,e){var n=new this({message:e,name:"HttpError"});return n.status=t,n},HttpRedirect:function(t){return this.Http(301,t)},NotFound:function(t){return this.Http404(t)},NotAuthorized:function(t){return this.Http401(t)},Forbidden:function(t){return this.Http403(t)}});function S(t){var i=null;if(n.isFunction(t))i=t;else{if(!n.isObject(t)||null===t)throw new Error("argument should be an object or class definition");var r=function(){};r.extend=e.extend,i=r.extend(t)}i.extend||((i=e.extend.call(t,{})).extend=e.extend);return{with:function(){for(var t=arguments.length,e=Array(t),r=0;r<t;r++)e[r]=arguments[r];return n.reduce(e,function(t,e){return function(t,e){if(n.isFunction(e))return e(t);if(n.isObject(e))return t.extend(e);throw new b("Mixin fail, argument should be an object hash or mixin function")}(t,e)},i)},class:i}}var w={isKnownCtor:y,mix:S};function P(t){return t.extend({getName:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=n.extend({},t);return e.exclude="getName",e.args=[e],v.getName(this,e)},getLabel:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=n.extend({},t);return e.exclude="getLabel",e.args=[e],v.getLabel(this,e)},getValue:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=n.extend({},t);return e.exclude="getValue",e.args=[e],v.getValue(this,e)}})}var O=function(t){return t.extend({getProperty:function(t,e){return this._getOptionOrProperty(this,t,e,this.getOption)},getOption:function(t,e){return this._getOptionOrProperty(this.getProperty("options",{deep:!1}),t,e,this.getProperty)},_getOptionOrProperty:function(t,e){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},r=arguments[3];if(void 0!==i.deep||(i.deep=!0),void 0!==i.force||(i.force=!0),i.args||(i.args=[]),null!=e&&null!=t){var o=t[e];if(void 0===o&&i.deep&&n.isFunction(r)){var a=n.extend({},i,{deep:!1,force:!1});o=r.call(this,e,a)}return n.isFunction(o)&&i.force&&!y(o)&&(o=o.apply(this,i.args||[])),void 0===o?i.default:o}}})},x=function(t){return t.extend({constructor:function(){for(var e=arguments.length,n=Array(e),i=0;i<e;i++)n[i]=arguments[i];t.apply(this,n);var r=!(!0===this.getProperty("initRadioOnInitialize"));this._initRadio({skip:r})},getChannel:function(){return this._channel||this._initRadio({skip:!1}),this._channel},_initRadio:function(){if(1!=(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{skip:!0}).skip){if(!this.getProperty("channelName")){var t=this.getProperty("channel");t&&(this.channelName=t.channelName)}e.Object.prototype._initRadio.call(this)}},radioRequest:function(){var t=this.getChannel();t&&t.request.apply(t,arguments)},radioTrigger:function(){var t=this.getChannel();t&&t.trigger.apply(t,arguments)}})};var C=function(t){var e=t.extend({constructor:function(){for(var e=arguments.length,n=Array(e),i=0;i<e;i++)n[i]=arguments[i];t.apply(this,n),this.initializeStateable()},initializeStateable:function(){this._state={}},getState:function(t){var e=this._state;return t?e[t]:e},setState:function(t,e,i){if(null!=t)if(n.isObject(t)){var r=this;i=e,n(e=t).each(function(t,e){return r.setState(e,t,n.extend({},i,{doNotTriggerFullState:!0}))}),this._triggerStateChange(e,i)}else{this.getState()[t]=e,this._triggerStateChange(t,e,i)}},clearState:function(){var t=this.getState(),e=n.extend({},t);n(t).each(function(n,i){e[i]=void 0,delete t[i]}),this._triggerStateChange(e)},_triggerStateChange:function(t,e,i){if(n.isFunction(this.triggerMethod)){n.isObject(t)?(i=e,e=t,this.triggerMethod("state",e,i)):(this.triggerMethod("state:"+t,e,i),(!0===e||!1===e||e&&"string"==typeof e)&&this.triggerMethod("state:"+t+":"+e.toString(),i),(!i||i&&!i.doNotTriggerFullState)&&this.triggerMethod("state",(a=e,(o=t)in(r={})?Object.defineProperty(r,o,{value:a,enumerable:!0,configurable:!0,writable:!0}):r[o]=a,r),i));var r,o,a}}});return e.Stateable=!0,e},M="initialized",R="starting",A="running",H="stopping",L="waiting",V="destroyed";function k(t,e){var i=this;if(null==t||null==e)return Promise.resolve();var r=t["_"+e]||[],o=n.result(t,e)||[],a=r.concat(o),s=[];return n(a).each(function(t){n.isFunction(t)?s.push(t.call(i)):s.push(t)}),Promise.all(s)}function z(t,e,n){t[e]||(t[e]=[]);t[e].push(n)}var j=function(t){var e=S(t).with(C),i=e.extend({constructor:function(){for(var t=arguments.length,n=Array(t),i=0;i<t;i++)n[i]=arguments[i];e.apply(this,n),this.initializeStartable()},initializeStartable:function(){this.constructor.Startable&&this.constructor.Stateable&&(this._registerStartableLifecycleListeners(),this._setLifeState(M),this._startRuntimePromises=[],this._startPromises=[],this._stopPromises=[])},start:function(){for(var t=this,e=arguments.length,n=Array(e),i=0;i<e;i++)n[i]=arguments[i];var r=n[0],o=this._ensureStartableCanBeStarted(),a=null,s=null;if(o&&(s=function(){return t.triggerMethod("start:decline",o)},a=Promise.reject(o)),null==a){var l=this.isStartNotAllowed(r);l&&(s=function(){return t.triggerMethod("start:decline",l)},a=Promise.reject(l))}if(null==a){var u=this._getLifeState();this._tryMergeStartOptions(r),this.triggerMethod.apply(this,["before:start"].concat(n)),a=this._getStartPromise()}return a.then(function(){t.triggerStart(r)},function(e){return t._setLifeState(u),s&&s(),Promise.reject(e)})},triggerStart:function(t){this.triggerMethod("start",t)},stop:function(t){var e=this,n=this._ensureStartableCanBeStopped();if(n)return this.triggerMethod("stop:decline",n),Promise.reject(n);var i=this.isStopNotAllowed(t);if(i)return this.triggerMethod("stop:decline",i),Promise.reject(i);var r=this._getLifeState();this._tryMergeStopOptions(t),this.triggerMethod("before:stop",this,t);return this._getStopPromise().then(function(){e.triggerStop(t)},function(){e._setLifeState(r)})},triggerStop:function(t){this.triggerMethod("stop",t)},isStartNotAllowed:function(){},isStopNotAllowed:function(){},addStartPromise:function(t){z(this,"_startRuntimePromises",t)},addStopPromise:function(t){z(this,"_stopPromises",t)},_setLifeState:function(t){this.setState("life",t)},_getLifeState:function(){return this.getState("life")},_isLifeState:function(t){return this._getLifeState()===t},_isLifeStateIn:function(){for(var t=this,e=arguments.length,i=Array(e),r=0;r<e;r++)i[r]=arguments[r];return n(i).some(function(e){return t._isLifeState(e)})},_isInProcess:function(){return this._isLifeStateIn(R,H)},_registerStartableLifecycleListeners:function(){var t=this,e=!0===this.getProperty("freezeWhileStarting");e&&n.isFunction(this.freezeUI)&&this.on("state:life:"+R,function(){t.freezeUI()}),e&&n.isFunction(this.unFreezeUI)&&this.on("start",function(){t.unFreezeUI()}),this.on("before:start",function(){return t._setLifeState(R)}),this.on("start",function(){return t._setLifeState(A)}),this.on("before:stop",function(){return t._setLifeState(H)}),this.on("stop",function(){return t._setLifeState(L)}),this.on("destroy",function(){return t._setLifeState(V)})},_tryMergeStartOptions:function(t){if(this.mergeOptions){var e=this.getProperty("mergeStartOptions")||[];this.mergeOptions(t,e)}},_tryMergeStopOptions:function(t){if(this.mergeOptions){var e=this.getProperty("mergeStopOptions")||[];this.mergeOptions(t,e)}},_ensureStartableIsIntact:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{throwError:!1},e=new b({name:"StartableLifecycleError",message:"Startable has already been destroyed and cannot be used."}),n=this._isLifeState(V);if(t.throwError&&n)throw e;if(n)return e},_ensureStartableIsIdle:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{throwError:!1},e="Startable is not idle. current state: "+this._getLifeState(),n=new b({name:"StartableLifecycleError",message:e}),i=this._ensureStartableIsIntact(t),r=this._isInProcess();if(t.throwError&&r)throw n;return i||(r?n:void 0)},_ensureStartableCanBeStarted:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{throwError:!1},e=new b({name:"StartableLifecycleError",message:"Startable has already been started."}),n=this._ensureStartableIsIdle(t),i=!0===this.getProperty("allowStartWithoutStop");if(n||!i){var r=this._isLifeState(A);if(t.throwError&&r)throw e;return n||(r?e:void 0)}},_ensureStartableCanBeStopped:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{throwError:!1},e=new b({name:"StartableLifecycleError",message:"Startable should be in `running` state."}),n=this._ensureStartableIsIdle(t),i=!0===this.getProperty("allowStopWithoutStart");if(n||!i){var r=this._isLifeState(A);if(t.throwError&&!r)throw e;return n||(r?void 0:e)}},_getStartPromise:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return Promise.all(this._getStartPromises(t))},_getStartPromises:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=[];return e.push(this._getStartParentPromise()),e.push(this._getStartPagePromise()),!0!==t.noruntime&&e.push(this._getStartRuntimePromise()),e},_getStartRuntimePromise:function(){return k(this,"startRuntimePromises")},_getStartPagePromise:function(){return k(this,"startPromises")},_getStartParentPromise:function(){var t=n.result(this,"getParent");if(n.isObject(t)&&n.isFunction(t._getStartPromise))return t._getStartPromise({noruntime:!0})},_getStopPromise:function(){return Promise.all(this._getStopPromises())},_getStopPromises:function(){var t=[];return t.push(this._getStopRuntimePromise()),t},_getStopRuntimePromise:function(){return k(this,"stopPromises")},_getStopParentPromise:function(){var t=n.result(this,"getParent");if(n.isObject(t)&&n.isFunction(t._getStopPromise))return t._getStopPromise()}});return i.Startable=!0,i},D=function(t){var e="_children",i=t.extend({constructor:function(){for(var e=arguments.length,n=Array(e),i=0;i<e;i++)n[i]=arguments[i];t.apply(this,n),this.initializeChildrenable.apply(this,n)},initializeChildrenable:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this._initializeParrent(t),this._initializeChildren(t)},hasChildren:function(){this.getChildren();return this[e].length>0},getChildren:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{startable:!0},n=this[e]||[];return t.startable?n.filter(function(t){return!t.getProperty("isStartNotAllowed")}):n},hasParent:function(){var t=this.getParent();return n.isObject(t)},getParent:function(){return this.getProperty("parent",{deep:!1})},_initializeChildren:function(){var t=this,i=this.getProperty("children"),r=[];n(i).each(function(e){var n=t._normalizeChildContext(e),i=t._initializeChild(n);i&&r.push(i)}),this[e]=r},_initializeChild:function(t){if(null!=t&&n.isFunction(t.Child)){var e=t.Child,i=this._normalizeChildOptions(t);return this.buildChild(e,i)}},_normalizeChildContext:function(t){var e={};return n.isFunction(t)&&t.Childrenable?n.extend(e,{Child:t}):n.isFunction(t)?e=this._normalizeChildContext(t.call(this)):n.isObject(t)&&(e=t),e},_normalizeChildOptions:function(t){var e=n.extend({},t);return!0===this.getOption("passToChildren")&&n.extend(e,this.options),e.parent=this,delete e.Child,this._buildChildOptions(e)},_buildChildOptions:function(t){return n.extend(t,this.getProperty("childOptions"))},buildChild:function(t,e){return new t(e)},_initializeParrent:function(t){null==this.parent&&null!=t.parent&&(this.parent=t.parent)}});return i.Childrenable=!0,i},E=[function(t){return{_v:t,_m:t.model||{},_cid:function(e){return u(t.cid,e)}}}],F={},I=!1;var T={mix:function(t){for(var e=arguments.length,i=Array(e>1?e-1:0),r=1;r<e;r++)i[r-1]=arguments[r];var o=this.get.apply(this,i);return n.extend(o,t)},get:function(){return this.compile.apply(this,arguments)},add:function(){for(var t=this,e=arguments.length,i=Array(e),r=0;r<e;r++)i[r]=arguments[r];n(i).each(function(e){return t.push(e)})},compile:function(){for(var t=arguments.length,e=Array(t),i=0;i<t;i++)e[i]=arguments[i];I&&(F={});var r={};return n(E).each(function(t){n.isFunction(t)?n.extend(r,function(t){for(var e=arguments.length,i=Array(e>1?e-1:0),r=1;r<e;r++)i[r-1]=arguments[r];return n.isFunction(t)?t.apply(void 0,i):n.isObject(t)?t:{}}.apply(void 0,[t].concat(e))):I&&n.extend(F,t)}),I||n.extend(r,F),I=!1,r},pop:function(){return I=!0,E.pop()},shift:function(){return I=!0,E.shift()},push:function(t){I=!0,E.push(t)},unshift:function(t){I=!0,E.unshift(t)},clear:function(){I=!1,F={},E=[]}},N=function(t){return t.extend({mixinTemplateContext:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=T.mix(n.result(this,"templateContext"),this);return n.extend(t,e)}})},B={GetNameLabel:P,GetOptionProperty:O,Radioable:x,Stateable:C,Startable:j,Childrenable:D,GlobalTemplateContext:N},Y=function(t,e){return t.jquery&&(t=t.get(0)),e.jquery&&(e=e.get(0)),t===e||$.contains(t,e)},U=new(e.Object.extend({name:"draggable manager",buildDraggableContext:function(t,e,i){var r={id:n.uniqueId("draggable"),state:"pending",$trigger:t,scope:e.getOption("scope")||"default",behavior:e,view:e.view,model:e.view.model,mouse:{startAt:{x:i.pageX,y:i.pageY}},_documentHandlers:{},_triggerHandlers:{},_elementHandlers:{}};return r.mouse.getOffset=function(t){var e={x:t.pageX-this.startAt.x,y:t.pageY-this.startAt.y};return e.absX=Math.abs(e.x),e.absY=Math.abs(e.y),e.distance=Math.round(Math.sqrt(e.absX*e.absX+e.absY*e.absY)),e},r._documentHandlers.mousemove=n.bind(this.__documentMouseMoveHandler,this,t,r),r._documentHandlers.mouseup=n.bind(this.__documentMouseUpHandler,this,t,r),r._documentHandlers.mouseleave=n.bind(this.__documentMouseLeaveHandler,this,t,r),r._documentHandlers.mouseenter=n.bind(this.__documentMouseEnterHandler,this,t,r),r._elementHandlers.dragover=n.bind(this.__dragOverHandler,this,t,r),r},setupDraggable:function(t,i){if(!t.jquery&&"string"!=typeof t)throw new Error("first argument should be jquery element or string selector");if(!(i instanceof e.Behavior))throw new Error("second argument should be marionette behavior instance");var r=t.jquery?t:i.$el,o="string"==typeof t?t:null;r.on("mousedown",o,null,n.bind(this.__triggerMouseDownHandler,this,r,i))},__triggerMouseDownHandler:function(t,e,n){n.preventDefault(),n.stopPropagation();var i=this.buildDraggableContext(t,e,n);return $(document).on("mousemove",null,null,i._documentHandlers.mousemove),$(document).one("mouseup",null,null,i._documentHandlers.mouseup),!1},__documentMouseUpHandler:function(t,e,n){"pending"===e.state||"dragging"===e.state&&(e.state="dropped",e.view.triggerMethod("drag:end",e),$(n.target).trigger("drag:drop",e)),this._clearAllHandlers(t,e)},__documentMouseMoveHandler:function(t,e,n){if("pending"===e.state){var i=e.behavior.getOption("startDragOnDistance")||1;if(e.mouse.getOffset(n).distance<i)return;this._initializeDragging(t,e,n)}"dragging"===e.state&&e.view.triggerMethod("drag",n,e)},_initializeDragging:function(t,e,n){"dragging"!==e.state&&(e.state="dragging",e.view.triggerMethod("drag:start",n,e),$(document).on("mouseleave","*",null,e._documentHandlers.mouseleave),$(document).on("mouseenter","*",null,e._documentHandlers.mouseenter))},__documentMouseLeaveHandler:function(t,e,n){Y(e.behavior.$el,n.target)||$(n.target).trigger("drag:leave",e)},__documentMouseEnterHandler:function(t,e,n){if(e.$entered&&e.$entered.off("mousemove",null,e._elementHandlers.dragover),!Y(e.behavior.$el,n.target)){var i=this._createCustomDomEvent("drag:enter",n);e.$entered=$(n.target),e.$entered.trigger(i,e),e.$entered.on("mousemove",null,null,e._elementHandlers.dragover)}},__dragOverHandler:function(t,e,n){var i=this._createCustomDomEvent("drag:over",n);$(n.target).trigger(i,e)},_createCustomDomEvent:function(t,e,i){i||(i=["pageX","pageY","clientX","clientY","offsetX","offsetY"]);var r=jQuery.Event(t);return n(i).each(function(t){r[t]=e[t]}),r},_clearAllHandlers:function(t,e){var i=$(document);n(e._documentHandlers).each(function(t,e){i.off(e,null,t)}),n(e._triggerHandlers).each(function(e,n){t.off(n,null,e)}),e.$entered&&e.$entered.off("mousemove",null,e._elementHandlers.dragover)}})),q=S(e.Behavior).with(O),X=q.extend({listenViewInitialize:!0,constructor:function(){!0===this.getProperty("listenViewInitialize")&&this.on("before:render initialize",n.once(n.partial(this.triggerMethod,"view:initialize"))),q.apply(this,arguments)},getModel:function(){return this.view.model},cidle:function(t){return v.wrap(this.view.cid,t)},unCidle:function(t){return v.unwrap(t,this.view.cid)}});function W(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}var G={Draggable:X.extend({startDragOnDistance:50,events:{"dragged:over":"_dragOver"},_dragOver:function(t,e,n){t.stopPropagation(),t.preventDefault(),this.wrongScope(n)||(this.view.triggerMethod("dragged:over",e,n,this),this.view.triggerMethod("dragged:over:"+e,n,this))},onInitialize:function(){this._setup()},getScope:function(){return this.getOption("scope")||"default"},wrongScope:function(t){return this.getScope()!==t.scope},onDragStart:function(t,e){if("clone"==(this.getOption("ghost")||"clone")){var n=this.$ghost=this.$el.clone();n.css({top:t.pageY+"px",left:t.pageX+"px",width:this.$el.width()}),this.getOption("elementClass")&&this.$el.addClass(this.getOption("elementClass")),this.getOption("ghostClass")&&n.addClass(this.getOption("ghostClass"));var i=$("body");n.appendTo(i),e.draggingContext=i}},onDrag:function(t){this.$ghost&&this.$ghost.css({top:t.pageY+"px",left:t.pageX+"px"})},onDragEnd:function(){this.$ghost&&this.$ghost.remove(),this.getOption("elementClass")&&this.$el.removeClass(this.getOption("elementClass"))},getDragTrigger:function(){return this.getOption("dragTrigger")?this.getOption("dragTrigger"):this.$el},_setup:function(){U.setupDraggable(this.getDragTrigger(),this)}}),SortByDrag:X.extend({events:{"drag:drop":"_dragDrop","drag:over":"_dragOver"},_dragOver:function(t,e){if(!this.wrongScope(e))if(t.stopPropagation(),t.preventDefault(),t.target!==this.$el.get(0)){var n=this.dragOverPosition||"",i=t.pageY,r=t.pageX,o=this.getChildEl(t.target),a="top:left";if(o.length){var s=this._get$elInfo(o),l=r<s.center.x?"left":"right",u=i<s.center.y?"top":"bottom";a=u+":"+l}else console.warn(t.target);var h=this.getOption("dragBy")||"both";if(n!=a){var c=n.split(":"),g=o;"both"==h&&g.trigger("dragged:over",[a,e]),-1!==c.indexOf(l)||"horizontal"!==h&&"both"!==h||g.trigger("dragged:over",[l,e]),-1!=c.indexOf(u)||"vertical"!==h&&"both"!==h||g.trigger("dragged:over",[u,e]),this.dragOverPosition=a}}else this._insert(e)},_dragDrop:function(t,e){if(!this.wrongScope(e))return t.stopPropagation(),t.preventDefault(),this._tryInsertBetween(e),!1},_tryInsertBetween:function(t){var e=t.model,n=t.view;this.view.collection?(n.$el.detach(),n.destroy(),this.removeModelFromCollection(e),this.insertModelAt(e,t.insertAt)):console.warn("collection not defined")},removeModelFromCollection:function(t){var e=t.collection;e&&(e.remove(t),delete t.collection,e.each(function(t,e){t.set("order",e)}))},insertModelAt:function(t,e){var n=this.view.collection;n&&(e<=0&&(e=0),e>=n.length?(t.set("order",n.length),t.collection=n,n.push(t)):(t.set("order",e),e>0?n.add(t,{at:e}):n.unshift(t),n.each(function(t,e){t.set("order",e)})),this.view.sort())},getScope:function(){return this.getOption("scope")||"default"},wrongScope:function(t){return this.getScope()!==t.scope},getChildEl:function(t){var e=this.getOption("childSelector");return $(t).closest(e)},_get$elInfo:function(t,e){var n=this._$elInfo={size:{width:t.width(),height:t.height()},offset:t.offset()};return n.center={x:n.size.width/2+n.offset.left,y:n.size.height/2+n.offset.top},n},getOrder:function(t){return t.view.model.getOrder()||0},_updateInsert:function(t,e){t.insertAt=e},onChildviewDraggedOverLeft:function(t,e){this._insert(t,"insertBefore",e.$el,this.getOrder(e))},onChildviewDraggedOverTop:function(t,e){this._insert(t,"insertBefore",e.$el,this.getOrder(e))},onChildviewDraggedOverRight:function(t,e){this._insert(t,"insertAfter",e.$el,this.getOrder(e)+1)},onChildviewDraggedOverBottom:function(t,e){this._insert(t,"insertAfter",e.$el,this.getOrder(e)+1)},_insert:function(t,e,n,i){i||(i=0),e?t.view.$el[e](n):t.view.$el.appendTo(this.$el),this._updateInsert(t,i)}}),DynamicClass:X.extend({updateElementClass:function(t){var e=n.result(this.view,"className")||"",i=n.result(this.view,"dynamicClassName")||"";this.$el.attr({class:e+" "+i})},refreshOnModelChange:!0,refreshOnDomChange:!1,refreshOnViewRefresh:!0,refreshOnViewBeforeRender:!0,refreshOnViewRender:!1,modelEvents:{change:function(){this.getProperty("refreshOnModelChange")&&this.updateElementClass("model:change")}},events:{change:function(){this.getProperty("refreshOnDomChange")&&this.updateElementClass("dom:change")}},onRefresh:function(){this.getProperty("refreshOnViewRefresh")&&this.updateElementClass("view:refresh")},onRender:function(){this.getProperty("refreshOnViewRender")&&this.updateElementClass("view:render")},onBeforeRender:function(){this.getProperty("refreshOnViewBeforeRender")&&this.updateElementClass("view:before:render")},onRefreshCssClass:function(){this.updateElementClass()},onSetupRefreshCssClass:function(t){var e=this;null!=t&&n.isObject(t)&&n(t).each(function(t,n){e[n]=!0===t})}}),FormToHash:S(X).with(C).extend({applyDelay:1,autoApplyToModel:!1,autoChangeModel:!1,fillFormFromModel:!0,applySelector:".apply",cancelSelector:".cancel",resetSelector:".reset",initialize:function(t){this.applyValue=n.debounce(this._applyValue,this.getProperty("applyDelay")),this.mergeOptions(t,["values"]),this.extendDefaultValues({})},extendDefaultValues:function(t){this._values=n.extend(this._values||{},t)},onViewInitialize:function(){var t=this.getModel();t&&this.extendDefaultValues(t.toJSON())},onRender:function(){this.firstRender||(this.buildFormBindings(),this.setState(this._tryFlatValues(this._values)),this.setValuesToForm(this.getValues({raw:!0}))),this.firstRender=!0},triggers:function(){var t;return W(t={},"click "+this.getProperty("applySelector"),"trigger:apply"),W(t,"click "+this.getProperty("cancelSelector"),"trigger:cancel"),W(t,"click "+this.getProperty("resetSelector"),"trigger:reset"),t},_tryFlatValues:function(t){return f(t)},_tryUnFlatValues:function(t){return p(t)},rollbackToDefaultValues:function(){this.clearState();var t=this._values,e=this._tryFlatValues(t);this.setState(e)},getValues:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=this.getState();if(t.raw)return e;return this._tryUnFlatValues(e)},onTriggerApply:function(){this._apply()},onTriggerCancel:function(){this._cancel()},onTriggerReset:function(){this._reset()},_apply:function(){var t=this.getValues();this.view.triggerMethod("values:apply",t),this._tryChangeModel(t)},_cancel:function(){this.rollbackToDefaultValues();var t=this._getFullHash(this._values);this.view.triggerMethod("values:cancel",t),this.setValuesToForm(t),this._tryChangeModel(t,{clear:!0})},_reset:function(){this.clearState();var t=this._getFullHash({});this.view.triggerMethod("values:reset",t),this.setValuesToForm(t),this._tryChangeModel(t,{clear:!0})},onState:function(t){this._tryChangeModel(t,{type:"property"})},_tryChangeModel:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n="property"===e.type?"autoChangeModel":"autoApplyToModel";if(!0===this.getProperty(n)){var i=this.getModel();i&&(t=this._tryUnFlatValues(t),!0===e.clear&&i.clear(),i.set(t))}},_getFullHash:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=this.getModel()&&this.getModel().toJSON(),i=n.extend({},this.values,this.mappings,e),r={};return n(i).each(function(t,e){return r[e]=void 0}),n.extend(r,t)},buildFormBindings:function(){var t=this;this.mappings={};var e=["input","textarea","select"];this.$("[name]").each(function(n,i){if(-1!=e.indexOf(i.tagName.toLowerCase())){var r=t.unCidle(i.name);if(!(r in t.mappings)){var o=t._getElementInfo(i,e);o&&(t.mappings[r]=o)}}});var i={};n(this.mappings).each(function(t,e){t.values&&(i[e]=t.values)}),this.extendDefaultValues(i)},_getElementInfo:function(t,e){var n={name:t.name},i=void 0,r='[name="'+t.name+'"]',o=this.$(r);if(o.length){if(o.length>1){var a=[],s=!1;o.each(function(t,n){if(-1!=e.indexOf(n.tagName.toLowerCase())){var i=$(n);if("checkbox"!=n.type&&"radio"!=n.type||i.prop("checked")){var r=i.val();s||(s="checkbox"===n.type||r instanceof Array),r instanceof Array?a=a.concat(r):a.push(i.val())}}}),i=!a.length||1===a.length&&!s?a[0]:a}else i="checkbox"===o.get(0).type?o.prop("checked")?[o.val()]:[]:o.val();return n.values=i,n.isArray=i instanceof Array,n.$elements=o,n}},setValuesToForm:function(t){var e=this;n(t).each(function(t,n){var i=e.mappings[n].$elements,r=t instanceof Array?t:[t];i.each(function(t,n){e._setValueToElement(n,t,r)})})},_setValueToElement:function(t,e,n){var i=e<n.length&&n[e],r=t.jquery?t:$(t);"checkbox"===(t=r.get(0)).type||"radio"===t.type?r.prop("checked",n.indexOf(r.val())>=0):r.val(i)},events:{change:"domChange",input:"domInput"},domChange:function(t){this.applyValue(t.target.name,t.target,t)},domInput:function(t){this.applyValue(t.target.name,t.target,t)},_applyValue:function(t,e,n){"checkbox"==e.type?this._applyCheckboxValue(t,e,n):this._applySimpleValue(t,e,n)},_applySimpleValue:function(t,e,n){t=this.unCidle(t);var i=$(e);this.setState(t,i.val())},_applyCheckboxValue:function(t,e,n){var i='input[type=checkbox][name="'+t+'"]:checked',r=this.$(i).map(function(t,e){return e.value}).toArray();t=this.unCidle(t),this.setState(t,r)}})},J=S(e.Object).with(O,x),K=S(J).with(C),Q=new(K.extend({constructor:function(){for(var t=arguments.length,e=Array(t),n=0;n<t;n++)e[n]=arguments[n];K.apply(this,e),this._initializeYatUser()},_initializeYatUser:function(){},channelName:"identity",isAnonym:function(){return!this.getState("id")},isUser:function(){return!this.isAnonym()},isMe:function(t){return t&&this.getState("id")===t},update:function(t){this.setState(t),this.trigger("change")},logIn:function(t){t.id&&(this.update(t),this.trigger("log:in"))},logOut:function(){this.clearState(),this.trigger("change"),this.trigger("log:out")}})),Z={dragAndDrop:U,TemplateContext:T,identity:Q},tt=S(e.Application).with(O,x,D,j),et=tt.extend({initRadioOnInitialize:!0,_initRegion:function(){if(!(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{skip:!0}).skip){var t=this.getProperty("region");this.region=t,tt.prototype._initRegion()}},getRegion:function(){return this._region||this._initRegion({skip:!1}),this._region},addPageManager:function(t){var e=this;this._pageManagers||(this._pageManagers=[]),this._pageManagers.push(t);var n=t.getName();n?(this.listenTo(t,"all",function(t){for(var i=arguments.length,r=Array(i>1?i-1:0),o=1;o<i;o++)r[o-1]=arguments[o];var a=n+":"+t;e.triggerMethod.apply(e,[a].concat(r))}),this.listenTo(t,"state:currentPage",function(){for(var t=arguments.length,n=Array(t),i=0;i<t;i++)n[i]=arguments[i];return e.triggerMethod.apply(e,["page:swapped"].concat(n))})):console.warn("pageManager prefix not defined")},hasPageManagers:function(){return this._pageManagers&&this._pageManagers.length>0},getMenuTree:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{rebuild:!1};if(this._menuTree&&!e.rebuild)return this._menuTree;var i=this._pageManagers||[],r=n(i).chain().map(function(t){return t.getLinks()}).flatten().value();return this._menuTree=new t.Collection(r),this._menuTree},getPage:function(t){if(this.hasPageManagers())return n(this._pageManagers).find(function(e){return e.getPage(t)})}}),nt=e.AppRouter.extend({},{create:function(t,e){var i={},r={},o=this;return n(t).each(function(t,n){i[n]=n,r[n]=function(){t.action.apply(t,arguments).catch(function(t){o._catchError(t,e)})}}),new this({controller:r,appRoutes:i})},_catchError:function(t,e){if(!e||!0===e.getProperty("throwChildErrors"))throw t;var n="error"+(t.status?":"+t.status.toString():"");e.triggerMethod("error",t,this),"error"!=n&&e.triggerMethod(n,t,this)}}),it=t.Model.extend({}),rt=it.extend({defaults:{url:void 0,label:void 0,target:"_self",level:0},destroy:function(){this.id=null,it.prototype.destroy.apply(this,arguments)}});function ot(t){if(Array.isArray(t)){for(var e=0,n=Array(t.length);e<t.length;e++)n[e]=t[e];return n}return Array.from(t)}var at=S(et).with(P),st=at.extend({constructor:function(){for(var t=arguments.length,e=Array(t),n=0;n<t;n++)e[n]=arguments[n];at.apply(this,e),this.initializeYatPage()},allowStopWithoutStart:!0,allowStartWithoutStop:!0,initializeYatPage:function(t){this.mergeOptions(t,["manager"]),this._initializeModels(t),this._initializeRoute(t),this._proxyEvents(),this._tryCreateRouter(),this._registerIdentityHandlers()},getLayout:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{rebuild:!1};return(!this._layoutView||t.rebuild||this._layoutView&&this._layoutView.isDestroyed&&this._layoutView.isDestroyed())&&this.buildLayout(),this._layoutView},buildLayout:function(){var t=this.getProperty("Layout");if(null!=t){var e=n.extend({},this.getProperty("layoutOptions"));this.model&&!e.model&&n.extend(e,{model:this.model}),this.collection&&!e.collection&&n.extend(e,{collection:this.collection});var i=this.buildLayoutOptions(e);return i.page=this,this._layoutView=new t(i),this._layoutView}},buildLayoutOptions:function(t){return t},addModel:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(t){this.model=t;var n=e.fetch||this.getOption("fetchModelOnAdd");void 0===n&&(n=this.getProperty("fetchDataOnAdd")),!0===n&&this.addStartPromise(t.fetch(e))}},addCollection:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(t){this.collection=t;var n=e.fetch||this.getOption("fetchCollectionOnAdd");void 0===n&&(n=this.getProperty("fetchDataOnAdd")),!0===n&&this.addStartPromise(t.fetch(e))}},freezeWhileStarting:!0,freezeUI:function(){},unFreezeUI:function(){},getRouteHash:function(){var t=[{},this._routeHandler].concat(this.getChildren({startable:!1}).map(function(t){return t.getRouteHash()}));return n.extend.apply(n,ot(t))},hasRouteHash:function(){return n.isObject(this.getRouteHash())},getLinkModel:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;if(this._canHaveLinkModel()){if(this._linkModel)return this._linkModel;var e=this.getRoute(),n=this.getLabel(),i=this._getSublinks(t);return this._linkModel=new rt({url:e,label:n,level:t,children:i}),this._linkModel}},_canHaveLinkModel:function(){return!(!0===this.getProperty("skipMenu")||this.getProperty("isStartNotAllowed"))},_destroyLinkModel:function(){this._linkModel&&(this._linkModel.destroy(),delete this._linkModel)},getParentLinkModel:function(){var t=this.getParent();if(t&&t.getLinkModel){return t.getLinkModel()}},getNeighbourLinks:function(){var t=this.getLinkModel();if(t&&t.collection)return t.collection},getChildrenLinks:function(){var t=this.getLinkModel();if(t)return t.get("children")},_getSublinks:function(e){var i=this.getChildren();if(i&&i.length){var r=n(i).chain().filter(function(t){return!0!==t.getProperty("skipMenu")}).map(function(t){return t.getLinkModel(e+1)}).value();if(r.length){return new t.Collection(r)}}},_initializeModels:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this.addModel(t.model,t),this.addCollection(t.collection,t)},_initializeRoute:function(){var t=this.getRoute({asPattern:!0});if(null!=t){var e=this;this._routeHandler=(n={},i=t,r={context:e,action:function(){return e.start.apply(e,arguments)}},i in n?Object.defineProperty(n,i,{value:r,enumerable:!0,configurable:!0,writable:!0}):n[i]=r,n);var n,i,r}},getRoute:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{asPattern:!1},e=this.getProperty("relativeRoute"),n=this.getProperty("route"),i=this.getParent();if(null!=n){var r=n;if(e&&i&&i.getRoute){r=i.getRoute()+"/"+n}return this._normalizeRoute(r,t)}},_normalizeRoute:function(t,e){if(t=t.replace(/\/+/gim,"/").replace(/^\//,""),e.asPattern)return t;return t.replace(/\(\/\)/gim,"/").replace(/\/+/gim,"/")},_tryCreateRouter:function(){!0===this.getProperty("createRouter")&&(this.router=this._createAppRouter())},_createAppRouter:function(){var t=this.getRouteHash();if(n.size(t))return new nt(t)},_proxyEvents:function(){var t=this._getProxyContexts();this._proxyEventsTo(t)},_getProxyContexts:function(){var t=[],e=this.getProperty("manager");e&&t.push({context:e});var n=this.getChannel();if(n){var i=this.getProperty("proxyEventsToRadio");t.push({context:n,allowed:i})}return t},_proxyEventsTo:function(t){var e=[],i={};n(t).each(function(t){t.allowed?n(t.allowed).each(function(e){i[e]||(i[e]=[]),i[e].push(t.context)}):e.push(t.context)});var r=this;r.on("all",function(t){for(var o=arguments.length,a=Array(o>1?o-1:0),s=1;s<o;s++)a[s-1]=arguments[s];var l=t in i?i[t]:e,u=[r].concat(a);n(l).each(function(e){return e.triggerMethod.apply(e,["page:"+t].concat(ot(u)))})})},_buildChildOptions:function(t){var e={},i=this.getProperty("manager");return i&&(e.manager=i),n.extend(t,this.getProperty("childOptions"),e)},_registerIdentityHandlers:function(){var t=this;this.listenTo(Q,"change",function(){for(var e=arguments.length,n=Array(e),i=0;i<e;i++)n[i]=arguments[i];t._destroyLinkModel(),t.triggerMethod.apply(t,["identity:change"].concat(n))})}}),lt=S(et).with(P),ut=lt.extend({constructor:function(){for(var t=arguments.length,e=Array(t),n=0;n<t;n++)e[n]=arguments[n];lt.apply(this,e),this._initializeYatPageManager.apply(this,e)},throwChildErrors:!0,createRouter:function(){var t=this.getChildren({startable:!1}),e={};n(t).each(function(t){n.isFunction(t.getRouteHash)&&n.extend(e,t.getRouteHash())}),this._routesHash=e,this.setRouter(nt.create(e,this))},setRouter:function(t){this.router=t},getRouter:function(){return this.router},getLinks:function(){var t=this.getChildren();if(t)return n(t).chain().map(function(t){return t.getLinkModel()}).filter(function(t){return!!t}).value()},execute:function(t){var e=this.getPage(t);if(e)e.start({text:error.message});else{if("*NotFound"===t)throw new b.NotFound("*NotFound handler is missing");this.execute("*NotFound")}},navigate:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{trigger:!0},n=this.getRouter();n?n.navigate(t,e):console.warn("router not found")},getPage:function(t){var e=n(this._routesHash).find(function(e,n){return n===t||(e.context.getName()===t||void 0)});return e&&e.context},navigateToRoot:function(){var t=this.getState("currentPage"),e=this.getProperty("rootUrl");if(!e){var n=this.getChildren();if(n&&n.length){var i=n.find(function(e){return e!=t});e=i&&i.getRoute()}}null!=e?this.navigate(e):console.warn("root page not found")},_initializeYatPageManager:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this.mergeOptions(t,["id","name","label"]),this._registerPageHandlers(t),this._registerIdentityHandlers(),this.createRouter()},_buildChildOptions:function(t){return n.extend(t,this.getProperty("childOptions"),{manager:this})},_registerPageHandlers:function(){this.on("page:before:start",this._pageBeforeStart),this.on("page:start",this._pageStart),this.on("page:start:decline",this._pageDecline)},_pageBeforeStart:function(t){var e=this.getState("currentPage");e&&e!=t&&e.stop()},_pageStart:function(t){this.setState("currentPage",t)},_pageDecline:function(){},_registerIdentityHandlers:function(){var t=this;this.listenTo(Q,"change",function(){for(var e=arguments.length,n=Array(e),i=0;i<e;i++)n[i]=arguments[i];t.triggerMethod.apply(t,["identity:change"].concat(n)),t._moveToRootIfCurrentPageNotAllowed()})},_moveToRootIfCurrentPageNotAllowed:function(){var t=this.getState("currentPage");t&&t.isStartNotAllowed()&&this.navigateToRoot()}}),ht=S(e.View).with(N),ct=S(e.NextCollectionView).with(N);return{VERSION:"0.0.21",Functions:m,Helpers:w,Mixins:B,Behaviors:G,Singletons:Z,TemplateContext:T,identity:Q,Object:J,Error:b,App:et,Page:st,Router:nt,PageManager:ut,View:ht,CollectionView:ct}}),this&&this.Marionette&&(this.Marionette.Yat=this.MarionetteYat);
//# sourceMappingURL=marionette.yat.min.js.map